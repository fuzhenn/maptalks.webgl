/*!
 * maptalks.webgl v0.3.0
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,e){"use strict";function r(t,e){return e={exports:{}},t(e,e.exports),e.exports}function n(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var a=r[n],o=Object.getOwnPropertyDescriptor(e,a);o&&o.configurable&&void 0===t[a]&&Object.defineProperty(t,a,o)}return t}function a(t,e){this.x=t,this.y=e}function o(t,e,r){r=r||2;var n=e&&e.length,a=n?e[0]*r:t.length,o=i(t,0,a,r,!0),s=[];if(!o)return s;var u,h,f,c,p,d,x;if(n&&(o=v(t,e,o,r)),t.length>80*r){u=f=t[0],h=c=t[1];for(var M=r;M<a;M+=r)p=t[M],d=t[M+1],p<u&&(u=p),d<h&&(h=d),p>f&&(f=p),d>c&&(c=d);x=Math.max(f-u,c-h)}return l(o,s,r,u,h,x),s}function i(t,e,r,n,a){var o,i;if(a===C(t,e,r,n)>0)for(o=e;o<r;o+=n)i=R(o,t[o],t[o+1],i);else for(o=r-n;o>=e;o-=n)i=R(o,t[o],t[o+1],i);return i&&I(i,i.next)&&(z(i),i=i.next),i}function s(t,e){if(!t)return t;e||(e=t);var r,n=t;do if(r=!1,n.steiner||!I(n,n.next)&&0!==b(n.prev,n,n.next))n=n.next;else{if(z(n),n=e=n.prev,n===n.next)return null;r=!0}while(r||n!==e);return e}function l(t,e,r,n,a,o,i){if(t){!i&&o&&M(t,n,a,o);for(var v,p,d=t;t.prev!==t.next;)if(v=t.prev,p=t.next,o?h(t,n,a,o):u(t))e.push(v.i/r),e.push(t.i/r),e.push(p.i/r),z(t),t=p.next,d=p.next;else if(t=p,t===d){i?1===i?(t=f(t,e,r),l(t,e,r,n,a,o,2)):2===i&&c(t,e,r,n,a,o):l(s(t),e,r,n,a,o,1);break}}}function u(t){var e=t.prev,r=t,n=t.next;if(b(e,r,n)>=0)return!1;for(var a=t.next.next;a!==t.prev;){if(S(e.x,e.y,r.x,r.y,n.x,n.y,a.x,a.y)&&b(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function h(t,e,r,n){var a=t.prev,o=t,i=t.next;if(b(a,o,i)>=0)return!1;for(var s=a.x<o.x?a.x<i.x?a.x:i.x:o.x<i.x?o.x:i.x,l=a.y<o.y?a.y<i.y?a.y:i.y:o.y<i.y?o.y:i.y,u=a.x>o.x?a.x>i.x?a.x:i.x:o.x>i.x?o.x:i.x,h=a.y>o.y?a.y>i.y?a.y:i.y:o.y>i.y?o.y:i.y,f=g(s,l,e,r,n),c=g(u,h,e,r,n),v=t.nextZ;v&&v.z<=c;){if(v!==t.prev&&v!==t.next&&S(a.x,a.y,o.x,o.y,i.x,i.y,v.x,v.y)&&b(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(v=t.prevZ;v&&v.z>=f;){if(v!==t.prev&&v!==t.next&&S(a.x,a.y,o.x,o.y,i.x,i.y,v.x,v.y)&&b(v.prev,v,v.next)>=0)return!1;v=v.prevZ}return!0}function f(t,e,r){var n=t;do{var a=n.prev,o=n.next.next;!I(a,o)&&D(a,n,n.next,o)&&w(a,o)&&w(o,a)&&(e.push(a.i/r),e.push(n.i/r),e.push(o.i/r),z(n),z(n.next),n=t=o),n=n.next}while(n!==t);return n}function c(t,e,r,n,a,o){var i=t;do{for(var u=i.next.next;u!==i.prev;){if(i.i!==u.i&&_(i,u)){var h=E(i,u);return i=s(i,i.next),h=s(h,h.next),l(i,e,r,n,a,o),void l(h,e,r,n,a,o)}u=u.next}i=i.next}while(i!==t)}function v(t,e,r,n){var a,o,l,u,h,f=[];for(a=0,o=e.length;a<o;a++)l=e[a]*n,u=a<o-1?e[a+1]*n:t.length,h=i(t,l,u,n,!1),h===h.next&&(h.steiner=!0),f.push(m(h));for(f.sort(p),a=0;a<f.length;a++)d(f[a],r),r=s(r,r.next);return r}function p(t,e){return t.x-e.x}function d(t,e){if(e=x(t,e)){var r=E(e,t);s(r,r.next)}}function x(t,e){var r,n=e,a=t.x,o=t.y,i=-(1/0);do{if(o<=n.y&&o>=n.next.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=a&&s>i){if(i=s,s===a){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(a===i)return r.prev;var l,u=r,h=r.x,f=r.y,c=1/0;for(n=r.next;n!==u;)a>=n.x&&n.x>=h&&S(o<f?a:i,o,h,f,o<f?i:a,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(a-n.x),(l<c||l===c&&n.x>r.x)&&w(n,t)&&(r=n,c=l)),n=n.next;return r}function M(t,e,r,n){var a=t;do null===a.z&&(a.z=g(a.x,a.y,e,r,n)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==t);a.prevZ.nextZ=null,a.prevZ=null,y(a)}function y(t){var e,r,n,a,o,i,s,l,u=1;do{for(r=t,t=null,o=null,i=0;r;){for(i++,n=r,s=0,e=0;e<u&&(s++,n=n.nextZ,n);e++);for(l=u;s>0||l>0&&n;)0===s?(a=n,n=n.nextZ,l--):0!==l&&n?r.z<=n.z?(a=r,r=r.nextZ,s--):(a=n,n=n.nextZ,l--):(a=r,r=r.nextZ,s--),o?o.nextZ=a:t=a,a.prevZ=o,o=a;r=n}o.nextZ=null,u*=2}while(i>1);return t}function g(t,e,r,n,a){return t=32767*(t-r)/a,e=32767*(e-n)/a,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function m(t){var e=t,r=t;do e.x<r.x&&(r=e),e=e.next;while(e!==t);return r}function S(t,e,r,n,a,o,i,s){return(a-i)*(e-s)-(t-i)*(o-s)>=0&&(t-i)*(n-s)-(r-i)*(e-s)>=0&&(r-i)*(o-s)-(a-i)*(n-s)>=0}function _(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!F(t,e)&&w(t,e)&&w(e,t)&&A(t,e)}function b(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function I(t,e){return t.x===e.x&&t.y===e.y}function D(t,e,r,n){return!!(I(t,e)&&I(r,n)||I(t,n)&&I(r,e))||b(t,e,r)>0!=b(t,e,n)>0&&b(r,n,t)>0!=b(r,n,e)>0}function F(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&D(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function w(t,e){return b(t.prev,t,t.next)<0?b(t,e,t.next)>=0&&b(t,t.prev,e)>=0:b(t,e,t.prev)<0||b(t,t.next,e)<0}function A(t,e){var r=t,n=!1,a=(t.x+e.x)/2,o=(t.y+e.y)/2;do r.y>o!=r.next.y>o&&a<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==t);return n}function E(t,e){var r=new P(t.i,t.x,t.y),n=new P(e.i,e.x,e.y),a=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=a,a.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function R(t,e,r,n){var a=new P(t,e,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function z(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function P(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(t,e,r,n){for(var a=0,o=e,i=r-n;o<r;o+=n)a+=(t[i]-t[o])*(t[o+1]+t[i+1]),i=o;return a}function L(t,e,r,n,a,o){if(!(a-n<=r)){var i=Math.floor((n+a)/2);k(t,e,i,n,a,o%2),L(t,e,r,n,i-1,o+1),L(t,e,r,i+1,a,o+1)}}function k(t,e,r,n,a,o){for(;a>n;){if(a-n>600){var i=a-n+1,s=r-n+1,l=Math.log(i),u=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*u*(i-u)/i)*(s-i/2<0?-1:1),f=Math.max(n,Math.floor(r-s*u/i+h)),c=Math.min(a,Math.floor(r+(i-s)*u/i+h));k(t,e,r,f,c,o)}var v=e[2*r+o],p=n,d=a;for(T(t,e,n,r),e[2*a+o]>v&&T(t,e,n,a);p<d;){for(T(t,e,p,d),p++,d--;e[2*p+o]<v;)p++;for(;e[2*d+o]>v;)d--}e[2*n+o]===v?T(t,e,n,d):(d++,T(t,e,d,a)),d<=r&&(n=d+1),r<=d&&(a=d-1)}}function T(t,e,r,n){B(t,r,n),B(e,2*r,2*n),B(e,2*r+1,2*n+1)}function B(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function O(t,e,r,n,a,o,i){for(var s,l,u=[0,t.length-1,0],h=[];u.length;){var f=u.pop(),c=u.pop(),v=u.pop();if(c-v<=i)for(var p=v;p<=c;p++)s=e[2*p],l=e[2*p+1],s>=r&&s<=a&&l>=n&&l<=o&&h.push(t[p]);else{var d=Math.floor((v+c)/2);s=e[2*d],l=e[2*d+1],s>=r&&s<=a&&l>=n&&l<=o&&h.push(t[d]);var x=(f+1)%2;(0===f?r<=s:n<=l)&&(u.push(v),u.push(d-1),u.push(x)),(0===f?a>=s:o>=l)&&(u.push(d+1),u.push(c),u.push(x))}}return h}function N(t,e,r,n,a,o){for(var i=[0,t.length-1,0],s=[],l=a*a;i.length;){var u=i.pop(),h=i.pop(),f=i.pop();if(h-f<=o)for(var c=f;c<=h;c++)q(e[2*c],e[2*c+1],r,n)<=l&&s.push(t[c]);else{var v=Math.floor((f+h)/2),p=e[2*v],d=e[2*v+1];q(p,d,r,n)<=l&&s.push(t[v]);var x=(u+1)%2;(0===u?r-a<=p:n-a<=d)&&(i.push(f),i.push(v-1),i.push(x)),(0===u?r+a>=p:n+a>=d)&&(i.push(v+1),i.push(h),i.push(x))}}return s}function q(t,e,r,n){var a=t-r,o=e-n;return a*a+o*o}function U(t,e,r,n,a){return new V(t,e,r,n,a)}function V(t,e,r,n,a){e=e||Y,r=r||j,a=a||Array,this.nodeSize=n||64,this.points=t,this.ids=new a(t.length),this.coords=new a(2*t.length);for(var o=0;o<t.length;o++)this.ids[o]=o,this.coords[2*o]=e(t[o]),this.coords[2*o+1]=r(t[o]);fe(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function Y(t){return t[0]}function j(t){return t[1]}function Z(){for(var t={},e=me.length,r=0;r<e;r++)t[me[r]]={distance:-1,parent:null};return t}function W(t){var e=Z(),r=[t];for(e[t].distance=0;r.length;)for(var n=r.pop(),a=Object.keys(ge[n]),o=a.length,i=0;i<o;i++){var s=a[i],l=e[s];l.distance===-1&&(l.distance=e[n].distance+1,l.parent=n,r.unshift(s))}return e}function G(t,e){return function(r){return e(t(r))}}function X(t,e){for(var r=[e[t].parent,t],n=ge[e[t].parent][t],a=e[t].parent;e[a].parent;)r.unshift(e[a].parent),n=G(ge[e[a].parent][a],n),a=e[a].parent;return n.conversion=r,n}function J(t){var e=function(e){return void 0===e||null===e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}function H(t){var e=function(e){if(void 0===e||null===e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var r=t(e);if("object"===("undefined"==typeof r?"undefined":Ot(r)))for(var n=r.length,a=0;a<n;a++)r[a]=Math.round(r[a]);return r};return"conversion"in t&&(e.conversion=t.conversion),e}function K(t){if(t){var e=/^#([a-fA-F0-9]{3})$/,r=/^#([a-fA-F0-9]{6})$/,n=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,a=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,o=/(\D+)/,i=[0,0,0],s=1,l=t.match(e);if(l){l=l[1];for(var u=0;u<i.length;u++)i[u]=parseInt(l[u]+l[u],16)}else if(l=t.match(r)){l=l[1];for(var u=0;u<i.length;u++)i[u]=parseInt(l.slice(2*u,2*u+2),16)}else if(l=t.match(n)){for(var u=0;u<i.length;u++)i[u]=parseInt(l[u+1]);s=parseFloat(l[4])}else if(l=t.match(a)){for(var u=0;u<i.length;u++)i[u]=Math.round(2.55*parseFloat(l[u+1]));s=parseFloat(l[4])}else if(l=t.match(o)){if("transparent"==l[1])return[0,0,0,0];if(i=we[l[1]],!i)return}for(var u=0;u<i.length;u++)i[u]=ct(i[u],0,255);return s=s||0==s?ct(s,0,1):1,i[3]=s,i}}function Q(t){if(t){var e=/^hsla?\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/,r=t.match(e);if(r){var n=parseFloat(r[4]),a=ct(parseInt(r[1]),0,360),o=ct(parseFloat(r[2]),0,100),i=ct(parseFloat(r[3]),0,100),s=ct(isNaN(n)?1:n,0,1);return[a,o,i,s]}}}function $(t){if(t){var e=/^hwb\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/,r=t.match(e);if(r){var n=parseFloat(r[4]),a=ct(parseInt(r[1]),0,360),o=ct(parseFloat(r[2]),0,100),i=ct(parseFloat(r[3]),0,100),s=ct(isNaN(n)?1:n,0,1);return[a,o,i,s]}}}function tt(t){var e=K(t);return e&&e.slice(0,3)}function et(t){var e=Q(t);return e&&e.slice(0,3)}function rt(t){var e=K(t);return e?e[3]:(e=Q(t))?e[3]:(e=$(t))?e[3]:void 0}function nt(t){return"#"+vt(t[0])+vt(t[1])+vt(t[2])}function at(t,e){return e<1||t[3]&&t[3]<1?ot(t,e):"rgb("+t[0]+", "+t[1]+", "+t[2]+")"}function ot(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+e+")"}function it(t,e){if(e<1||t[3]&&t[3]<1)return st(t,e);var r=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),a=Math.round(t[2]/255*100);return"rgb("+r+"%, "+n+"%, "+a+"%)"}function st(t,e){var r=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),a=Math.round(t[2]/255*100);return"rgba("+r+"%, "+n+"%, "+a+"%, "+(e||t[3]||1)+")"}function lt(t,e){return e<1||t[3]&&t[3]<1?ut(t,e):"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)"}function ut(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+e+")"}function ht(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+(void 0!==e&&1!==e?", "+e:"")+")"}function ft(t){return Ee[t.slice(0,3)]}function ct(t,e,r){return Math.min(Math.max(e,t),r)}function vt(t){var e=t.toString(16).toUpperCase();return e.length<2?"0"+e:e}var pt="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},dt={};dt.EPSILON=1e-6,dt.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,dt.RANDOM=Math.random,dt.ENABLE_SIMD=!1,dt.SIMD_AVAILABLE=dt.ARRAY_TYPE===Float32Array&&"SIMD"in pt,dt.USE_SIMD=dt.ENABLE_SIMD&&dt.SIMD_AVAILABLE,dt.setMatrixArrayType=function(t){dt.ARRAY_TYPE=t};var xt=Math.PI/180;dt.toRadian=function(t){return t*xt},dt.equals=function(t,e){return Math.abs(t-e)<=dt.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))};var Mt=dt,yt=Mt,gt={};gt.create=function(){var t=new yt.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},gt.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},gt.clone=function(t){var e=new yt.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},gt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},gt.fromValues=function(t,e,r,n,a,o,i,s,l){var u=new yt.ARRAY_TYPE(9);return u[0]=t,u[1]=e,u[2]=r,u[3]=n,u[4]=a,u[5]=o,u[6]=i,u[7]=s,u[8]=l,u},gt.set=function(t,e,r,n,a,o,i,s,l,u){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=o,t[5]=i,t[6]=s,t[7]=l,t[8]=u,t},gt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},gt.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},gt.invert=function(t,e){var r=e[0],n=e[1],a=e[2],o=e[3],i=e[4],s=e[5],l=e[6],u=e[7],h=e[8],f=h*i-s*u,c=-h*o+s*l,v=u*o-i*l,p=r*f+n*c+a*v;return p?(p=1/p,t[0]=f*p,t[1]=(-h*n+a*u)*p,t[2]=(s*n-a*i)*p,t[3]=c*p,t[4]=(h*r-a*l)*p,t[5]=(-s*r+a*o)*p,t[6]=v*p,t[7]=(-u*r+n*l)*p,t[8]=(i*r-n*o)*p,t):null},gt.adjoint=function(t,e){var r=e[0],n=e[1],a=e[2],o=e[3],i=e[4],s=e[5],l=e[6],u=e[7],h=e[8];return t[0]=i*h-s*u,t[1]=a*u-n*h,t[2]=n*s-a*i,t[3]=s*l-o*h,t[4]=r*h-a*l,t[5]=a*o-r*s,t[6]=o*u-i*l,t[7]=n*l-r*u,t[8]=r*i-n*o,t},gt.determinant=function(t){var e=t[0],r=t[1],n=t[2],a=t[3],o=t[4],i=t[5],s=t[6],l=t[7],u=t[8];return e*(u*o-i*l)+r*(-u*a+i*s)+n*(l*a-o*s)},gt.multiply=function(t,e,r){var n=e[0],a=e[1],o=e[2],i=e[3],s=e[4],l=e[5],u=e[6],h=e[7],f=e[8],c=r[0],v=r[1],p=r[2],d=r[3],x=r[4],M=r[5],y=r[6],g=r[7],m=r[8];return t[0]=c*n+v*i+p*u,t[1]=c*a+v*s+p*h,t[2]=c*o+v*l+p*f,t[3]=d*n+x*i+M*u,t[4]=d*a+x*s+M*h,t[5]=d*o+x*l+M*f,t[6]=y*n+g*i+m*u,t[7]=y*a+g*s+m*h,t[8]=y*o+g*l+m*f,t},gt.mul=gt.multiply,gt.translate=function(t,e,r){var n=e[0],a=e[1],o=e[2],i=e[3],s=e[4],l=e[5],u=e[6],h=e[7],f=e[8],c=r[0],v=r[1];return t[0]=n,t[1]=a,t[2]=o,t[3]=i,t[4]=s,t[5]=l,t[6]=c*n+v*i+u,t[7]=c*a+v*s+h,t[8]=c*o+v*l+f,t},gt.rotate=function(t,e,r){var n=e[0],a=e[1],o=e[2],i=e[3],s=e[4],l=e[5],u=e[6],h=e[7],f=e[8],c=Math.sin(r),v=Math.cos(r);return t[0]=v*n+c*i,t[1]=v*a+c*s,t[2]=v*o+c*l,t[3]=v*i-c*n,t[4]=v*s-c*a,t[5]=v*l-c*o,t[6]=u,t[7]=h,t[8]=f,t},gt.scale=function(t,e,r){var n=r[0],a=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},gt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},gt.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},gt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},gt.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},gt.fromQuat=function(t,e){var r=e[0],n=e[1],a=e[2],o=e[3],i=r+r,s=n+n,l=a+a,u=r*i,h=n*i,f=n*s,c=a*i,v=a*s,p=a*l,d=o*i,x=o*s,M=o*l;return t[0]=1-f-p,t[3]=h-M,t[6]=c+x,t[1]=h+M,t[4]=1-u-p,t[7]=v-d,t[2]=c-x,t[5]=v+d,t[8]=1-u-f,t},gt.normalFromMat4=function(t,e){var r=e[0],n=e[1],a=e[2],o=e[3],i=e[4],s=e[5],l=e[6],u=e[7],h=e[8],f=e[9],c=e[10],v=e[11],p=e[12],d=e[13],x=e[14],M=e[15],y=r*s-n*i,g=r*l-a*i,m=r*u-o*i,S=n*l-a*s,_=n*u-o*s,b=a*u-o*l,I=h*d-f*p,D=h*x-c*p,F=h*M-v*p,w=f*x-c*d,A=f*M-v*d,E=c*M-v*x,R=y*E-g*A+m*w+S*F-_*D+b*I;return R?(R=1/R,t[0]=(s*E-l*A+u*w)*R,t[1]=(l*F-i*E-u*D)*R,t[2]=(i*A-s*F+u*I)*R,t[3]=(a*A-n*E-o*w)*R,t[4]=(r*E-a*F+o*D)*R,t[5]=(n*F-r*A-o*I)*R,t[6]=(d*b-x*_+M*S)*R,t[7]=(x*m-p*b-M*g)*R,t[8]=(p*_-d*m+M*y)*R,t):null},gt.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},gt.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},gt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},gt.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t},gt.sub=gt.subtract,gt.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},gt.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t},gt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},gt.equals=function(t,e){var r=t[0],n=t[1],a=t[2],o=t[3],i=t[4],s=t[5],l=t[6],u=t[7],h=t[8],f=e[0],c=e[1],v=e[2],p=e[3],d=e[4],x=e[5],M=t[6],y=e[7],g=e[8];return Math.abs(r-f)<=yt.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-c)<=yt.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-v)<=yt.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(o-p)<=yt.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(i-d)<=yt.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(s-x)<=yt.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(l-M)<=yt.EPSILON*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(u-y)<=yt.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(h-g)<=yt.EPSILON*Math.max(1,Math.abs(h),Math.abs(g))};var mt=gt,St=Mt,_t={scalar:{},SIMD:{}};_t.create=function(){var t=new St.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},_t.clone=function(t){var e=new St.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},_t.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},_t.fromValues=function(t,e,r,n,a,o,i,s,l,u,h,f,c,v,p,d){var x=new St.ARRAY_TYPE(16);return x[0]=t,x[1]=e,x[2]=r,x[3]=n,x[4]=a,x[5]=o,x[6]=i,x[7]=s,x[8]=l,x[9]=u,x[10]=h,x[11]=f,x[12]=c,x[13]=v,x[14]=p,x[15]=d,x},_t.set=function(t,e,r,n,a,o,i,s,l,u,h,f,c,v,p,d,x){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=o,t[5]=i,t[6]=s,t[7]=l,t[8]=u,t[9]=h,t[10]=f,t[11]=c,t[12]=v,t[13]=p,t[14]=d,t[15]=x,t},_t.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},_t.scalar.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],a=e[3],o=e[6],i=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=a,t[13]=i,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},_t.SIMD.transpose=function(t,e){var r,n,a,o,i,s,l,u,h,f;return r=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),i=SIMD.Float32x4.shuffle(r,n,0,1,4,5),s=SIMD.Float32x4.shuffle(a,o,0,1,4,5),l=SIMD.Float32x4.shuffle(i,s,0,2,4,6),u=SIMD.Float32x4.shuffle(i,s,1,3,5,7),SIMD.Float32x4.store(t,0,l),SIMD.Float32x4.store(t,4,u),i=SIMD.Float32x4.shuffle(r,n,2,3,6,7),s=SIMD.Float32x4.shuffle(a,o,2,3,6,7),h=SIMD.Float32x4.shuffle(i,s,0,2,4,6),f=SIMD.Float32x4.shuffle(i,s,1,3,5,7),SIMD.Float32x4.store(t,8,h),SIMD.Float32x4.store(t,12,f),t},_t.transpose=St.USE_SIMD?_t.SIMD.transpose:_t.scalar.transpose,_t.scalar.invert=function(t,e){var r=e[0],n=e[1],a=e[2],o=e[3],i=e[4],s=e[5],l=e[6],u=e[7],h=e[8],f=e[9],c=e[10],v=e[11],p=e[12],d=e[13],x=e[14],M=e[15],y=r*s-n*i,g=r*l-a*i,m=r*u-o*i,S=n*l-a*s,_=n*u-o*s,b=a*u-o*l,I=h*d-f*p,D=h*x-c*p,F=h*M-v*p,w=f*x-c*d,A=f*M-v*d,E=c*M-v*x,R=y*E-g*A+m*w+S*F-_*D+b*I;return R?(R=1/R,t[0]=(s*E-l*A+u*w)*R,t[1]=(a*A-n*E-o*w)*R,t[2]=(d*b-x*_+M*S)*R,t[3]=(c*_-f*b-v*S)*R,t[4]=(l*F-i*E-u*D)*R,t[5]=(r*E-a*F+o*D)*R,t[6]=(x*m-p*b-M*g)*R,t[7]=(h*b-c*m+v*g)*R,t[8]=(i*A-s*F+u*I)*R,t[9]=(n*F-r*A-o*I)*R,t[10]=(p*_-d*m+M*y)*R,t[11]=(f*m-h*_-v*y)*R,t[12]=(s*D-i*w-l*I)*R,t[13]=(r*w-n*D+a*I)*R,t[14]=(d*g-p*S-x*y)*R,t[15]=(h*S-f*g+c*y)*R,t):null},_t.SIMD.invert=function(t,e){var r,n,a,o,i,s,l,u,h,f,c=SIMD.Float32x4.load(e,0),v=SIMD.Float32x4.load(e,4),p=SIMD.Float32x4.load(e,8),d=SIMD.Float32x4.load(e,12);return i=SIMD.Float32x4.shuffle(c,v,0,1,4,5),n=SIMD.Float32x4.shuffle(p,d,0,1,4,5),r=SIMD.Float32x4.shuffle(i,n,0,2,4,6),n=SIMD.Float32x4.shuffle(n,i,1,3,5,7),i=SIMD.Float32x4.shuffle(c,v,2,3,6,7),o=SIMD.Float32x4.shuffle(p,d,2,3,6,7),a=SIMD.Float32x4.shuffle(i,o,0,2,4,6),o=SIMD.Float32x4.shuffle(o,i,1,3,5,7),i=SIMD.Float32x4.mul(a,o),i=SIMD.Float32x4.swizzle(i,1,0,3,2),s=SIMD.Float32x4.mul(n,i),l=SIMD.Float32x4.mul(r,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,i),s),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,i),l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),i=SIMD.Float32x4.mul(n,a),i=SIMD.Float32x4.swizzle(i,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),s),h=SIMD.Float32x4.mul(r,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(o,i)),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,i),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),i=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,2,3,0,1),o),i=SIMD.Float32x4.swizzle(i,1,0,3,2),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,i),s),u=SIMD.Float32x4.mul(r,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(a,i)),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,i),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),i=SIMD.Float32x4.mul(r,n),i=SIMD.Float32x4.swizzle(i,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),u),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,i),h),i=SIMD.Float32x4.swizzle(i,2,3,0,1),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,i),u),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(a,i)),i=SIMD.Float32x4.mul(r,o),i=SIMD.Float32x4.swizzle(i,1,0,3,2),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(a,i)),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,i),u),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,i),l),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(n,i)),i=SIMD.Float32x4.mul(r,a),i=SIMD.Float32x4.swizzle(i,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),l),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(n,i)),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(o,i)),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,i),h),f=SIMD.Float32x4.mul(r,s),f=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(f,2,3,0,1),f),f=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(f,1,0,3,2),f),i=SIMD.Float32x4.reciprocalApproximation(f),f=SIMD.Float32x4.sub(SIMD.Float32x4.add(i,i),SIMD.Float32x4.mul(f,SIMD.Float32x4.mul(i,i))),(f=SIMD.Float32x4.swizzle(f,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(f,s)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(f,l)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(f,u)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(f,h)),t):null},_t.invert=St.USE_SIMD?_t.SIMD.invert:_t.scalar.invert,_t.scalar.adjoint=function(t,e){var r=e[0],n=e[1],a=e[2],o=e[3],i=e[4],s=e[5],l=e[6],u=e[7],h=e[8],f=e[9],c=e[10],v=e[11],p=e[12],d=e[13],x=e[14],M=e[15];return t[0]=s*(c*M-v*x)-f*(l*M-u*x)+d*(l*v-u*c),t[1]=-(n*(c*M-v*x)-f*(a*M-o*x)+d*(a*v-o*c)),t[2]=n*(l*M-u*x)-s*(a*M-o*x)+d*(a*u-o*l),t[3]=-(n*(l*v-u*c)-s*(a*v-o*c)+f*(a*u-o*l)),t[4]=-(i*(c*M-v*x)-h*(l*M-u*x)+p*(l*v-u*c)),t[5]=r*(c*M-v*x)-h*(a*M-o*x)+p*(a*v-o*c),t[6]=-(r*(l*M-u*x)-i*(a*M-o*x)+p*(a*u-o*l)),t[7]=r*(l*v-u*c)-i*(a*v-o*c)+h*(a*u-o*l),t[8]=i*(f*M-v*d)-h*(s*M-u*d)+p*(s*v-u*f),t[9]=-(r*(f*M-v*d)-h*(n*M-o*d)+p*(n*v-o*f)),t[10]=r*(s*M-u*d)-i*(n*M-o*d)+p*(n*u-o*s),t[11]=-(r*(s*v-u*f)-i*(n*v-o*f)+h*(n*u-o*s)),t[12]=-(i*(f*x-c*d)-h*(s*x-l*d)+p*(s*c-l*f)),t[13]=r*(f*x-c*d)-h*(n*x-a*d)+p*(n*c-a*f),t[14]=-(r*(s*x-l*d)-i*(n*x-a*d)+p*(n*l-a*s)),t[15]=r*(s*c-l*f)-i*(n*c-a*f)+h*(n*l-a*s),t},_t.SIMD.adjoint=function(t,e){var r,n,a,o,i,s,l,u,h,f,c,v,p,r=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12);return h=SIMD.Float32x4.shuffle(r,n,0,1,4,5),s=SIMD.Float32x4.shuffle(a,o,0,1,4,5),i=SIMD.Float32x4.shuffle(h,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,h,1,3,5,7),h=SIMD.Float32x4.shuffle(r,n,2,3,6,7),u=SIMD.Float32x4.shuffle(a,o,2,3,6,7),l=SIMD.Float32x4.shuffle(h,u,0,2,4,6),u=SIMD.Float32x4.shuffle(u,h,1,3,5,7),h=SIMD.Float32x4.mul(l,u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),f=SIMD.Float32x4.mul(s,h),c=SIMD.Float32x4.mul(i,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,h),f),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,h),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.mul(s,l),h=SIMD.Float32x4.swizzle(h,1,0,3,2),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),f),p=SIMD.Float32x4.mul(i,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(u,h)),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,h),p),p=SIMD.Float32x4.swizzle(p,2,3,0,1),h=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,3,0,1),u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),l=SIMD.Float32x4.swizzle(l,2,3,0,1),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,h),f),v=SIMD.Float32x4.mul(i,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(l,h)),v=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,h),v),v=SIMD.Float32x4.swizzle(v,2,3,0,1),h=SIMD.Float32x4.mul(i,s),h=SIMD.Float32x4.swizzle(h,1,0,3,2),v=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),v),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,h),p),h=SIMD.Float32x4.swizzle(h,2,3,0,1),v=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,h),v),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(l,h)),h=SIMD.Float32x4.mul(i,u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(l,h)),v=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,h),v),h=SIMD.Float32x4.swizzle(h,2,3,0,1),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,h),c),v=SIMD.Float32x4.sub(v,SIMD.Float32x4.mul(s,h)),h=SIMD.Float32x4.mul(i,l),h=SIMD.Float32x4.swizzle(h,1,0,3,2),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),c),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(s,h)),h=SIMD.Float32x4.swizzle(h,2,3,0,1),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(u,h)),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,h),p),SIMD.Float32x4.store(t,0,f),SIMD.Float32x4.store(t,4,c),SIMD.Float32x4.store(t,8,v),SIMD.Float32x4.store(t,12,p),t},_t.adjoint=St.USE_SIMD?_t.SIMD.adjoint:_t.scalar.adjoint,_t.determinant=function(t){var e=t[0],r=t[1],n=t[2],a=t[3],o=t[4],i=t[5],s=t[6],l=t[7],u=t[8],h=t[9],f=t[10],c=t[11],v=t[12],p=t[13],d=t[14],x=t[15],M=e*i-r*o,y=e*s-n*o,g=e*l-a*o,m=r*s-n*i,S=r*l-a*i,_=n*l-a*s,b=u*p-h*v,I=u*d-f*v,D=u*x-c*v,F=h*d-f*p,w=h*x-c*p,A=f*x-c*d;return M*A-y*w+g*F+m*D-S*I+_*b},_t.SIMD.multiply=function(t,e,r){var n=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),i=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.load(r,0),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),i))));SIMD.Float32x4.store(t,0,l);var u=SIMD.Float32x4.load(r,4),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,3,3,3,3),i))));SIMD.Float32x4.store(t,4,h);var f=SIMD.Float32x4.load(r,8),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,3,3,3,3),i))));SIMD.Float32x4.store(t,8,c);var v=SIMD.Float32x4.load(r,12),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(v,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(v,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(v,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(v,3,3,3,3),i))));return SIMD.Float32x4.store(t,12,p),t},_t.scalar.multiply=function(t,e,r){var n=e[0],a=e[1],o=e[2],i=e[3],s=e[4],l=e[5],u=e[6],h=e[7],f=e[8],c=e[9],v=e[10],p=e[11],d=e[12],x=e[13],M=e[14],y=e[15],g=r[0],m=r[1],S=r[2],_=r[3];return t[0]=g*n+m*s+S*f+_*d,t[1]=g*a+m*l+S*c+_*x,t[2]=g*o+m*u+S*v+_*M,t[3]=g*i+m*h+S*p+_*y,g=r[4],m=r[5],S=r[6],_=r[7],t[4]=g*n+m*s+S*f+_*d,t[5]=g*a+m*l+S*c+_*x,t[6]=g*o+m*u+S*v+_*M,t[7]=g*i+m*h+S*p+_*y,g=r[8],m=r[9],S=r[10],_=r[11],t[8]=g*n+m*s+S*f+_*d,t[9]=g*a+m*l+S*c+_*x,t[10]=g*o+m*u+S*v+_*M,t[11]=g*i+m*h+S*p+_*y,g=r[12],m=r[13],S=r[14],_=r[15],t[12]=g*n+m*s+S*f+_*d,t[13]=g*a+m*l+S*c+_*x,t[14]=g*o+m*u+S*v+_*M,t[15]=g*i+m*h+S*p+_*y,t},_t.multiply=St.USE_SIMD?_t.SIMD.multiply:_t.scalar.multiply,_t.mul=_t.multiply,_t.scalar.translate=function(t,e,r){var n,a,o,i,s,l,u,h,f,c,v,p,d=r[0],x=r[1],M=r[2];return e===t?(t[12]=e[0]*d+e[4]*x+e[8]*M+e[12],t[13]=e[1]*d+e[5]*x+e[9]*M+e[13],t[14]=e[2]*d+e[6]*x+e[10]*M+e[14],t[15]=e[3]*d+e[7]*x+e[11]*M+e[15]):(n=e[0],a=e[1],o=e[2],i=e[3],s=e[4],l=e[5],u=e[6],h=e[7],f=e[8],c=e[9],v=e[10],p=e[11],t[0]=n,t[1]=a,t[2]=o,t[3]=i,t[4]=s,t[5]=l,t[6]=u,t[7]=h,t[8]=f,t[9]=c,t[10]=v,t[11]=p,t[12]=n*d+s*x+f*M+e[12],t[13]=a*d+l*x+c*M+e[13],t[14]=o*d+u*x+v*M+e[14],t[15]=i*d+h*x+p*M+e[15]),t},_t.SIMD.translate=function(t,e,r){var n=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),i=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4(r[0],r[1],r[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,0,0,0,0)),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(s,1,1,1,1)),o=SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(s,2,2,2,2));var l=SIMD.Float32x4.add(n,SIMD.Float32x4.add(a,SIMD.Float32x4.add(o,i)));return SIMD.Float32x4.store(t,12,l),t},_t.translate=St.USE_SIMD?_t.SIMD.translate:_t.scalar.translate,_t.scalar.scale=function(t,e,r){var n=r[0],a=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},_t.SIMD.scale=function(t,e,r){var n,a,o,i=SIMD.Float32x4(r[0],r[1],r[2],0);return n=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(i,0,0,0,0))),a=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(i,1,1,1,1))),o=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(i,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},_t.scale=St.USE_SIMD?_t.SIMD.scale:_t.scalar.scale,_t.rotate=function(t,e,r,n){var a,o,i,s,l,u,h,f,c,v,p,d,x,M,y,g,m,S,_,b,I,D,F,w,A=n[0],E=n[1],R=n[2],z=Math.sqrt(A*A+E*E+R*R);return Math.abs(z)<St.EPSILON?null:(z=1/z,A*=z,E*=z,R*=z,a=Math.sin(r),o=Math.cos(r),i=1-o,s=e[0],l=e[1],u=e[2],h=e[3],f=e[4],c=e[5],v=e[6],p=e[7],d=e[8],x=e[9],M=e[10],y=e[11],g=A*A*i+o,m=E*A*i+R*a,S=R*A*i-E*a,_=A*E*i-R*a,b=E*E*i+o,I=R*E*i+A*a,D=A*R*i+E*a,F=E*R*i-A*a,w=R*R*i+o,t[0]=s*g+f*m+d*S,t[1]=l*g+c*m+x*S,t[2]=u*g+v*m+M*S,t[3]=h*g+p*m+y*S,t[4]=s*_+f*b+d*I,t[5]=l*_+c*b+x*I,t[6]=u*_+v*b+M*I,t[7]=h*_+p*b+y*I,t[8]=s*D+f*F+d*w,t[9]=l*D+c*F+x*w,t[10]=u*D+v*F+M*w,t[11]=h*D+p*F+y*w,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},_t.scalar.rotateX=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),o=e[4],i=e[5],s=e[6],l=e[7],u=e[8],h=e[9],f=e[10],c=e[11];
return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*a+u*n,t[5]=i*a+h*n,t[6]=s*a+f*n,t[7]=l*a+c*n,t[8]=u*a-o*n,t[9]=h*a-i*n,t[10]=f*a-s*n,t[11]=c*a-l*n,t},_t.SIMD.rotateX=function(t,e,r){var n=SIMD.Float32x4.splat(Math.sin(r)),a=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,4),i=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),SIMD.Float32x4.mul(i,n))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,a),SIMD.Float32x4.mul(o,n))),t},_t.rotateX=St.USE_SIMD?_t.SIMD.rotateX:_t.scalar.rotateX,_t.scalar.rotateY=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),o=e[0],i=e[1],s=e[2],l=e[3],u=e[8],h=e[9],f=e[10],c=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*a-u*n,t[1]=i*a-h*n,t[2]=s*a-f*n,t[3]=l*a-c*n,t[8]=o*n+u*a,t[9]=i*n+h*a,t[10]=s*n+f*a,t[11]=l*n+c*a,t},_t.SIMD.rotateY=function(t,e,r){var n=SIMD.Float32x4.splat(Math.sin(r)),a=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,a),SIMD.Float32x4.mul(i,n))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,n),SIMD.Float32x4.mul(i,a))),t},_t.rotateY=St.USE_SIMD?_t.SIMD.rotateY:_t.scalar.rotateY,_t.scalar.rotateZ=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),o=e[0],i=e[1],s=e[2],l=e[3],u=e[4],h=e[5],f=e[6],c=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*a+u*n,t[1]=i*a+h*n,t[2]=s*a+f*n,t[3]=l*a+c*n,t[4]=u*a-o*n,t[5]=h*a-i*n,t[6]=f*a-s*n,t[7]=c*a-l*n,t},_t.SIMD.rotateZ=function(t,e,r){var n=SIMD.Float32x4.splat(Math.sin(r)),a=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),SIMD.Float32x4.mul(i,n))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,a),SIMD.Float32x4.mul(o,n))),t},_t.rotateZ=St.USE_SIMD?_t.SIMD.rotateZ:_t.scalar.rotateZ,_t.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},_t.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},_t.fromRotation=function(t,e,r){var n,a,o,i=r[0],s=r[1],l=r[2],u=Math.sqrt(i*i+s*s+l*l);return Math.abs(u)<St.EPSILON?null:(u=1/u,i*=u,s*=u,l*=u,n=Math.sin(e),a=Math.cos(e),o=1-a,t[0]=i*i*o+a,t[1]=s*i*o+l*n,t[2]=l*i*o-s*n,t[3]=0,t[4]=i*s*o-l*n,t[5]=s*s*o+a,t[6]=l*s*o+i*n,t[7]=0,t[8]=i*l*o+s*n,t[9]=s*l*o-i*n,t[10]=l*l*o+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},_t.fromXRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},_t.fromYRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},_t.fromZRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},_t.fromRotationTranslation=function(t,e,r){var n=e[0],a=e[1],o=e[2],i=e[3],s=n+n,l=a+a,u=o+o,h=n*s,f=n*l,c=n*u,v=a*l,p=a*u,d=o*u,x=i*s,M=i*l,y=i*u;return t[0]=1-(v+d),t[1]=f+y,t[2]=c-M,t[3]=0,t[4]=f-y,t[5]=1-(h+d),t[6]=p+x,t[7]=0,t[8]=c+M,t[9]=p-x,t[10]=1-(h+v),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},_t.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},_t.getRotation=function(t,e){var r=e[0]+e[5]+e[10],n=0;return r>0?(n=2*Math.sqrt(r+1),t[3]=.25*n,t[0]=(e[6]-e[9])/n,t[1]=(e[8]-e[2])/n,t[2]=(e[1]-e[4])/n):e[0]>e[5]&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/n,t[0]=.25*n,t[1]=(e[1]+e[4])/n,t[2]=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/n,t[0]=(e[1]+e[4])/n,t[1]=.25*n,t[2]=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/n,t[0]=(e[8]+e[2])/n,t[1]=(e[6]+e[9])/n,t[2]=.25*n),t},_t.fromRotationTranslationScale=function(t,e,r,n){var a=e[0],o=e[1],i=e[2],s=e[3],l=a+a,u=o+o,h=i+i,f=a*l,c=a*u,v=a*h,p=o*u,d=o*h,x=i*h,M=s*l,y=s*u,g=s*h,m=n[0],S=n[1],_=n[2];return t[0]=(1-(p+x))*m,t[1]=(c+g)*m,t[2]=(v-y)*m,t[3]=0,t[4]=(c-g)*S,t[5]=(1-(f+x))*S,t[6]=(d+M)*S,t[7]=0,t[8]=(v+y)*_,t[9]=(d-M)*_,t[10]=(1-(f+p))*_,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},_t.fromRotationTranslationScaleOrigin=function(t,e,r,n,a){var o=e[0],i=e[1],s=e[2],l=e[3],u=o+o,h=i+i,f=s+s,c=o*u,v=o*h,p=o*f,d=i*h,x=i*f,M=s*f,y=l*u,g=l*h,m=l*f,S=n[0],_=n[1],b=n[2],I=a[0],D=a[1],F=a[2];return t[0]=(1-(d+M))*S,t[1]=(v+m)*S,t[2]=(p-g)*S,t[3]=0,t[4]=(v-m)*_,t[5]=(1-(c+M))*_,t[6]=(x+y)*_,t[7]=0,t[8]=(p+g)*b,t[9]=(x-y)*b,t[10]=(1-(c+d))*b,t[11]=0,t[12]=r[0]+I-(t[0]*I+t[4]*D+t[8]*F),t[13]=r[1]+D-(t[1]*I+t[5]*D+t[9]*F),t[14]=r[2]+F-(t[2]*I+t[6]*D+t[10]*F),t[15]=1,t},_t.fromQuat=function(t,e){var r=e[0],n=e[1],a=e[2],o=e[3],i=r+r,s=n+n,l=a+a,u=r*i,h=n*i,f=n*s,c=a*i,v=a*s,p=a*l,d=o*i,x=o*s,M=o*l;return t[0]=1-f-p,t[1]=h+M,t[2]=c-x,t[3]=0,t[4]=h-M,t[5]=1-u-p,t[6]=v+d,t[7]=0,t[8]=c+x,t[9]=v-d,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},_t.frustum=function(t,e,r,n,a,o,i){var s=1/(r-e),l=1/(a-n),u=1/(o-i);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(a+n)*l,t[10]=(i+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*o*2*u,t[15]=0,t},_t.perspective=function(t,e,r,n,a){var o=1/Math.tan(e/2),i=1/(n-a);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(a+n)*i,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*n*i,t[15]=0,t},_t.perspectiveFromFieldOfView=function(t,e,r,n){var a=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),i=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),l=2/(i+s),u=2/(a+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((i-s)*l*.5),t[9]=(a-o)*u*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t},_t.ortho=function(t,e,r,n,a,o,i){var s=1/(e-r),l=1/(n-a),u=1/(o-i);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*s,t[13]=(a+n)*l,t[14]=(i+o)*u,t[15]=1,t},_t.lookAt=function(t,e,r,n){var a,o,i,s,l,u,h,f,c,v,p=e[0],d=e[1],x=e[2],M=n[0],y=n[1],g=n[2],m=r[0],S=r[1],_=r[2];return Math.abs(p-m)<St.EPSILON&&Math.abs(d-S)<St.EPSILON&&Math.abs(x-_)<St.EPSILON?_t.identity(t):(h=p-m,f=d-S,c=x-_,v=1/Math.sqrt(h*h+f*f+c*c),h*=v,f*=v,c*=v,a=y*c-g*f,o=g*h-M*c,i=M*f-y*h,v=Math.sqrt(a*a+o*o+i*i),v?(v=1/v,a*=v,o*=v,i*=v):(a=0,o=0,i=0),s=f*i-c*o,l=c*a-h*i,u=h*o-f*a,v=Math.sqrt(s*s+l*l+u*u),v?(v=1/v,s*=v,l*=v,u*=v):(s=0,l=0,u=0),t[0]=a,t[1]=s,t[2]=h,t[3]=0,t[4]=o,t[5]=l,t[6]=f,t[7]=0,t[8]=i,t[9]=u,t[10]=c,t[11]=0,t[12]=-(a*p+o*d+i*x),t[13]=-(s*p+l*d+u*x),t[14]=-(h*p+f*d+c*x),t[15]=1,t)},_t.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},_t.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},_t.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},_t.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t},_t.sub=_t.subtract,_t.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},_t.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t},_t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},_t.equals=function(t,e){var r=t[0],n=t[1],a=t[2],o=t[3],i=t[4],s=t[5],l=t[6],u=t[7],h=t[8],f=t[9],c=t[10],v=t[11],p=t[12],d=t[13],x=t[14],M=t[15],y=e[0],g=e[1],m=e[2],S=e[3],_=e[4],b=e[5],I=e[6],D=e[7],F=e[8],w=e[9],A=e[10],E=e[11],R=e[12],z=e[13],P=e[14],C=e[15];return Math.abs(r-y)<=St.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-g)<=St.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(a-m)<=St.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-S)<=St.EPSILON*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(i-_)<=St.EPSILON*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(s-b)<=St.EPSILON*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(l-I)<=St.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(u-D)<=St.EPSILON*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(h-F)<=St.EPSILON*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(f-w)<=St.EPSILON*Math.max(1,Math.abs(f),Math.abs(w))&&Math.abs(c-A)<=St.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(v-E)<=St.EPSILON*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(p-R)<=St.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(d-z)<=St.EPSILON*Math.max(1,Math.abs(d),Math.abs(z))&&Math.abs(x-P)<=St.EPSILON*Math.max(1,Math.abs(x),Math.abs(P))&&Math.abs(M-C)<=St.EPSILON*Math.max(1,Math.abs(M),Math.abs(C))};var bt=_t,It=Mt,Dt={};Dt.create=function(){var t=new It.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},Dt.clone=function(t){var e=new It.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Dt.fromValues=function(t,e,r){var n=new It.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=r,n},Dt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Dt.set=function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},Dt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},Dt.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},Dt.sub=Dt.subtract,Dt.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},Dt.mul=Dt.multiply,Dt.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},Dt.div=Dt.divide,Dt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Dt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Dt.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},Dt.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},Dt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Dt.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},Dt.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},Dt.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return Math.sqrt(r*r+n*n+a*a)},Dt.dist=Dt.distance,Dt.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return r*r+n*n+a*a},Dt.sqrDist=Dt.squaredDistance,Dt.length=function(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)},Dt.len=Dt.length,Dt.squaredLength=function(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n},Dt.sqrLen=Dt.squaredLength,Dt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Dt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Dt.normalize=function(t,e){var r=e[0],n=e[1],a=e[2],o=r*r+n*n+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},Dt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},Dt.cross=function(t,e,r){var n=e[0],a=e[1],o=e[2],i=r[0],s=r[1],l=r[2];return t[0]=a*l-o*s,t[1]=o*i-n*l,t[2]=n*s-a*i,t},Dt.lerp=function(t,e,r,n){var a=e[0],o=e[1],i=e[2];return t[0]=a+n*(r[0]-a),t[1]=o+n*(r[1]-o),t[2]=i+n*(r[2]-i),t},Dt.hermite=function(t,e,r,n,a,o){var i=o*o,s=i*(2*o-3)+1,l=i*(o-2)+o,u=i*(o-1),h=i*(3-2*o);return t[0]=e[0]*s+r[0]*l+n[0]*u+a[0]*h,t[1]=e[1]*s+r[1]*l+n[1]*u+a[1]*h,t[2]=e[2]*s+r[2]*l+n[2]*u+a[2]*h,t},Dt.bezier=function(t,e,r,n,a,o){var i=1-o,s=i*i,l=o*o,u=s*i,h=3*o*s,f=3*l*i,c=l*o;return t[0]=e[0]*u+r[0]*h+n[0]*f+a[0]*c,t[1]=e[1]*u+r[1]*h+n[1]*f+a[1]*c,t[2]=e[2]*u+r[2]*h+n[2]*f+a[2]*c,t},Dt.random=function(t,e){e=e||1;var r=2*It.RANDOM()*Math.PI,n=2*It.RANDOM()-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*a,t[1]=Math.sin(r)*a,t[2]=n*e,t},Dt.transformMat4=function(t,e,r){var n=e[0],a=e[1],o=e[2],i=r[3]*n+r[7]*a+r[11]*o+r[15];return i=i||1,t[0]=(r[0]*n+r[4]*a+r[8]*o+r[12])/i,t[1]=(r[1]*n+r[5]*a+r[9]*o+r[13])/i,t[2]=(r[2]*n+r[6]*a+r[10]*o+r[14])/i,t},Dt.transformMat3=function(t,e,r){var n=e[0],a=e[1],o=e[2];return t[0]=n*r[0]+a*r[3]+o*r[6],t[1]=n*r[1]+a*r[4]+o*r[7],t[2]=n*r[2]+a*r[5]+o*r[8],t},Dt.transformQuat=function(t,e,r){var n=e[0],a=e[1],o=e[2],i=r[0],s=r[1],l=r[2],u=r[3],h=u*n+s*o-l*a,f=u*a+l*n-i*o,c=u*o+i*a-s*n,v=-i*n-s*a-l*o;return t[0]=h*u+v*-i+f*-l-c*-s,t[1]=f*u+v*-s+c*-i-h*-l,t[2]=c*u+v*-l+h*-s-f*-i,t},Dt.rotateX=function(t,e,r,n){var a=[],o=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],o[0]=a[0],o[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),o[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},Dt.rotateY=function(t,e,r,n){var a=[],o=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],o[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),o[1]=a[1],o[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},Dt.rotateZ=function(t,e,r,n){var a=[],o=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],o[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),o[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),o[2]=a[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},Dt.forEach=function(){var t=Dt.create();return function(e,r,n,a,o,i){var s,l;for(r||(r=3),n||(n=0),l=a?Math.min(a*r+n,e.length):e.length,s=n;s<l;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,i),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),Dt.angle=function(t,e){var r=Dt.fromValues(t[0],t[1],t[2]),n=Dt.fromValues(e[0],e[1],e[2]);Dt.normalize(r,r),Dt.normalize(n,n);var a=Dt.dot(r,n);return a>1?0:Math.acos(a)},Dt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Dt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Dt.equals=function(t,e){var r=t[0],n=t[1],a=t[2],o=e[0],i=e[1],s=e[2];return Math.abs(r-o)<=It.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-i)<=It.EPSILON*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(a-s)<=It.EPSILON*Math.max(1,Math.abs(a),Math.abs(s))};var Ft=Dt,wt=Mt,At={};At.create=function(){var t=new wt.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},At.clone=function(t){var e=new wt.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},At.fromValues=function(t,e,r,n){var a=new wt.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a},At.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},At.set=function(t,e,r,n,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t},At.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},At.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t},At.sub=At.subtract,At.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t},At.mul=At.multiply,At.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t},At.div=At.divide,At.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},At.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},At.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},At.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},At.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},At.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},At.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},At.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(r*r+n*n+a*a+o*o)},At.dist=At.distance,At.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],o=e[3]-t[3];return r*r+n*n+a*a+o*o},At.sqrDist=At.squaredDistance,At.length=function(t){var e=t[0],r=t[1],n=t[2],a=t[3];return Math.sqrt(e*e+r*r+n*n+a*a)},At.len=At.length,At.squaredLength=function(t){var e=t[0],r=t[1],n=t[2],a=t[3];return e*e+r*r+n*n+a*a},At.sqrLen=At.squaredLength,At.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},At.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},At.normalize=function(t,e){var r=e[0],n=e[1],a=e[2],o=e[3],i=r*r+n*n+a*a+o*o;return i>0&&(i=1/Math.sqrt(i),t[0]=r*i,t[1]=n*i,t[2]=a*i,t[3]=o*i),t},At.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},At.lerp=function(t,e,r,n){var a=e[0],o=e[1],i=e[2],s=e[3];return t[0]=a+n*(r[0]-a),t[1]=o+n*(r[1]-o),t[2]=i+n*(r[2]-i),t[3]=s+n*(r[3]-s),t},At.random=function(t,e){return e=e||1,t[0]=wt.RANDOM(),t[1]=wt.RANDOM(),t[2]=wt.RANDOM(),t[3]=wt.RANDOM(),At.normalize(t,t),At.scale(t,t,e),t},At.transformMat4=function(t,e,r){var n=e[0],a=e[1],o=e[2],i=e[3];return t[0]=r[0]*n+r[4]*a+r[8]*o+r[12]*i,t[1]=r[1]*n+r[5]*a+r[9]*o+r[13]*i,t[2]=r[2]*n+r[6]*a+r[10]*o+r[14]*i,t[3]=r[3]*n+r[7]*a+r[11]*o+r[15]*i,t},At.transformQuat=function(t,e,r){var n=e[0],a=e[1],o=e[2],i=r[0],s=r[1],l=r[2],u=r[3],h=u*n+s*o-l*a,f=u*a+l*n-i*o,c=u*o+i*a-s*n,v=-i*n-s*a-l*o;return t[0]=h*u+v*-i+f*-l-c*-s,t[1]=f*u+v*-s+c*-i-h*-l,t[2]=c*u+v*-l+h*-s-f*-i,t[3]=e[3],t},At.forEach=function(){var t=At.create();return function(e,r,n,a,o,i){var s,l;for(r||(r=4),n||(n=0),l=a?Math.min(a*r+n,e.length):e.length,s=n;s<l;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,i),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),At.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},At.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},At.equals=function(t,e){var r=t[0],n=t[1],a=t[2],o=t[3],i=e[0],s=e[1],l=e[2],u=e[3];return Math.abs(r-i)<=wt.EPSILON*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-s)<=wt.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(a-l)<=wt.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-u)<=wt.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))};var Et=At,Rt=Mt,zt=mt,Pt=Ft,Ct=Et,Lt={};Lt.create=function(){var t=new Rt.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Lt.rotationTo=function(){var t=Pt.create(),e=Pt.fromValues(1,0,0),r=Pt.fromValues(0,1,0);return function(n,a,o){var i=Pt.dot(a,o);return i<-.999999?(Pt.cross(t,e,a),Pt.length(t)<1e-6&&Pt.cross(t,r,a),Pt.normalize(t,t),Lt.setAxisAngle(n,t,Math.PI),n):i>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Pt.cross(t,a,o),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+i,Lt.normalize(n,n))}}(),Lt.setAxes=function(){var t=zt.create();return function(e,r,n,a){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],Lt.normalize(e,Lt.fromMat3(e,t))}}(),Lt.clone=Ct.clone,Lt.fromValues=Ct.fromValues,Lt.copy=Ct.copy,Lt.set=Ct.set,Lt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Lt.setAxisAngle=function(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t},Lt.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),n=Math.sin(r/2);return 0!=n?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r},Lt.add=Ct.add,Lt.multiply=function(t,e,r){var n=e[0],a=e[1],o=e[2],i=e[3],s=r[0],l=r[1],u=r[2],h=r[3];return t[0]=n*h+i*s+a*u-o*l,t[1]=a*h+i*l+o*s-n*u,t[2]=o*h+i*u+n*l-a*s,t[3]=i*h-n*s-a*l-o*u,t},Lt.mul=Lt.multiply,Lt.scale=Ct.scale,Lt.rotateX=function(t,e,r){r*=.5;var n=e[0],a=e[1],o=e[2],i=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=n*l+i*s,t[1]=a*l+o*s,t[2]=o*l-a*s,t[3]=i*l-n*s,t},Lt.rotateY=function(t,e,r){r*=.5;var n=e[0],a=e[1],o=e[2],i=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=n*l-o*s,t[1]=a*l+i*s,t[2]=o*l+n*s,t[3]=i*l-a*s,t},Lt.rotateZ=function(t,e,r){r*=.5;var n=e[0],a=e[1],o=e[2],i=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=n*l+a*s,t[1]=a*l-n*s,t[2]=o*l+i*s,t[3]=i*l-o*s,t},Lt.calculateW=function(t,e){var r=e[0],n=e[1],a=e[2];return t[0]=r,t[1]=n,t[2]=a,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-a*a)),t},Lt.dot=Ct.dot,Lt.lerp=Ct.lerp,Lt.slerp=function(t,e,r,n){var a,o,i,s,l,u=e[0],h=e[1],f=e[2],c=e[3],v=r[0],p=r[1],d=r[2],x=r[3];return o=u*v+h*p+f*d+c*x,o<0&&(o=-o,v=-v,p=-p,d=-d,x=-x),1-o>1e-6?(a=Math.acos(o),i=Math.sin(a),s=Math.sin((1-n)*a)/i,l=Math.sin(n*a)/i):(s=1-n,l=n),t[0]=s*u+l*v,t[1]=s*h+l*p,t[2]=s*f+l*d,t[3]=s*c+l*x,t},Lt.sqlerp=function(){var t=Lt.create(),e=Lt.create();return function(r,n,a,o,i,s){return Lt.slerp(t,n,i,s),Lt.slerp(e,a,o,s),Lt.slerp(r,t,e,2*s*(1-s)),r}}(),Lt.invert=function(t,e){var r=e[0],n=e[1],a=e[2],o=e[3],i=r*r+n*n+a*a+o*o,s=i?1/i:0;return t[0]=-r*s,t[1]=-n*s,t[2]=-a*s,t[3]=o*s,t},Lt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Lt.length=Ct.length,Lt.len=Lt.length,Lt.squaredLength=Ct.squaredLength,Lt.sqrLen=Lt.squaredLength,Lt.normalize=Ct.normalize,Lt.fromMat3=function(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var o=(a+1)%3,i=(a+2)%3;r=Math.sqrt(e[3*a+a]-e[3*o+o]-e[3*i+i]+1),t[a]=.5*r,r=.5/r,t[3]=(e[3*o+i]-e[3*i+o])*r,t[o]=(e[3*o+a]+e[3*a+o])*r,t[i]=(e[3*i+a]+e[3*a+i])*r}return t},Lt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Lt.exactEquals=Ct.exactEquals,Lt.equals=Ct.equals;var kt=Mt,Tt={};Tt.create=function(){var t=new kt.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},Tt.clone=function(t){var e=new kt.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Tt.fromValues=function(t,e){var r=new kt.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},Tt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Tt.set=function(t,e,r){return t[0]=e,t[1]=r,t},Tt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},Tt.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t},Tt.sub=Tt.subtract,Tt.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t},Tt.mul=Tt.multiply,Tt.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t},Tt.div=Tt.divide,Tt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Tt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Tt.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},Tt.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},Tt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Tt.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},Tt.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t},Tt.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)},Tt.dist=Tt.distance,Tt.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n},Tt.sqrDist=Tt.squaredDistance,Tt.length=function(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)},Tt.len=Tt.length,Tt.squaredLength=function(t){var e=t[0],r=t[1];return e*e+r*r},Tt.sqrLen=Tt.squaredLength,Tt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Tt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Tt.normalize=function(t,e){var r=e[0],n=e[1],a=r*r+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a),t},Tt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Tt.cross=function(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t},Tt.lerp=function(t,e,r,n){var a=e[0],o=e[1];return t[0]=a+n*(r[0]-a),t[1]=o+n*(r[1]-o),t},Tt.random=function(t,e){e=e||1;var r=2*kt.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},Tt.transformMat2=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[2]*a,t[1]=r[1]*n+r[3]*a,t},Tt.transformMat2d=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[2]*a+r[4],t[1]=r[1]*n+r[3]*a+r[5],t},Tt.transformMat3=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[3]*a+r[6],t[1]=r[1]*n+r[4]*a+r[7],t},Tt.transformMat4=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[4]*a+r[12],t[1]=r[1]*n+r[5]*a+r[13],t},Tt.forEach=function(){var t=Tt.create();return function(e,r,n,a,o,i){var s,l;for(r||(r=2),n||(n=0),l=a?Math.min(a*r+n,e.length):e.length,s=n;s<l;s+=r)t[0]=e[s],t[1]=e[s+1],o(t,t,i),e[s]=t[0],e[s+1]=t[1];return e}}(),Tt.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Tt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Tt.equals=function(t,e){var r=t[0],n=t[1],a=e[0],o=e[1];return Math.abs(r-a)<=kt.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=kt.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))};var Bt=bt,Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nt=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},qt=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):n(t,e))},Ut=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},Vt=function(t){function r(){return Nt(this,r),Ut(this,t.apply(this,arguments))}return qt(r,t),r.prototype.createCanvas=function(){if(!this.canvas){var t=this.getMap(),r=t.getSize(),n=e.Browser.retina?2:1;this.canvas=e.Canvas.createCanvas(n*r.width,n*r.height,t.CanvasClass);var a=this.gl=this._createGLContext(this.canvas,this.layer.options.glOptions);a.clearColor(0,0,0,0),a.verbose=!0,a.blendFunc(a.SRC_ALPHA,a.ONE),a.enable(a.BLEND),a.disable(a.DEPTH_TEST),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.onCanvasCreate&&this.onCanvasCreate(),this.buffer=e.Canvas.createCanvas(this.canvas.width,this.canvas.height,t.CanvasClass),this.context=this.buffer.getContext("2d")}},r.prototype.resizeCanvas=function(t){if(this.canvas){var r=void 0;r=t?t:this.getMap().getSize();var n=e.Browser.retina?2:1;this.canvas.height=n*r.height,this.canvas.width=n*r.width,this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}},r.prototype.clearCanvas=function(){this.canvas&&(this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.context.clearRect(0,0,this.canvas.width,this.canvas.height))},r.prototype.prepareCanvas=function(){return this.canvas?this.clearCanvas():this.createCanvas(),this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null},r.prototype.mergeSprites=function(t,r){if(!t||0===t.length)return null;var n=2,a=0,o=0;t.forEach(function(t){if(r){var e=Math.max(t.canvas.width,t.canvas.height);a+=e+n,e>o&&(o=e)}else a+=t.canvas.width+n,t.canvas.height>o&&(o=t.canvas.height)}),a=Math.pow(2,Math.ceil(Math.log(a)/Math.LN2)),o=Math.pow(2,Math.ceil(Math.log(o)/Math.LN2));var i=this.getMap(),s=e.Canvas.createCanvas(a,o,i.CanvasClass),l=s.getContext("2d"),u=[],h=[],f=[],c=0;t.forEach(function(t){var e=0,i=0,s=void 0;if(r){var v=t.canvas.width,p=t.canvas.height;s=Math.max(v,p),e=s>v?(s-v)/2:0,i=s>p?(s-p)/2:0,u.push([c/a,s/a,s/o,s]),f.push([v,p])}else s=t.canvas.width,u.push([c/a,t.canvas.width/a,t.canvas.height/o]);l.drawImage(t.canvas,c+e,i),h.push(t.offset),c+=s+n});var v={canvas:s,texCoords:u,offsets:h};return r&&(v.sizes=f),v},r.prototype.createBuffer=function(){var t=this.gl,e=t.createBuffer();if(!e)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(e),e},r.prototype.enableVertexAttrib=function(t){var e=this.gl;if(Array.isArray(t[0])){for(var r=new Float32Array([0,0,0]),n=r.BYTES_PER_ELEMENT,a=0,o=0;o<t.length;o++)a+=t[o][1]||0;for(var i=0,s=0;s<t.length;s++){var l=e.getAttribLocation(e.program,t[s][0]);if(l<0)throw new Error("Failed to get the storage location of "+t[s][0]);e.vertexAttribPointer(l,t[s][1],e[t[s][2]||"FLOAT"],!1,n*a,n*i),i+=t[s][1]||0,e.enableVertexAttribArray(l)}}else{var u=e.getAttribLocation(e.program,t[0]);e.vertexAttribPointer(u,t[1],e[t[2]||"FLOAT"],!1,0,0),e.enableVertexAttribArray(u)}},r.prototype.onRemove=function(){var t=this.gl;this._buffers&&(this._buffers.forEach(function(e){t.deleteBuffer(e)}),delete this._buffers)},r.prototype.createProgram=function(t,e,r){var n=this.gl,a=this._compileShader(n,n.VERTEX_SHADER,t),o=this._compileShader(n,n.FRAGMENT_SHADER,e);if(!a||!o)return null;var i=n.createProgram();if(!i)return null;n.attachShader(i,a),n.attachShader(i,o),n.linkProgram(i);var s=n.getProgramParameter(i,n.LINK_STATUS);if(!s){var l=n.getProgramInfoLog(i);throw n.deleteProgram(i),n.deleteShader(o),n.deleteShader(a),new Error("Failed to link program: "+l)}return this._initUniforms(i,r),i},r.prototype.useProgram=function(t){var e=this.gl;return e.useProgram(t),e.program=t,this},r.prototype.loadTexture=function(t,e){var r=this.gl,n=r.createTexture();if(!n)throw new Error("Failed to create the texture object");return e||(e=0),r.activeTexture(r["TEXTURE"+e]),r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),n},r.prototype.enableSampler=function(t,e){var r=this.gl,n=this._getUniform(r.program,t);return e||(e=0),r.uniform1i(n,e),n},r.prototype.calcMatrices=function(){var t=this.getMap(),r=t.getSize(),n=t.getScale(),a=t._prjToPoint(t._getPrjCenter(),t.getMaxZoom()),o=t.getFov()*Math.PI/180,i=.5/Math.tan(o/2)*r.height*n,s=Bt.create();return Bt.perspective(s,o,r.width/r.height,1,i),e.Util.isNode||Bt.scale(s,s,[1,-1,1]),Bt.translate(s,s,[0,0,-i]),Bt.rotateX(s,s,t.getPitch()*Math.PI/180),Bt.rotateZ(s,s,-t.getBearing()*Math.PI/180),Bt.translate(s,s,[-a.x,-a.y,0]),s},r.prototype.getCanvasImage=function(){var e=t.prototype.getCanvasImage.call(this);if(e&&e.image){var r=e.image;this.buffer.width===r.width&&this.buffer.height===r.height&&this._preserveBuffer||(this.buffer.width=r.width,this.buffer.height=r.height),this._preserveBuffer||this.context.drawImage(r,0,0),e.image=this.buffer}return e},r.prototype.onZoomStart=function(){this._preserveBuffer=!0,t.prototype.onZoomStart.apply(this,arguments)},r.prototype.onZoomEnd=function(){this._preserveBuffer=!1,t.prototype.onZoomEnd.apply(this,arguments)},r.prototype._createGLContext=function(t,r){for(var n=e.Util.extend({alpha:!0,antialias:!0,preserveDrawingBuffer:!0
},r),a=["webgl","experimental-webgl","webkit-3d","moz-webgl"],o=null,i=0;i<a.length;++i){try{o=t.getContext(a[i],n)}catch(t){}if(o)break}return o},r.prototype._compileShader=function(t,e,r){var n=t.createShader(e);if(null==n)throw new Error("unable to create shader");t.shaderSource(n,r),t.compileShader(n);var a=t.getShaderParameter(n,t.COMPILE_STATUS);if(!a){var o=t.getShaderInfoLog(n);throw t.deleteShader(n),new Error("Failed to compile shader: "+o)}return n},r.prototype._initUniforms=function(t,r){for(var n=["u_sprite","u_styles"],a=0;a<r.length;a++){var o=r[a],i=o;e.Util.isNode&&n.indexOf(o)!==-1&&(i=o+"[0]"),t[o]=this._getUniform(t,i)}},r.prototype._getUniform=function(t,e){var r=this.gl,n=r.getUniformLocation(t,e);if(!n)throw new Error("Failed to get the storage location of "+n);return n},r}(e.renderer.CanvasRenderer),Yt=function(t){function e(r,n,a){Nt(this,e);var o=Ut(this,t.call(this,a));return o.gl=r,o.map=n,o}return qt(e,t),e}(e.Class),jt=function(){function t(e,r){Nt(this,t),this.resources=e,this.options=r||{},this.atlas={}}return t.prototype.getAtlas=function(t,e){var r=JSON.stringify(t)+"_"+e;if(!this.atlas[r]){var n=this.addAtlas(t,e);n&&(this.atlas[r]=n)}return this.atlas[r]},t.prototype.addAtlas=function(t,r){if(!t.lineDasharray&&!t.linePatternFile)return null;var n=this._getSize(t,r,this.resources),a=this._createCanvas(n);if(!a)throw new Error("can not initialize canvas container.");var o=a.getContext("2d");return e.Canvas.prepareCanvas(o,t,this.resources),o.moveTo(0,n[1]/2),o.lineTo(n[0],n[1]/2),o.stroke(),{canvas:a,offset:new e.Point(0,0)}},t.prototype._getSize=function(t,e,r){var n=0,a=0,o=t.lineDasharray;if(o){for(var i=0;i<o.length;i++)n+=o[i];o.length%2===1&&(n*=2),a=null==t.lineWidth?2:t.lineWidth}if(t.linePatternFile){var s=r.getImage(t.linePatternFile);s.width>n&&(n=s.width),s.height>a&&(a=s.height)}return[n,a]},t.prototype._createCanvas=function(t){if(this.options.canvasClass)return new this.options.canvasClass(t[0],t[1]);if("undefined"!=typeof document){var e=document.createElement("canvas");return e.width=t[0],e.height=t[1],e}return null},t}(),Zt=a;a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=e*this.x-r*this.y,a=r*this.x+e*this.y;return this.x=n,this.y=a,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),a=e.x+r*(this.x-e.x)-n*(this.y-e.y),o=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=a,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t};var Wt={project:!0},Gt=function(t){function r(e,n,a){Nt(this,r);var o=Ut(this,t.call(this,e,n,a));return o.vertexArray=[],o.normalArray=[],o.elementArray=[],o.styleArray=[],o.distance=0,o}return qt(r,t),r.prototype.getArrays=function(){return{vertexArray:this.vertexArray,normalArray:this.normalArray,elementArray:this.elementArray,styleArray:this.styleArray}},r.prototype.addLine=function(t,r){if(!t)return this;if(r.symbol.lineWidth<=0||r.symbol.lineOpacity<=0)return this;var n=this.elementArray.length,a=this._getVertice(t);if(a[0]&&Array.isArray(a[0][0])){for(var o=0,i=a.length;o<i;o++)this.addLine(a[o],r);return this}this._prepareToAdd();for(var s=this.map.getMaxZoom(),l=void 0,u=void 0,h=0,f=a.length;h<f;h++){var c=a[h];this.options.project&&(c=this.map.coordinateToPoint(new e.Coordinate(c),s).toArray()),l=Zt.convert(c),h<f-1?(c=a[h+1],this.options.project&&(c=this.map.coordinateToPoint(new e.Coordinate(c),s).toArray()),u=Zt.convert(c)):u=null,this.addCurrentVertex(l,u)}var v=this.elementArray.length-n;return this._addTexCoords(v,r),this},r.prototype.addCurrentVertex=function(t,e){if(!this.preVertex)return this.e1=this.e2=this.e3=-1,this._waitForLeftCap=!0,void(this.preVertex=t);var r=t.sub(this.preVertex)._unit()._perp()._mult(-1),n=void 0;e&&(n=e.sub(t)._unit()._perp()._mult(-1));var a=this._getStartNormal(r,this.preNormal);if(this._addLineEndVertexs(this.preVertex,a,this.distance),this.distance+=t.dist(this.preVertex),!e){var o=this._getEndNormal(r,n);this._addLineEndVertexs(t,o,this.distance)}this.preNormal=r,this.preVertex=t},r.prototype._prepareToAdd=function(){this.distance=0,delete this.preVertex,delete this.preNormal},r.prototype._addLineEndVertexs=function(t,e,r){var n=e.normal[0];this.e3=this._addVertex(t,n,r),this.e1>=0&&this.e2>=0&&this.elementArray.push(this.e1,this.e2,this.e3),this.e1=this.e2,this.e2=this.e3,n=e.normal[1],this.e3=this._addVertex(t,n,r),this.e1>=0&&this.e2>=0&&this.elementArray.push(this.e1,this.e2,this.e3),this.e1=this.e2,this.e2=this.e3},r.prototype._addVertex=function(t,e,r){this.vertexArray.push(t.x,t.y);var n=[this._precise(e.x),this._precise(e.y),r],a=this.normalArray.length/n.length;return Array.prototype.push.apply(this.normalArray,n),a},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._addTexCoords=function(t,e){var r=(e.symbol.lineWidth||2)/2*100+10*(e.symbol.lineOpacity||1);r=1e4*r+e.index;for(var n=0;n<t;n++)this.styleArray.push(r)},r.prototype._getStartNormal=function(t,e){return this._getJoinNormal(t,e,t)},r.prototype._getEndNormal=function(t,e){return this._getJoinNormal(t,t,e)},r.prototype._getJoinNormal=function(t,e,r){if(!e||!r)return{normal:[t,t.mult(-1)]};var n=e.add(r)._unit(),a=n.x*r.x+n.y*r.y,o=1/a;return n._mult(o),{normal:[n,n.mult(-1)]}},r.prototype._precise=function(t){return Math.round(1e7*t)/1e7},r}(Yt);Gt.mergeOptions(Wt);var Xt=o;o.deviation=function(t,e,r,n){var a=e&&e.length,o=a?e[0]*r:t.length,i=Math.abs(C(t,0,o,r));if(a)for(var s=0,l=e.length;s<l;s++){var u=e[s]*r,h=s<l-1?e[s+1]*r:t.length;i-=Math.abs(C(t,u,h,r))}var f=0;for(s=0;s<n.length;s+=3){var c=n[s]*r,v=n[s+1]*r,p=n[s+2]*r;f+=Math.abs((t[c]-t[p])*(t[v+1]-t[c+1])-(t[c]-t[v])*(t[p+1]-t[c+1]))}return 0===i&&0===f?0:Math.abs((f-i)/i)},o.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,a=0;a<t.length;a++){for(var o=0;o<t[a].length;o++)for(var i=0;i<e;i++)r.vertices.push(t[a][o][i]);a>0&&(n+=t[a-1].length,r.holes.push(n))}return r};var Jt={project:!0},Ht=function(t){function r(e,n,a){Nt(this,r);var o=Ut(this,t.call(this,e,n,a));return o.vertexArray=[],o.elementArray=[],o.styleArray=[],o}return qt(r,t),r.prototype.getArrays=function(){return console.log("polygon.vertex",this.vertexArray.length),console.log("polygon.element",this.elementArray.length),console.log("polygon.style",this.styleArray.length),{vertexArray:this.vertexArray,elementArray:this.elementArray,styleArray:this.styleArray}},r.prototype.addPolygon=function(t,r){var n=this;if(!t)return this;if(r.symbol.polygonOpacity<=0)return this;var a=this._getVertice(t);if(a[0]&&Array.isArray(a[0][0])&&Array.isArray(a[0][0][0])){for(var o=0,i=a.length;o<i;o++)this.addPolygon(a[o],r);return this}a.forEach(function(t){t.length&&(n._equalCoord(t[0],t[t.length-1])||t.push(t[0]))});var s=this.map.getMaxZoom(),l=Xt.flatten(a);if(this.options.project){for(var u=[],h=void 0,f=0,c=l.vertices.length;f<c;f+=2)h=this.map.coordinateToPoint(new e.Coordinate(l.vertices[f],l.vertices[f+1]),s),u.push(h.x,h.y);l.vertices=u}var v=Xt(l.vertices,l.holes,2);if(v.length<=2)return this;var p=Xt.deviation(l.vertices,l.holes,2,v);if(Math.round(1e3*p)/1e3!==0)return console&&console.warn("Failed triangluation."),this;var d=this.vertexArray.length/2;return d>0&&(v=v.map(function(t){return t+d})),this.vertexArray.push.apply(this.vertexArray,l.vertices),this.elementArray.push.apply(this.elementArray,v),this._addTexCoords(v.length,r),this},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._addTexCoords=function(t,e){for(var r=100*e.index+10*(e.symbol.polygonOpacity||1),n=0;n<t;n++)this.styleArray.push(r)},r.prototype._equalCoord=function(t,e){return t[0]===e[0]&&t[1]===e[1]},r}(Yt);Ht.mergeOptions(Jt);var Kt="#ifdef GL_ES\nprecision mediump float;\n#else\n#define lowp\n#define mediump\n#define highp\n#endif\n\nuniform float u_blur;\nuniform vec2 u_tex_size;\n\n// varying lowp vec4 v_color;\n// varying vec2 v_linenormal;\nvarying vec4 v_texcoord;\nvarying float v_opacity;\nvarying float v_linewidth;\nvarying float v_scale;\nvarying float v_texture_normal;\nvarying float v_linesofar;\n// varying float v_ruler;\n\nuniform sampler2D u_image;\n\nvoid main() {\n    vec4 color;\n    if (v_texcoord.q == -1.0) {\n        // is a texture fragment\n        float linesofar = v_linesofar / v_scale;\n        float texWidth = u_tex_size.x * v_texcoord.t;\n        float x = v_texcoord.s + mod(linesofar, texWidth) / texWidth * v_texcoord.t;\n        float y = (v_texture_normal + 1.0) / 2.0 * v_texcoord.p;\n\n        color = texture2D(u_image, vec2(x, y));\n    } else {\n        // a color fragment\n        color = v_texcoord;\n    }\n    float alpha = 1.0;\n    gl_FragColor = color * (alpha * v_opacity);\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}",Qt=e.Browser.ie||e.Browser.edge?504:e.Util.isNode?1014:3900,$t="#ifdef GL_ES\nprecision highp float;\n#else\n#define lowp\n#define mediump\n#define highp\n#endif\n\nattribute vec4 a_pos;\nattribute mediump vec2 a_normal;\n// attribute mediump vec2 a_linenormal;\nattribute float a_linesofar;\n// (line_width * 100 + opacity * 10) * 10000 + tex_idx\nattribute float a_style;\n// attribute float a_seglen;\n\nuniform mat4 u_matrix;\nuniform float u_scale;\nuniform float u_styles["+Qt+"];\n\nvarying vec2 v_linenormal;\nvarying float v_linewidth;\nvarying float v_opacity;\nvarying vec4 v_texcoord;\nvarying float v_scale;\nvarying float v_texture_normal;\n\nvarying float v_linesofar;\n// varying float v_ruler;\n\nvoid main() {\n    int tex_idx = int(mod(a_style, 10000.0));\n    float s = floor(a_style / 10000.0);\n    v_opacity = mod(s, 10.0) / 10.0;\n    if (v_opacity == 0.0) {\n        v_opacity = 1.0;\n    }\n    v_linewidth = s / 100.0;\n    v_texcoord = vec4(u_styles[tex_idx], u_styles[tex_idx + 1], u_styles[tex_idx + 2], u_styles[tex_idx + 3]);\n\n    v_scale = u_scale;\n\n    // v_linenormal = a_linenormal;\n\n    vec4 pos = a_pos;\n    pos.x += a_normal.x * v_linewidth * u_scale;\n    pos.y += a_normal.y * v_linewidth * u_scale;\n\n    // add linesofar with corner length caused by line-join\n    v_linesofar = a_linesofar;\n\n\n    gl_Position = u_matrix * pos;\n    if (a_normal.y == 0.0) {\n        // with an upside down straight line, a_normal.y is always 0, use a_normal.x instead\n        v_texture_normal = -sign(a_normal.x);\n    } else {\n        //\n        v_texture_normal = sign(a_normal.y);\n    }\n\n}",te="\nprecision mediump float;\nuniform sampler2D u_sampler;\nvarying vec3 v_texCoord;\nvoid main() {\n    gl_FragColor = texture2D(u_sampler, vec2(v_texCoord[0] + gl_PointCoord[0] * v_texCoord[1], 1.0 + gl_PointCoord[1] * v_texCoord[2]));\n}",ee="\n// marker's 2d point at max zoom\nattribute vec4 a_pos;\n// texture idx in u_sprite\nattribute float a_sprite_idx;\nuniform mat4 u_matrix;\n// scale of current zoom\nuniform float u_scale;\n// sprites, an array of sprites\n// a sprite has 6 integers:\n// 0 : northwest's x, 1 : width, 2: height, 3: sprite size, 4: offset x, 5: offset y\n// array's length is not dynamic, support maximum count / 6 sprites\nuniform float u_sprite["+Qt+"];\nvarying vec3 v_texCoord;\nvoid main() {\n  int idx = int(a_sprite_idx);\n  float size = u_sprite[idx + 3];\n  vec2 textOffset = vec2(u_sprite[idx + 4], u_sprite[idx + 5]);\n  vec4 pos = vec4(a_pos.x + textOffset.x * u_scale, a_pos.y + textOffset.y * u_scale, a_pos.z, a_pos.w);\n  gl_Position = u_matrix * pos;\n  gl_PointSize = size;\n  // texture coord\n  v_texCoord = vec3(u_sprite[idx], u_sprite[idx + 1], u_sprite[idx + 2]);\n}",re="\nprecision mediump float;\n\nvarying vec4 v_texcoord;\nvarying float v_opacity;\nvoid main() {\n    gl_FragColor = v_texcoord * v_opacity;\n}",ne="attribute vec4 a_pos;\n//tex_idx * 100 + opacity * 10\nattribute float a_style;\n\nuniform mat4 u_matrix;\nuniform float u_styles["+Qt+"];\n\nvarying float v_opacity;\nvarying vec4 v_texcoord;\n\nvoid main() {\n  int tex_idx = int(floor(a_style / 100.0));\n  v_opacity = mod(a_style, 100.0) / 10.0;\n  v_texcoord = vec4(u_styles[tex_idx], u_styles[tex_idx + 1], u_styles[tex_idx + 2], u_styles[tex_idx + 3]);\n\n  gl_Position = u_matrix * a_pos;\n}",ae={line:{fragmentSource:Kt,vertexSource:$t},point:{fragmentSource:te,vertexSource:ee},polygon:{fragmentSource:re,vertexSource:ne}},oe=Object.freeze({WebglRenderer:Vt,Shader:ae,Painter:Yt,LineAtlas:jt,LinePainter:Gt,PolygonPainter:Ht}),ie={renderer:"webgl"},se=function(t){function r(n,a,o){Nt(this,r);var i=e.Util.extend({},o),s=void 0;i.style&&(s=i.style,delete i.style);var l=Ut(this,t.call(this,n,i));return l.data=a,s&&l.setStyle(s),l}return qt(r,t),r.fromJSON=function(t){if(!t||t.type!==this.getJSONType())return null;var e=this.prototype.constructor,r=new e(t.id,t.data,t.options);return t.style&&r.setStyle(t.style),r},r.prototype.toJSON=function(){var t={type:this.getJSONType(),data:this.data,id:this.getId()},e=this.config(),r=this.getStyle();return e&&(t.options=e),r&&(t.style=r),t},r.prototype.setStyle=function(t){return Array.isArray(t)||(t=[t]),this._style=t,this._cookedStyles=e.MapboxUtil.compileStyle(t),this.fire("setstyle",{style:t}),this},r.prototype.getStyle=function(){return this._style},r}(e.Layer);se.mergeOptions(ie);var le=L,ue=O,he=N,fe=le,ce=ue,ve=he,pe=U;V.prototype={range:function(t,e,r,n){return ce(this.ids,this.coords,t,e,r,n,this.nodeSize)},within:function(t,e,r){return ve(this.ids,this.coords,t,e,r,this.nodeSize)}};var de=function(t){function e(){return Nt(this,e),Ut(this,t.apply(this,arguments))}return qt(e,t),e.prototype.identify=function(t,e){var r=this._getRenderer();return r?r.identify(t,e):null},e}(se);de.registerJSONType("BigPointLayer"),de.registerRenderer("webgl",function(t){function r(e){Nt(this,r);var n=Ut(this,t.call(this,e));return n._needCheckStyle=!0,n._needCheckSprites=!0,n._registerEvents(),n}return qt(r,t),r.prototype.checkResources=function(){if(!this._needCheckStyle)return[];var t=[];return this.layer.getStyle()&&this.layer.getStyle().forEach(function(r){var n=e.Util.getExternalResources(r.symbol,!0);n&&t.push(n)}),this._needCheckStyle=!1,this._needCheckSprites=!0,this._textureLoaded=!1,t},r.prototype.onCanvasCreate=function(){var t=this.gl,e=["u_matrix","u_scale","u_sprite"],r=this.createProgram(ae.point.vertexSource,ae.point.fragmentSource,e);this.useProgram(r);var n=this.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),this.enableVertexAttrib([["a_pos",2],["a_sprite_idx",1]])},r.prototype.draw=function(){if(console.time("draw points"),this.prepareCanvas(),this._checkSprites(),!this._vertexCount){var t=this.getMap(),r=t.getMaxZoom(),n=this.layer.data,a=[],o=[];this._vertexCount=0;for(var i=this.gl,s=[0,0],l=0,u=n.length;l<u;l++){var h=this._getTexCoord({properties:n[l][2]});if(h){this._vertexCount++;var f=t.coordinateToPoint(new e.Coordinate(n[l]),r);a.push(f.x,f.y,h.idx),o.push([f.x,f.y,h.size,h.offset,n[l]]),h.size[0]>s[0]&&(s[0]=h.size[0]),h.size[1]>s[1]&&(s[1]=h.size[1])}}i.bufferData(i.ARRAY_BUFFER,new Float32Array(a),i.STATIC_DRAW),this._maxIconSize=s,this._indexData(o)}this._drawMarkers(),console.timeEnd("draw points"),this.completeRender()},r.prototype.onRemove=function(){this._removeEvents(),delete this._sprites,delete this._uSprite,t.prototype.onRemove.apply(this,arguments)},r.prototype.identify=function(t,e){if(!this._kdIndex)return null;var r=this.getMap(),n=r.coordinateToPoint(t,r.getMaxZoom()),a=r.getScale(),o=a*this._maxIconSize[0],i=a*this._maxIconSize[1],s=this._kdIndex.range(n.x-o,n.y-i,n.x+o,n.y+i),l=void 0,u=void 0;e&&(e.filter&&(l=e.filter),e.count&&(u=e.count));for(var h=[],f=0,c=s.length;f<c;f++){var v=this._indexPoints[s[f]],p=v[0],d=v[1],x=v[2],M=v[3],y=[a*(-x[0]/2+M.x),a*(-x[1]/2+M.y),a*(x[0]/2+M.x),a*(x[1]/2+M.y)];if(n.x>=p+y[0]&&n.x<=p+y[2]&&n.y>=d+y[1]&&n.y<=d+y[3]&&(l&&!l(v[4])||h.push(v[4]),u&&h.length>=u))break}return h},r.prototype._indexData=function(t){this._indexPoints=t,this._kdIndex=pe(t,null,null,64,Int32Array)},r.prototype._getTexCoord=function(t){if(!this.layer._cookedStyles)return null;for(var e=0,r=this.layer._cookedStyles.length;e<r;e++)if(this.layer._cookedStyles[e].filter(t)===!0)return{idx:e,texCoord:this._sprites.texCoords[e],offset:this._sprites.offsets[e],size:this._sprites.sizes[e]};return null},r.prototype._checkSprites=function(){var t=this;if(this._needCheckSprites){var r=this.resources,n=[];if(this.layer.getStyle()&&!function(){var a=t.getMap();t.layer.getStyle().forEach(function(t){var o=new e.Marker([0,0],{symbol:t.symbol}),i=o._getSprite(r,a.CanvasClass);i&&n.push(i)})}(),this._sprites=this.mergeSprites(n,!0),this._sprites&&("undefined"!=typeof window&&window.MAPTALKS_WEBGL_DEBUG_CANVAS&&window.MAPTALKS_WEBGL_DEBUG_CANVAS.getContext("2d").drawImage(this._sprites.canvas,0,0),this._needCheckSprites=!1,!this._textureLoaded)){var a=this._sprites.canvas.getContext("2d"),o=this._sprites.canvas.width,i=this._sprites.canvas.height,s=a.getImageData(0,0,o,i);this.loadTexture(s),this.enableSampler("u_sampler"),this._textureLoaded=!0;for(var l=this._uSprite=[],u=0,h=this.layer._cookedStyles.length;u<h;u++)l.push.apply(l,this._sprites.texCoords[u]),l.push(this._sprites.offsets[u].x,this._sprites.offsets[u].y)}}},r.prototype._drawMarkers=function(){var t=this.gl,e=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,e),t.uniform1f(t.program.u_scale,this.getMap().getScale()),t.uniform1fv(t.program.u_sprite,this._uSprite),t.drawArrays(t.POINTS,0,this._vertexCount)},r.prototype._registerEvents=function(){this.layer.on("setstyle",this._onStyleChanged,this)},r.prototype._removeEvents=function(){this.layer.off("setstyle",this._onStyleChanged,this)},r.prototype._onStyleChanged=function(){this._needCheckStyle=!0},r}(Vt));var xe=r(function(t){var e=function(){function t(e,r,n,a){function i(e,n){if(null===e)return null;if(0==n)return e;var s,f;if("object"!=("undefined"==typeof e?"undefined":Ot(e)))return e;if(t.__isArray(e))s=[];else if(t.__isRegExp(e))s=new RegExp(e.source,o(e)),e.lastIndex&&(s.lastIndex=e.lastIndex);else if(t.__isDate(e))s=new Date(e.getTime());else{if(h&&Buffer.isBuffer(e))return s=new Buffer(e.length),e.copy(s),s;"undefined"==typeof a?(f=Object.getPrototypeOf(e),s=Object.create(f)):(s=Object.create(a),f=a)}if(r){var c=l.indexOf(e);if(c!=-1)return u[c];l.push(e),u.push(s)}for(var v in e){var p;f&&(p=Object.getOwnPropertyDescriptor(f,v)),p&&null==p.set||(s[v]=i(e[v],n-1))}return s}var s;"object"===("undefined"==typeof r?"undefined":Ot(r))&&(n=r.depth,a=r.prototype,s=r.filter,r=r.circular);var l=[],u=[],h="undefined"!=typeof Buffer;return"undefined"==typeof r&&(r=!0),"undefined"==typeof n&&(n=1/0),i(e,n)}function e(t){return Object.prototype.toString.call(t)}function r(t){return"object"===("undefined"==typeof t?"undefined":Ot(t))&&"[object Date]"===e(t)}function n(t){return"object"===("undefined"==typeof t?"undefined":Ot(t))&&"[object Array]"===e(t)}function a(t){return"object"===("undefined"==typeof t?"undefined":Ot(t))&&"[object RegExp]"===e(t)}function o(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return t.clonePrototype=function(t){if(null===t)return null;var e=function(){};return e.prototype=t,new e},t.__objToStr=e,t.__isDate=r,t.__isArray=n,t.__isRegExp=a,t.__getRegExpFlags=o,t}();t.exports&&(t.exports=e)}),Me={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},ye=r(function(t){function e(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2)}var r=Me,n={};for(var a in r)r.hasOwnProperty(a)&&(n[r[a]]=a);var o=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var i in o)if(o.hasOwnProperty(i)){if(!("channels"in o[i]))throw new Error("missing channels property: "+i);if(!("labels"in o[i]))throw new Error("missing channel labels property: "+i);if(o[i].labels.length!==o[i].channels)throw new Error("channel and label counts mismatch: "+i);var s=o[i].channels,l=o[i].labels;delete o[i].channels,delete o[i].labels,Object.defineProperty(o[i],"channels",{value:s}),Object.defineProperty(o[i],"labels",{value:l})}o.rgb.hsl=function(t){var e,r,n,a=t[0]/255,o=t[1]/255,i=t[2]/255,s=Math.min(a,o,i),l=Math.max(a,o,i),u=l-s;return l===s?e=0:a===l?e=(o-i)/u:o===l?e=2+(i-a)/u:i===l&&(e=4+(a-o)/u),e=Math.min(60*e,360),e<0&&(e+=360),n=(s+l)/2,r=l===s?0:n<=.5?u/(l+s):u/(2-l-s),[e,100*r,100*n]},o.rgb.hsv=function(t){var e,r,n,a=t[0],o=t[1],i=t[2],s=Math.min(a,o,i),l=Math.max(a,o,i),u=l-s;return r=0===l?0:u/l*1e3/10,l===s?e=0:a===l?e=(o-i)/u:o===l?e=2+(i-a)/u:i===l&&(e=4+(a-o)/u),e=Math.min(60*e,360),e<0&&(e+=360),n=l/255*1e3/10,[e,r,n]},o.rgb.hwb=function(t){var e=t[0],r=t[1],n=t[2],a=o.rgb.hsl(t)[0],i=1/255*Math.min(e,Math.min(r,n));return n=1-1/255*Math.max(e,Math.max(r,n)),[a,100*i,100*n]},o.rgb.cmyk=function(t){var e,r,n,a,o=t[0]/255,i=t[1]/255,s=t[2]/255;return a=Math.min(1-o,1-i,1-s),e=(1-o-a)/(1-a)||0,r=(1-i-a)/(1-a)||0,n=(1-s-a)/(1-a)||0,[100*e,100*r,100*n,100*a]},o.rgb.keyword=function(t){var a=n[t];if(a)return a;var o,i=1/0;for(var s in r)if(r.hasOwnProperty(s)){var l=r[s],u=e(t,l);u<i&&(i=u,o=s)}return o},o.keyword.rgb=function(t){return r[t]},o.rgb.xyz=function(t){var e=t[0]/255,r=t[1]/255,n=t[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92;var a=.4124*e+.3576*r+.1805*n,o=.2126*e+.7152*r+.0722*n,i=.0193*e+.1192*r+.9505*n;return[100*a,100*o,100*i]},o.rgb.lab=function(t){var e,r,n,a=o.rgb.xyz(t),i=a[0],s=a[1],l=a[2];return i/=95.047,s/=100,l/=108.883,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,l=l>.008856?Math.pow(l,1/3):7.787*l+16/116,e=116*s-16,r=500*(i-s),n=200*(s-l),[e,r,n]},o.hsl.rgb=function(t){var e,r,n,a,o,i=t[0]/360,s=t[1]/100,l=t[2]/100;if(0===s)return o=255*l,[o,o,o];r=l<.5?l*(1+s):l+s-l*s,e=2*l-r,a=[0,0,0];for(var u=0;u<3;u++)n=i+1/3*-(u-1),n<0&&n++,n>1&&n--,o=6*n<1?e+6*(r-e)*n:2*n<1?r:3*n<2?e+(r-e)*(2/3-n)*6:e,a[u]=255*o;return a},o.hsl.hsv=function(t){var e,r,n=t[0],a=t[1]/100,o=t[2]/100,i=a,s=Math.max(o,.01);return o*=2,a*=o<=1?o:2-o,i*=s<=1?s:2-s,r=(o+a)/2,e=0===o?2*i/(s+i):2*a/(o+a),[n,100*e,100*r]},o.hsv.rgb=function(t){var e=t[0]/60,r=t[1]/100,n=t[2]/100,a=Math.floor(e)%6,o=e-Math.floor(e),i=255*n*(1-r),s=255*n*(1-r*o),l=255*n*(1-r*(1-o));switch(n*=255,a){case 0:return[n,l,i];case 1:return[s,n,i];case 2:return[i,n,l];case 3:return[i,s,n];case 4:return[l,i,n];case 5:return[n,i,s]}},o.hsv.hsl=function(t){var e,r,n,a=t[0],o=t[1]/100,i=t[2]/100,s=Math.max(i,.01);return n=(2-o)*i,e=(2-o)*s,r=o*s,r/=e<=1?e:2-e,r=r||0,n/=2,[a,100*r,100*n]},o.hwb.rgb=function(t){var e,r,n,a,o=t[0]/360,i=t[1]/100,s=t[2]/100,l=i+s;l>1&&(i/=l,s/=l),e=Math.floor(6*o),r=1-s,n=6*o-e,0!==(1&e)&&(n=1-n),a=i+n*(r-i);var u,h,f;switch(e){default:case 6:case 0:u=r,h=a,f=i;break;case 1:u=a,h=r,f=i;break;case 2:u=i,h=r,f=a;break;case 3:u=i,h=a,f=r;break;case 4:u=a,h=i,f=r;break;case 5:u=r,h=i,f=a}return[255*u,255*h,255*f]},o.cmyk.rgb=function(t){var e,r,n,a=t[0]/100,o=t[1]/100,i=t[2]/100,s=t[3]/100;return e=1-Math.min(1,a*(1-s)+s),r=1-Math.min(1,o*(1-s)+s),n=1-Math.min(1,i*(1-s)+s),[255*e,255*r,255*n]},o.xyz.rgb=function(t){var e,r,n,a=t[0]/100,o=t[1]/100,i=t[2]/100;return e=3.2406*a+o*-1.5372+i*-.4986,r=a*-.9689+1.8758*o+.0415*i,n=.0557*a+o*-.204+1.057*i,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,e=Math.min(Math.max(0,e),1),r=Math.min(Math.max(0,r),1),n=Math.min(Math.max(0,n),1),[255*e,255*r,255*n]},o.xyz.lab=function(t){var e,r,n,a=t[0],o=t[1],i=t[2];return a/=95.047,o/=100,i/=108.883,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,e=116*o-16,r=500*(a-o),n=200*(o-i),[e,r,n]},o.lab.xyz=function(t){var e,r,n,a=t[0],o=t[1],i=t[2];r=(a+16)/116,e=o/500+r,n=r-i/200;var s=Math.pow(r,3),l=Math.pow(e,3),u=Math.pow(n,3);return r=s>.008856?s:(r-16/116)/7.787,e=l>.008856?l:(e-16/116)/7.787,n=u>.008856?u:(n-16/116)/7.787,e*=95.047,r*=100,n*=108.883,[e,r,n]},o.lab.lch=function(t){var e,r,n,a=t[0],o=t[1],i=t[2];return e=Math.atan2(i,o),r=360*e/2/Math.PI,r<0&&(r+=360),n=Math.sqrt(o*o+i*i),[a,n,r]},o.lch.lab=function(t){var e,r,n,a=t[0],o=t[1],i=t[2];return n=i/360*2*Math.PI,e=o*Math.cos(n),r=o*Math.sin(n),[a,e,r]},o.rgb.ansi16=function(t){var e=t[0],r=t[1],n=t[2],a=1 in arguments?arguments[1]:o.rgb.hsv(t)[2];if(a=Math.round(a/50),0===a)return 30;var i=30+(Math.round(n/255)<<2|Math.round(r/255)<<1|Math.round(e/255));return 2===a&&(i+=60),i},o.hsv.ansi16=function(t){return o.rgb.ansi16(o.hsv.rgb(t),t[2])},o.rgb.ansi256=function(t){var e=t[0],r=t[1],n=t[2];if(e===r&&r===n)return e<8?16:e>248?231:Math.round((e-8)/247*24)+232;var a=16+36*Math.round(e/255*5)+6*Math.round(r/255*5)+Math.round(n/255*5);return a},o.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),e=e/10.5*255,[e,e,e];var r=.5*(~~(t>50)+1),n=(1&e)*r*255,a=(e>>1&1)*r*255,o=(e>>2&1)*r*255;return[n,a,o]},o.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}t-=16;var r,n=Math.floor(t/36)/5*255,a=Math.floor((r=t%36)/6)/5*255,o=r%6/5*255;return[n,a,o]},o.rgb.hex=function(t){var e=((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2])),r=e.toString(16).toUpperCase();return"000000".substring(r.length)+r},o.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}/i);if(!e)return[0,0,0];var r=parseInt(e[0],16),n=r>>16&255,a=r>>8&255,o=255&r;return[n,a,o]},o.rgb.hcg=function(t){var e,r,n=t[0]/255,a=t[1]/255,o=t[2]/255,i=Math.max(Math.max(n,a),o),s=Math.min(Math.min(n,a),o),l=i-s;return e=l<1?s/(1-l):0,r=l<=0?0:i===n?(a-o)/l%6:i===a?2+(o-n)/l:4+(n-a)/l+4,r/=6,r%=1,[360*r,100*l,100*e]},o.hsl.hcg=function(t){var e=t[1]/100,r=t[2]/100,n=1,a=0;return n=r<.5?2*e*r:2*e*(1-r),n<1&&(a=(r-.5*n)/(1-n)),[t[0],100*n,100*a]},o.hsv.hcg=function(t){var e=t[1]/100,r=t[2]/100,n=e*r,a=0;return n<1&&(a=(r-n)/(1-n)),[t[0],100*n,100*a]},o.hcg.rgb=function(t){var e=t[0]/360,r=t[1]/100,n=t[2]/100;if(0===r)return[255*n,255*n,255*n];var a=[0,0,0],o=e%1*6,i=o%1,s=1-i,l=0;switch(Math.floor(o)){case 0:a[0]=1,a[1]=i,a[2]=0;break;case 1:a[0]=s,a[1]=1,a[2]=0;break;case 2:a[0]=0,a[1]=1,a[2]=i;break;case 3:a[0]=0,a[1]=s,a[2]=1;break;case 4:a[0]=i,a[1]=0,a[2]=1;break;default:a[0]=1,a[1]=0,a[2]=s}return l=(1-r)*n,[255*(r*a[0]+l),255*(r*a[1]+l),255*(r*a[2]+l)];
},o.hcg.hsv=function(t){var e=t[1]/100,r=t[2]/100,n=e+r*(1-e),a=0;return n>0&&(a=e/n),[t[0],100*a,100*n]},o.hcg.hsl=function(t){var e=t[1]/100,r=t[2]/100,n=r*(1-e)+.5*e,a=0;return n>0&&n<.5?a=e/(2*n):n>=.5&&n<1&&(a=e/(2*(1-n))),[t[0],100*a,100*n]},o.hcg.hwb=function(t){var e=t[1]/100,r=t[2]/100,n=e+r*(1-e);return[t[0],100*(n-e),100*(1-n)]},o.hwb.hcg=function(t){var e=t[1]/100,r=t[2]/100,n=1-r,a=n-e,o=0;return a<1&&(o=(n-a)/(1-a)),[t[0],100*a,100*o]},o.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},o.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},o.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},o.gray.hsl=o.gray.hsv=function(t){return[0,0,t[0]]},o.gray.hwb=function(t){return[0,100,t[0]]},o.gray.cmyk=function(t){return[0,0,0,t[0]]},o.gray.lab=function(t){return[t[0],0,0]},o.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),r=(e<<16)+(e<<8)+e,n=r.toString(16).toUpperCase();return"000000".substring(n.length)+n},o.rgb.gray=function(t){var e=(t[0]+t[1]+t[2])/3;return[e/255*100]}}),ge=ye,me=Object.keys(ge),Se=function(t){for(var e=W(t),r={},n=Object.keys(e),a=n.length,o=0;o<a;o++){var i=n[o],s=e[i];null!==s.parent&&(r[i]=X(i,e))}return r},_e=ye,be=Se,Ie={},De=Object.keys(_e);De.forEach(function(t){Ie[t]={},Object.defineProperty(Ie[t],"channels",{value:_e[t].channels}),Object.defineProperty(Ie[t],"labels",{value:_e[t].labels});var e=be(t),r=Object.keys(e);r.forEach(function(r){var n=e[r];Ie[t][r]=H(n),Ie[t][r].raw=J(n)})});var Fe=Ie,we=Me,Ae={getRgba:K,getHsla:Q,getRgb:tt,getHsl:et,getHwb:$,getAlpha:rt,hexString:nt,rgbString:at,rgbaString:ot,percentString:it,percentaString:st,hslString:lt,hslaString:ut,hwbString:ht,keyword:ft},Ee={};for(var Re in we)Ee[we[Re]]=Re;var ze=xe,Pe=Fe,Ce=Ae,Le=function t(e){if(e instanceof t)return e;if(!(this instanceof t))return new t(e);this.values={rgb:[0,0,0],hsl:[0,0,0],hsv:[0,0,0],hwb:[0,0,0],cmyk:[0,0,0,0],alpha:1};var r;if("string"==typeof e)if(r=Ce.getRgba(e))this.setValues("rgb",r);else if(r=Ce.getHsla(e))this.setValues("hsl",r);else{if(!(r=Ce.getHwb(e)))throw new Error('Unable to parse color from string "'+e+'"');this.setValues("hwb",r)}else if("object"===("undefined"==typeof e?"undefined":Ot(e)))if(r=e,void 0!==r.r||void 0!==r.red)this.setValues("rgb",r);else if(void 0!==r.l||void 0!==r.lightness)this.setValues("hsl",r);else if(void 0!==r.v||void 0!==r.value)this.setValues("hsv",r);else if(void 0!==r.w||void 0!==r.whiteness)this.setValues("hwb",r);else{if(void 0===r.c&&void 0===r.cyan)throw new Error("Unable to parse color from object "+JSON.stringify(e));this.setValues("cmyk",r)}};Le.prototype={rgb:function(){return this.setSpace("rgb",arguments)},hsl:function(){return this.setSpace("hsl",arguments)},hsv:function(){return this.setSpace("hsv",arguments)},hwb:function(){return this.setSpace("hwb",arguments)},cmyk:function(){return this.setSpace("cmyk",arguments)},rgbArray:function(){return this.values.rgb},hslArray:function(){return this.values.hsl},hsvArray:function(){return this.values.hsv},hwbArray:function(){return 1!==this.values.alpha?this.values.hwb.concat([this.values.alpha]):this.values.hwb},cmykArray:function(){return this.values.cmyk},rgbaArray:function(){var t=this.values.rgb;return t.concat([this.values.alpha])},rgbaArrayNormalized:function(){for(var t=this.values.rgb,e=[],r=0;r<3;r++)e[r]=t[r]/255;return e.push(this.values.alpha),e},hslaArray:function(){var t=this.values.hsl;return t.concat([this.values.alpha])},alpha:function(t){return void 0===t?this.values.alpha:(this.setValues("alpha",t),this)},red:function(t){return this.setChannel("rgb",0,t)},green:function(t){return this.setChannel("rgb",1,t)},blue:function(t){return this.setChannel("rgb",2,t)},hue:function(t){return t&&(t%=360,t=t<0?360+t:t),this.setChannel("hsl",0,t)},saturation:function(t){return this.setChannel("hsl",1,t)},lightness:function(t){return this.setChannel("hsl",2,t)},saturationv:function(t){return this.setChannel("hsv",1,t)},whiteness:function(t){return this.setChannel("hwb",1,t)},blackness:function(t){return this.setChannel("hwb",2,t)},value:function(t){return this.setChannel("hsv",2,t)},cyan:function(t){return this.setChannel("cmyk",0,t)},magenta:function(t){return this.setChannel("cmyk",1,t)},yellow:function(t){return this.setChannel("cmyk",2,t)},black:function(t){return this.setChannel("cmyk",3,t)},hexString:function(){return Ce.hexString(this.values.rgb)},rgbString:function(){return Ce.rgbString(this.values.rgb,this.values.alpha)},rgbaString:function(){return Ce.rgbaString(this.values.rgb,this.values.alpha)},percentString:function(){return Ce.percentString(this.values.rgb,this.values.alpha)},hslString:function(){return Ce.hslString(this.values.hsl,this.values.alpha)},hslaString:function(){return Ce.hslaString(this.values.hsl,this.values.alpha)},hwbString:function(){return Ce.hwbString(this.values.hwb,this.values.alpha)},keyword:function(){return Ce.keyword(this.values.rgb,this.values.alpha)},rgbNumber:function(){return this.values.rgb[0]<<16|this.values.rgb[1]<<8|this.values.rgb[2]},luminosity:function(){for(var t=this.values.rgb,e=[],r=0;r<t.length;r++){var n=t[r]/255;e[r]=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),r=t.luminosity();return e>r?(e+.05)/(r+.05):(r+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},dark:function(){var t=this.values.rgb,e=(299*t[0]+587*t[1]+114*t[2])/1e3;return e<128},light:function(){return!this.dark()},negate:function(){for(var t=[],e=0;e<3;e++)t[e]=255-this.values.rgb[e];return this.setValues("rgb",t),this},lighten:function(t){return this.values.hsl[2]+=this.values.hsl[2]*t,this.setValues("hsl",this.values.hsl),this},darken:function(t){return this.values.hsl[2]-=this.values.hsl[2]*t,this.setValues("hsl",this.values.hsl),this},saturate:function(t){return this.values.hsl[1]+=this.values.hsl[1]*t,this.setValues("hsl",this.values.hsl),this},desaturate:function(t){return this.values.hsl[1]-=this.values.hsl[1]*t,this.setValues("hsl",this.values.hsl),this},whiten:function(t){return this.values.hwb[1]+=this.values.hwb[1]*t,this.setValues("hwb",this.values.hwb),this},blacken:function(t){return this.values.hwb[2]+=this.values.hwb[2]*t,this.setValues("hwb",this.values.hwb),this},greyscale:function(){var t=this.values.rgb,e=.3*t[0]+.59*t[1]+.11*t[2];return this.setValues("rgb",[e,e,e]),this},clearer:function(t){return this.setValues("alpha",this.values.alpha-this.values.alpha*t),this},opaquer:function(t){return this.setValues("alpha",this.values.alpha+this.values.alpha*t),this},rotate:function(t){var e=this.values.hsl[0];return e=(e+t)%360,e=e<0?360+e:e,this.values.hsl[0]=e,this.setValues("hsl",this.values.hsl),this},mix:function(t,e){var r=this,n=t,a=void 0===e?.5:e,o=2*a-1,i=r.alpha()-n.alpha(),s=((o*i===-1?o:(o+i)/(1+o*i))+1)/2,l=1-s;return this.rgb(s*r.red()+l*n.red(),s*r.green()+l*n.green(),s*r.blue()+l*n.blue()).alpha(r.alpha()*a+n.alpha()*(1-a))},toJSON:function(){return this.rgb()},clone:function(){var t=new Le;return t.values=ze(this.values),t}},Le.prototype.getValues=function(t){for(var e={},r=0;r<t.length;r++)e[t.charAt(r)]=this.values[t][r];return 1!==this.values.alpha&&(e.a=this.values.alpha),e},Le.prototype.setValues=function(t,e){var r,n={rgb:["red","green","blue"],hsl:["hue","saturation","lightness"],hsv:["hue","saturation","value"],hwb:["hue","whiteness","blackness"],cmyk:["cyan","magenta","yellow","black"]},a={rgb:[255,255,255],hsl:[360,100,100],hsv:[360,100,100],hwb:[360,100,100],cmyk:[100,100,100,100]},o=1;if("alpha"===t)o=e;else if(e.length)this.values[t]=e.slice(0,t.length),o=e[t.length];else if(void 0!==e[t.charAt(0)]){for(r=0;r<t.length;r++)this.values[t][r]=e[t.charAt(r)];o=e.a}else if(void 0!==e[n[t][0]]){var i=n[t];for(r=0;r<t.length;r++)this.values[t][r]=e[i[r]];o=e.alpha}if(this.values.alpha=Math.max(0,Math.min(1,void 0===o?this.values.alpha:o)),"alpha"===t)return!1;var s;for(r=0;r<t.length;r++)s=Math.max(0,Math.min(a[t][r],this.values[t][r])),this.values[t][r]=Math.round(s);for(var l in n)for(l!==t&&(this.values[l]=Pe[t][l](this.values[t])),r=0;r<l.length;r++)s=Math.max(0,Math.min(a[l][r],this.values[l][r])),this.values[l][r]=Math.round(s);return!0},Le.prototype.setSpace=function(t,e){var r=e[0];return void 0===r?this.getValues(t):("number"==typeof r&&(r=Array.prototype.slice.call(e)),this.setValues(t,r),this)},Le.prototype.setChannel=function(t,e,r){return void 0===r?this.values[t][e]:r===this.values[t][e]?this:(this.values[t][e]=r,this.setValues(t,this.values[t]),this)};var ke=Le,Te={blur:2},Be=function(t){function e(){return Nt(this,e),Ut(this,t.apply(this,arguments))}return qt(e,t),e}(se);Be.mergeOptions(Te),Be.registerJSONType("BigLineLayer");var Oe=function(t){function r(e){Nt(this,r);var n=Ut(this,t.call(this,e));return n._needCheckStyle=!0,n._needCheckSprites=!0,n._registerEvents(),n}return qt(r,t),r.prototype.checkResources=function(){if(!this._needCheckStyle)return[];var t=[];return this.layer._cookedStyles&&this.layer._cookedStyles.forEach(function(r){r.symbol=e.Util.convertResourceUrl(r.symbol);var n=e.Util.getExternalResources(r.symbol,!0);n&&t.push(n)}),this._needCheckStyle=!1,this._needCheckSprites=!0,this._textureLoaded=!1,0===t.length?[]:t},r.prototype.onCanvasCreate=function(){this.gl.getExtension("OES_element_index_uint");var t=["u_matrix","u_scale","u_tex_size","u_styles"];this._lineProgram=this.createProgram(ae.line.vertexSource,ae.line.fragmentSource,t)},r.prototype.draw=function(){console.time("draw lines"),this.prepareCanvas(),this._drawLines(),console.timeEnd("draw lines"),this.completeRender()},r.prototype.onRemove=function(){this._removeEvents(),delete this._sprites,delete this._lineArrays,t.prototype.onRemove.apply(this,arguments)},r.prototype._checkSprites=function(){var t=this;if(this._needCheckSprites){this._atlas=new jt(this.resources);var e=[];if(this.layer._cookedStyles&&this.layer._cookedStyles.forEach(function(r){var n=t._atlas.getAtlas(r.symbol,!1);n&&e.push(n)}),this._sprites=this.mergeSprites(e),this._sprites&&"undefined"!=typeof window&&window.MAPTALKS_WEBGL_DEBUG_CANVAS){var r=window.MAPTALKS_WEBGL_DEBUG_CANVAS;r.getContext("2d").fillRect(0,0,r.width,r.height),r.getContext("2d").fillStyle="rgb(255, 255, 255)",r.getContext("2d").fillRect(0,0,this._sprites.canvas.width,this._sprites.canvas.height),r.getContext("2d").drawImage(this._sprites.canvas,0,0)}this._needCheckSprites=!1,this._sprites&&!this._textureLoaded&&(this.loadTexture(this._sprites.canvas),this.enableSampler("u_image"),this._textureLoaded=!0);for(var n=0,a=this._uStyle=[],o=0,i=this.layer._cookedStyles.length;o<i;o++){var s=this.layer._cookedStyles[o],l=this._atlas.getAtlas(s.symbol);if(l)a.push.apply(a,this._sprites.texCoords[n++]),a.push(-1);else{var u=s.symbol.lineColor||"#000000";u=ke(u).rgbaArrayNormalized(),a.push.apply(a,u)}}}},r.prototype._getDataSymbol=function(t){for(var e=-1,r=0,n=this.layer._cookedStyles.length;r<n;r++){var a=this.layer._cookedStyles[r],o=this._atlas.getAtlas(a.symbol);if(o&&e++,a.filter(t)===!0)return o?{symbol:a.symbol,texCoord:this._sprites.texCoords[e],index:r}:{symbol:a.symbol,index:r}}return null},r.prototype._drawLines=function(){var t=this.gl,e=this.getMap(),r=this._lineProgram;this.useProgram(r),this._checkSprites();var n=this.layer.data;if(!this._lineArrays){for(var a=new Gt(t,e),o=void 0,i=0,s=n.length;i<s;i++)Array.isArray(n[i])?(o=this._getDataSymbol(n[i][1]),a.addLine(n[i][0],o)):n[i].properties&&(o=this._getDataSymbol(n[i].properties),a.addLine(n[i],o));var l=this._lineArrays=a.getArrays();this._elementCount=l.elementArray.length}this._bufferLineData(this._lineArrays);var u=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,u),t.uniform1f(r.u_scale,e.getScale()),t.uniform1fv(r.u_styles,this._uStyle);var h=[0,0];this._sprites&&(h=[this._sprites.canvas.width,this._sprites.canvas.height]),t.uniform2fv(r.u_tex_size,new Float32Array(h)),t.drawElements(t.TRIANGLES,this._elementCount,t.UNSIGNED_INT,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},r.prototype._bufferLineData=function(t){var e=this.gl;if(this._vertexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);else{var r=this._vertexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.vertexArray),e.STATIC_DRAW)}if(this.enableVertexAttrib(["a_pos",2,"FLOAT"]),this._normalBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._normalBuffer);else{var n=this._normalBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.normalArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_normal",2,"FLOAT"],["a_linesofar",1,"FLOAT"]]),this._texBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._texBuffer);else{var a=this._texBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.styleArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_style",1,"FLOAT"]]),e.bindBuffer(e.ARRAY_BUFFER,null),this._elementBuffer)e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._elementBuffer);else{var o=this._elementBuffer=this.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint32Array(t.elementArray),e.STATIC_DRAW)}},r.prototype._registerEvents=function(){this.layer.on("setstyle",this._onStyleChanged,this)},r.prototype._removeEvents=function(){this.layer.off("setstyle",this._onStyleChanged,this)},r.prototype._onStyleChanged=function(){this._needCheckStyle=!0},r}(Vt);Be.registerRenderer("webgl",Oe);var Ne={blur:2},qe=function(t){function e(){return Nt(this,e),Ut(this,t.apply(this,arguments))}return qt(e,t),e}(se);qe.mergeOptions(Ne),qe.registerJSONType("BigPolygonLayer"),qe.registerRenderer("webgl",function(t){function e(){return Nt(this,e),Ut(this,t.apply(this,arguments))}return qt(e,t),e.prototype.onCanvasCreate=function(){var e=["u_matrix","u_styles"];this._polygonProgram=this.createProgram(ae.polygon.vertexSource,ae.polygon.fragmentSource,e),t.prototype.onCanvasCreate.call(this)},e.prototype.draw=function(){console.time("draw polygons"),this.prepareCanvas(),this.gl.disable(this.gl.BLEND),this._drawLines(),this.gl.enable(this.gl.BLEND),this._drawPolygons(),console.timeEnd("draw polygons"),this.completeRender()},e.prototype._checkSprites=function(){if(this._needCheckSprites){this._needCheckSprites&&(this._polygonTextureLoaded=!1),t.prototype._checkSprites.call(this),this._sprites&&!this._polygonTextureLoaded&&(this.loadTexture(this._sprites.canvas),this.enableSampler("u_image"),this._polygonTextureLoaded=!0);for(var e=0,r=this._uPolygonStyle=[],n=0,a=this.layer._cookedStyles.length;n<a;n++){var o=this.layer._cookedStyles[n],i=this._atlas.getAtlas(o.symbol);if(i)r.push.apply(r,this._sprites.texCoords[e++]),r.push(-1);else{var s=o.symbol.polygonFill||"#000000";s=ke(s).rgbaArrayNormalized(),r.push.apply(r,s)}}}},e.prototype._drawPolygons=function(){var t=this.gl,e=this.getMap(),r=this._polygonProgram;this.useProgram(r),this._checkSprites();var n=this.layer.data;if(!this._polygonArrays){for(var a=new Ht(t,e),o=void 0,i=0,s=n.length;i<s;i++)Array.isArray(n[i])?(o=this._getDataSymbol(n[i][1]),a.addPolygon(n[i][0],o)):n[i].properties&&(o=this._getDataSymbol(n[i].properties),a.addPolygon(n[i],o));var l=this._polygonArrays=a.getArrays();this._polygonElementCount=l.elementArray.length}this._bufferPolygonData(this._polygonArrays);var u=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,u),t.uniform1fv(r.u_styles,this._uPolygonStyle),t.drawElements(t.TRIANGLES,this._polygonElementCount,t.UNSIGNED_INT,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},e.prototype._bufferPolygonData=function(t){var e=this.gl;if(this._polygonVertexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._polygonVertexBuffer);else{var r=this._polygonVertexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.vertexArray),e.STATIC_DRAW)}if(this.enableVertexAttrib(["a_pos",2,"FLOAT"]),this._polygonTexBuffer)e.bindBuffer(e.ARRAY_BUFFER,this._polygonTexBuffer);else{var n=this._polygonTexBuffer=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.styleArray),e.STATIC_DRAW)}if(this.enableVertexAttrib([["a_style",1,"FLOAT"]]),e.bindBuffer(e.ARRAY_BUFFER,null),this._polygonElemBuffer)e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._polygonElemBuffer);else{var a=this._polygonElemBuffer=this.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint32Array(t.elementArray),e.STATIC_DRAW)}},e.prototype.onRemove=function(){t.prototype.onRemove.apply(this,arguments)},e}(Oe)),t.webgl=oe,t.BigDataLayer=se,t.BigPointLayer=de,t.BigLineLayer=Be,t.BigPolygonLayer=qe,Object.defineProperty(t,"__esModule",{value:!0})});