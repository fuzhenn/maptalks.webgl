/*!
 * maptalks.webgl v0.3.0
 * LICENSE : MIT
 * (c) 2016-2017 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,e){"use strict";function r(t,e){return e={exports:{}},t(e,e.exports),e.exports}function a(t,e){for(var r=Object.getOwnPropertyNames(e),a=0;a<r.length;a++){var n=r[a],o=Object.getOwnPropertyDescriptor(e,n);o&&o.configurable&&void 0===t[n]&&Object.defineProperty(t,n,o)}return t}function n(){for(var t={},e=gt.length,r=0;r<e;r++)t[gt[r]]={distance:-1,parent:null};return t}function o(t){var e=n(),r=[t];for(e[t].distance=0;r.length;)for(var a=r.pop(),o=Object.keys(St[a]),i=o.length,s=0;s<i;s++){var l=o[s],u=e[l];u.distance===-1&&(u.distance=e[a].distance+1,u.parent=a,r.unshift(l))}return e}function i(t,e){return function(r){return e(t(r))}}function s(t,e){for(var r=[e[t].parent,t],a=St[e[t].parent][t],n=e[t].parent;e[n].parent;)r.unshift(e[n].parent),a=i(St[e[n].parent][n],a),n=e[n].parent;return a.conversion=r,a}function l(t){var e=function(e){return void 0===e||null===e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}function u(t){var e=function(e){if(void 0===e||null===e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var r=t(e);if("object"===("undefined"==typeof r?"undefined":ut(r)))for(var a=r.length,n=0;n<a;n++)r[n]=Math.round(r[n]);return r};return"conversion"in t&&(e.conversion=t.conversion),e}function h(t){if(t){var e=/^#([a-fA-F0-9]{3})$/,r=/^#([a-fA-F0-9]{6})$/,a=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,n=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,o=/(\D+)/,i=[0,0,0],s=1,l=t.match(e);if(l){l=l[1];for(var u=0;u<i.length;u++)i[u]=parseInt(l[u]+l[u],16)}else if(l=t.match(r)){l=l[1];for(var u=0;u<i.length;u++)i[u]=parseInt(l.slice(2*u,2*u+2),16)}else if(l=t.match(a)){for(var u=0;u<i.length;u++)i[u]=parseInt(l[u+1]);s=parseFloat(l[4])}else if(l=t.match(n)){for(var u=0;u<i.length;u++)i[u]=Math.round(2.55*parseFloat(l[u+1]));s=parseFloat(l[4])}else if(l=t.match(o)){if("transparent"==l[1])return[0,0,0,0];if(i=wt[l[1]],!i)return}for(var u=0;u<i.length;u++)i[u]=D(i[u],0,255);return s=s||0==s?D(s,0,1):1,i[3]=s,i}}function c(t){if(t){var e=/^hsla?\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/,r=t.match(e);if(r){var a=parseFloat(r[4]),n=D(parseInt(r[1]),0,360),o=D(parseFloat(r[2]),0,100),i=D(parseFloat(r[3]),0,100),s=D(isNaN(a)?1:a,0,1);return[n,o,i,s]}}}function f(t){if(t){var e=/^hwb\(\s*([+-]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)/,r=t.match(e);if(r){var a=parseFloat(r[4]),n=D(parseInt(r[1]),0,360),o=D(parseFloat(r[2]),0,100),i=D(parseFloat(r[3]),0,100),s=D(isNaN(a)?1:a,0,1);return[n,o,i,s]}}}function d(t){var e=h(t);return e&&e.slice(0,3)}function M(t){var e=c(t);return e&&e.slice(0,3)}function v(t){var e=h(t);return e?e[3]:(e=c(t))?e[3]:(e=f(t))?e[3]:void 0}function p(t){return"#"+F(t[0])+F(t[1])+F(t[2])}function x(t,e){return e<1||t[3]&&t[3]<1?m(t,e):"rgb("+t[0]+", "+t[1]+", "+t[2]+")"}function m(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+e+")"}function S(t,e){if(e<1||t[3]&&t[3]<1)return g(t,e);var r=Math.round(t[0]/255*100),a=Math.round(t[1]/255*100),n=Math.round(t[2]/255*100);return"rgb("+r+"%, "+a+"%, "+n+"%)"}function g(t,e){var r=Math.round(t[0]/255*100),a=Math.round(t[1]/255*100),n=Math.round(t[2]/255*100);return"rgba("+r+"%, "+a+"%, "+n+"%, "+(e||t[3]||1)+")"}function y(t,e){return e<1||t[3]&&t[3]<1?b(t,e):"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)"}function b(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+e+")"}function _(t,e){return void 0===e&&(e=void 0!==t[3]?t[3]:1),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+(void 0!==e&&1!==e?", "+e:"")+")"}function I(t){return Et[t.slice(0,3)]}function D(t,e,r){return Math.min(Math.max(e,t),r)}function F(t){var e=t.toString(16).toUpperCase();return e.length<2?"0"+e:e}function w(t,e){this.x=t,this.y=e}function A(t,e,r,a,n,o){if(!(n-a<=r)){var i=Math.floor((a+n)/2);E(t,e,i,a,n,o%2),A(t,e,r,a,i-1,o+1),A(t,e,r,i+1,n,o+1)}}function E(t,e,r,a,n,o){for(;n>a;){if(n-a>600){var i=n-a+1,s=r-a+1,l=Math.log(i),u=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*u*(i-u)/i)*(s-i/2<0?-1:1),c=Math.max(a,Math.floor(r-s*u/i+h)),f=Math.min(n,Math.floor(r+(i-s)*u/i+h));E(t,e,r,c,f,o)}var d=e[2*r+o],M=a,v=n;for(z(t,e,a,r),e[2*n+o]>d&&z(t,e,a,n);M<v;){for(z(t,e,M,v),M++,v--;e[2*M+o]<d;)M++;for(;e[2*v+o]>d;)v--}e[2*a+o]===d?z(t,e,a,v):(v++,z(t,e,v,n)),v<=r&&(a=v+1),r<=v&&(n=v-1)}}function z(t,e,r,a){C(t,r,a),C(e,2*r,2*a),C(e,2*r+1,2*a+1)}function C(t,e,r){var a=t[e];t[e]=t[r],t[r]=a}function P(t,e,r,a,n,o,i){for(var s,l,u=[0,t.length-1,0],h=[];u.length;){var c=u.pop(),f=u.pop(),d=u.pop();if(f-d<=i)for(var M=d;M<=f;M++)s=e[2*M],l=e[2*M+1],s>=r&&s<=n&&l>=a&&l<=o&&h.push(t[M]);else{var v=Math.floor((d+f)/2);s=e[2*v],l=e[2*v+1],s>=r&&s<=n&&l>=a&&l<=o&&h.push(t[v]);var p=(c+1)%2;(0===c?r<=s:a<=l)&&(u.push(d),u.push(v-1),u.push(p)),(0===c?n>=s:o>=l)&&(u.push(v+1),u.push(f),u.push(p))}}return h}function R(t,e,r,a,n,o){for(var i=[0,t.length-1,0],s=[],l=n*n;i.length;){var u=i.pop(),h=i.pop(),c=i.pop();if(h-c<=o)for(var f=c;f<=h;f++)L(e[2*f],e[2*f+1],r,a)<=l&&s.push(t[f]);else{var d=Math.floor((c+h)/2),M=e[2*d],v=e[2*d+1];L(M,v,r,a)<=l&&s.push(t[d]);var p=(u+1)%2;(0===u?r-n<=M:a-n<=v)&&(i.push(c),i.push(d-1),i.push(p)),(0===u?r+n>=M:a+n>=v)&&(i.push(d+1),i.push(h),i.push(p))}}return s}function L(t,e,r,a){var n=t-r,o=e-a;return n*n+o*o}function k(t,e,r,a,n){return new O(t,e,r,a,n)}function O(t,e,r,a,n){e=e||T,r=r||N,n=n||Array,this.nodeSize=a||64,this.points=t,this.ids=new n(t.length),this.coords=new n(2*t.length);for(var o=0;o<t.length;o++)this.ids[o]=o,this.coords[2*o]=e(t[o]),this.coords[2*o+1]=r(t[o]);Ht(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function T(t){return t[0]}function N(t){return t[1]}var q="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},V={};V.EPSILON=1e-6,V.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,V.RANDOM=Math.random,V.ENABLE_SIMD=!1,V.SIMD_AVAILABLE=V.ARRAY_TYPE===Float32Array&&"SIMD"in q,V.USE_SIMD=V.ENABLE_SIMD&&V.SIMD_AVAILABLE,V.setMatrixArrayType=function(t){V.ARRAY_TYPE=t};var B=Math.PI/180;V.toRadian=function(t){return t*B},V.equals=function(t,e){return Math.abs(t-e)<=V.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))};var Y=V,U=Y,j={};j.create=function(){var t=new U.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},j.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},j.clone=function(t){var e=new U.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},j.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},j.fromValues=function(t,e,r,a,n,o,i,s,l){var u=new U.ARRAY_TYPE(9);return u[0]=t,u[1]=e,u[2]=r,u[3]=a,u[4]=n,u[5]=o,u[6]=i,u[7]=s,u[8]=l,u},j.set=function(t,e,r,a,n,o,i,s,l,u){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t[4]=o,t[5]=i,t[6]=s,t[7]=l,t[8]=u,t},j.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},j.transpose=function(t,e){if(t===e){var r=e[1],a=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=a,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},j.invert=function(t,e){var r=e[0],a=e[1],n=e[2],o=e[3],i=e[4],s=e[5],l=e[6],u=e[7],h=e[8],c=h*i-s*u,f=-h*o+s*l,d=u*o-i*l,M=r*c+a*f+n*d;return M?(M=1/M,t[0]=c*M,t[1]=(-h*a+n*u)*M,t[2]=(s*a-n*i)*M,t[3]=f*M,t[4]=(h*r-n*l)*M,t[5]=(-s*r+n*o)*M,t[6]=d*M,t[7]=(-u*r+a*l)*M,t[8]=(i*r-a*o)*M,t):null},j.adjoint=function(t,e){var r=e[0],a=e[1],n=e[2],o=e[3],i=e[4],s=e[5],l=e[6],u=e[7],h=e[8];return t[0]=i*h-s*u,t[1]=n*u-a*h,t[2]=a*s-n*i,t[3]=s*l-o*h,t[4]=r*h-n*l,t[5]=n*o-r*s,t[6]=o*u-i*l,t[7]=a*l-r*u,t[8]=r*i-a*o,t},j.determinant=function(t){var e=t[0],r=t[1],a=t[2],n=t[3],o=t[4],i=t[5],s=t[6],l=t[7],u=t[8];return e*(u*o-i*l)+r*(-u*n+i*s)+a*(l*n-o*s)},j.multiply=function(t,e,r){var a=e[0],n=e[1],o=e[2],i=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=r[0],d=r[1],M=r[2],v=r[3],p=r[4],x=r[5],m=r[6],S=r[7],g=r[8];return t[0]=f*a+d*i+M*u,t[1]=f*n+d*s+M*h,t[2]=f*o+d*l+M*c,t[3]=v*a+p*i+x*u,t[4]=v*n+p*s+x*h,t[5]=v*o+p*l+x*c,t[6]=m*a+S*i+g*u,t[7]=m*n+S*s+g*h,t[8]=m*o+S*l+g*c,t},j.mul=j.multiply,j.translate=function(t,e,r){var a=e[0],n=e[1],o=e[2],i=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=r[0],d=r[1];return t[0]=a,t[1]=n,t[2]=o,t[3]=i,t[4]=s,t[5]=l,t[6]=f*a+d*i+u,t[7]=f*n+d*s+h,t[8]=f*o+d*l+c,t},j.rotate=function(t,e,r){var a=e[0],n=e[1],o=e[2],i=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=Math.sin(r),d=Math.cos(r);return t[0]=d*a+f*i,t[1]=d*n+f*s,t[2]=d*o+f*l,t[3]=d*i-f*a,t[4]=d*s-f*n,t[5]=d*l-f*o,t[6]=u,t[7]=h,t[8]=c,t},j.scale=function(t,e,r){var a=r[0],n=r[1];return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},j.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},j.fromRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=0,t[3]=-r,t[4]=a,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},j.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},j.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},j.fromQuat=function(t,e){var r=e[0],a=e[1],n=e[2],o=e[3],i=r+r,s=a+a,l=n+n,u=r*i,h=a*i,c=a*s,f=n*i,d=n*s,M=n*l,v=o*i,p=o*s,x=o*l;return t[0]=1-c-M,t[3]=h-x,t[6]=f+p,t[1]=h+x,t[4]=1-u-M,t[7]=d-v,t[2]=f-p,t[5]=d+v,t[8]=1-u-c,t},j.normalFromMat4=function(t,e){var r=e[0],a=e[1],n=e[2],o=e[3],i=e[4],s=e[5],l=e[6],u=e[7],h=e[8],c=e[9],f=e[10],d=e[11],M=e[12],v=e[13],p=e[14],x=e[15],m=r*s-a*i,S=r*l-n*i,g=r*u-o*i,y=a*l-n*s,b=a*u-o*s,_=n*u-o*l,I=h*v-c*M,D=h*p-f*M,F=h*x-d*M,w=c*p-f*v,A=c*x-d*v,E=f*x-d*p,z=m*E-S*A+g*w+y*F-b*D+_*I;return z?(z=1/z,t[0]=(s*E-l*A+u*w)*z,t[1]=(l*F-i*E-u*D)*z,t[2]=(i*A-s*F+u*I)*z,t[3]=(n*A-a*E-o*w)*z,t[4]=(r*E-n*F+o*D)*z,t[5]=(a*F-r*A-o*I)*z,t[6]=(v*_-p*b+x*y)*z,t[7]=(p*g-M*_-x*S)*z,t[8]=(M*b-v*g+x*m)*z,t):null},j.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},j.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},j.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},j.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t},j.sub=j.subtract,j.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},j.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t[6]=e[6]+r[6]*a,t[7]=e[7]+r[7]*a,t[8]=e[8]+r[8]*a,t},j.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},j.equals=function(t,e){var r=t[0],a=t[1],n=t[2],o=t[3],i=t[4],s=t[5],l=t[6],u=t[7],h=t[8],c=e[0],f=e[1],d=e[2],M=e[3],v=e[4],p=e[5],x=t[6],m=e[7],S=e[8];return Math.abs(r-c)<=U.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(a-f)<=U.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(n-d)<=U.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-M)<=U.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(i-v)<=U.EPSILON*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(s-p)<=U.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(l-x)<=U.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(u-m)<=U.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(h-S)<=U.EPSILON*Math.max(1,Math.abs(h),Math.abs(S))};var W=j,G=Y,J={scalar:{},SIMD:{}};J.create=function(){var t=new G.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},J.clone=function(t){var e=new G.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},J.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},J.fromValues=function(t,e,r,a,n,o,i,s,l,u,h,c,f,d,M,v){var p=new G.ARRAY_TYPE(16);return p[0]=t,p[1]=e,p[2]=r,p[3]=a,p[4]=n,p[5]=o,p[6]=i,p[7]=s,p[8]=l,p[9]=u,p[10]=h,p[11]=c,p[12]=f,p[13]=d,p[14]=M,p[15]=v,p},J.set=function(t,e,r,a,n,o,i,s,l,u,h,c,f,d,M,v,p){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t[4]=o,t[5]=i,t[6]=s,t[7]=l,t[8]=u,t[9]=h,t[10]=c,t[11]=f,t[12]=d,t[13]=M,t[14]=v,t[15]=p,t},J.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},J.scalar.transpose=function(t,e){if(t===e){var r=e[1],a=e[2],n=e[3],o=e[6],i=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=a,t[9]=o,t[11]=e[14],t[12]=n,t[13]=i,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},J.SIMD.transpose=function(t,e){var r,a,n,o,i,s,l,u,h,c;return r=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),i=SIMD.Float32x4.shuffle(r,a,0,1,4,5),s=SIMD.Float32x4.shuffle(n,o,0,1,4,5),l=SIMD.Float32x4.shuffle(i,s,0,2,4,6),u=SIMD.Float32x4.shuffle(i,s,1,3,5,7),SIMD.Float32x4.store(t,0,l),SIMD.Float32x4.store(t,4,u),i=SIMD.Float32x4.shuffle(r,a,2,3,6,7),s=SIMD.Float32x4.shuffle(n,o,2,3,6,7),h=SIMD.Float32x4.shuffle(i,s,0,2,4,6),c=SIMD.Float32x4.shuffle(i,s,1,3,5,7),SIMD.Float32x4.store(t,8,h),SIMD.Float32x4.store(t,12,c),t},J.transpose=G.USE_SIMD?J.SIMD.transpose:J.scalar.transpose,J.scalar.invert=function(t,e){var r=e[0],a=e[1],n=e[2],o=e[3],i=e[4],s=e[5],l=e[6],u=e[7],h=e[8],c=e[9],f=e[10],d=e[11],M=e[12],v=e[13],p=e[14],x=e[15],m=r*s-a*i,S=r*l-n*i,g=r*u-o*i,y=a*l-n*s,b=a*u-o*s,_=n*u-o*l,I=h*v-c*M,D=h*p-f*M,F=h*x-d*M,w=c*p-f*v,A=c*x-d*v,E=f*x-d*p,z=m*E-S*A+g*w+y*F-b*D+_*I;return z?(z=1/z,t[0]=(s*E-l*A+u*w)*z,t[1]=(n*A-a*E-o*w)*z,t[2]=(v*_-p*b+x*y)*z,t[3]=(f*b-c*_-d*y)*z,t[4]=(l*F-i*E-u*D)*z,t[5]=(r*E-n*F+o*D)*z,t[6]=(p*g-M*_-x*S)*z,t[7]=(h*_-f*g+d*S)*z,t[8]=(i*A-s*F+u*I)*z,t[9]=(a*F-r*A-o*I)*z,t[10]=(M*b-v*g+x*m)*z,t[11]=(c*g-h*b-d*m)*z,t[12]=(s*D-i*w-l*I)*z,t[13]=(r*w-a*D+n*I)*z,t[14]=(v*S-M*y-p*m)*z,t[15]=(h*y-c*S+f*m)*z,t):null},J.SIMD.invert=function(t,e){var r,a,n,o,i,s,l,u,h,c,f=SIMD.Float32x4.load(e,0),d=SIMD.Float32x4.load(e,4),M=SIMD.Float32x4.load(e,8),v=SIMD.Float32x4.load(e,12);return i=SIMD.Float32x4.shuffle(f,d,0,1,4,5),a=SIMD.Float32x4.shuffle(M,v,0,1,4,5),r=SIMD.Float32x4.shuffle(i,a,0,2,4,6),a=SIMD.Float32x4.shuffle(a,i,1,3,5,7),i=SIMD.Float32x4.shuffle(f,d,2,3,6,7),o=SIMD.Float32x4.shuffle(M,v,2,3,6,7),n=SIMD.Float32x4.shuffle(i,o,0,2,4,6),o=SIMD.Float32x4.shuffle(o,i,1,3,5,7),i=SIMD.Float32x4.mul(n,o),i=SIMD.Float32x4.swizzle(i,1,0,3,2),s=SIMD.Float32x4.mul(a,i),l=SIMD.Float32x4.mul(r,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,i),s),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,i),l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),i=SIMD.Float32x4.mul(a,n),i=SIMD.Float32x4.swizzle(i,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),s),h=SIMD.Float32x4.mul(r,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(o,i)),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,i),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),i=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(a,2,3,0,1),o),i=SIMD.Float32x4.swizzle(i,1,0,3,2),n=SIMD.Float32x4.swizzle(n,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,i),s),u=SIMD.Float32x4.mul(r,i),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(n,i)),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,i),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),i=SIMD.Float32x4.mul(r,a),i=SIMD.Float32x4.swizzle(i,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),u),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,i),h),i=SIMD.Float32x4.swizzle(i,2,3,0,1),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,i),u),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(n,i)),i=SIMD.Float32x4.mul(r,o),i=SIMD.Float32x4.swizzle(i,1,0,3,2),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(n,i)),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,i),u),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,i),l),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(a,i)),i=SIMD.Float32x4.mul(r,n),i=SIMD.Float32x4.swizzle(i,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),l),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(a,i)),i=SIMD.Float32x4.swizzle(i,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(o,i)),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,i),h),c=SIMD.Float32x4.mul(r,s),c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,2,3,0,1),c),c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,1,0,3,2),c),i=SIMD.Float32x4.reciprocalApproximation(c),c=SIMD.Float32x4.sub(SIMD.Float32x4.add(i,i),SIMD.Float32x4.mul(c,SIMD.Float32x4.mul(i,i))),(c=SIMD.Float32x4.swizzle(c,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(c,s)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(c,l)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(c,u)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(c,h)),t):null},J.invert=G.USE_SIMD?J.SIMD.invert:J.scalar.invert,J.scalar.adjoint=function(t,e){var r=e[0],a=e[1],n=e[2],o=e[3],i=e[4],s=e[5],l=e[6],u=e[7],h=e[8],c=e[9],f=e[10],d=e[11],M=e[12],v=e[13],p=e[14],x=e[15];return t[0]=s*(f*x-d*p)-c*(l*x-u*p)+v*(l*d-u*f),t[1]=-(a*(f*x-d*p)-c*(n*x-o*p)+v*(n*d-o*f)),t[2]=a*(l*x-u*p)-s*(n*x-o*p)+v*(n*u-o*l),t[3]=-(a*(l*d-u*f)-s*(n*d-o*f)+c*(n*u-o*l)),t[4]=-(i*(f*x-d*p)-h*(l*x-u*p)+M*(l*d-u*f)),t[5]=r*(f*x-d*p)-h*(n*x-o*p)+M*(n*d-o*f),t[6]=-(r*(l*x-u*p)-i*(n*x-o*p)+M*(n*u-o*l)),t[7]=r*(l*d-u*f)-i*(n*d-o*f)+h*(n*u-o*l),t[8]=i*(c*x-d*v)-h*(s*x-u*v)+M*(s*d-u*c),t[9]=-(r*(c*x-d*v)-h*(a*x-o*v)+M*(a*d-o*c)),t[10]=r*(s*x-u*v)-i*(a*x-o*v)+M*(a*u-o*s),t[11]=-(r*(s*d-u*c)-i*(a*d-o*c)+h*(a*u-o*s)),t[12]=-(i*(c*p-f*v)-h*(s*p-l*v)+M*(s*f-l*c)),t[13]=r*(c*p-f*v)-h*(a*p-n*v)+M*(a*f-n*c),t[14]=-(r*(s*p-l*v)-i*(a*p-n*v)+M*(a*l-n*s)),t[15]=r*(s*f-l*c)-i*(a*f-n*c)+h*(a*l-n*s),t},J.SIMD.adjoint=function(t,e){var r,a,n,o,i,s,l,u,h,c,f,d,M,r=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12);return h=SIMD.Float32x4.shuffle(r,a,0,1,4,5),s=SIMD.Float32x4.shuffle(n,o,0,1,4,5),i=SIMD.Float32x4.shuffle(h,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,h,1,3,5,7),h=SIMD.Float32x4.shuffle(r,a,2,3,6,7),u=SIMD.Float32x4.shuffle(n,o,2,3,6,7),l=SIMD.Float32x4.shuffle(h,u,0,2,4,6),u=SIMD.Float32x4.shuffle(u,h,1,3,5,7),h=SIMD.Float32x4.mul(l,u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),c=SIMD.Float32x4.mul(s,h),f=SIMD.Float32x4.mul(i,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,h),c),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,h),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),h=SIMD.Float32x4.mul(s,l),h=SIMD.Float32x4.swizzle(h,1,0,3,2),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),c),M=SIMD.Float32x4.mul(i,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(u,h)),M=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,h),M),M=SIMD.Float32x4.swizzle(M,2,3,0,1),h=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,3,0,1),u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),l=SIMD.Float32x4.swizzle(l,2,3,0,1),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,h),c),d=SIMD.Float32x4.mul(i,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(l,h)),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,h),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),h=SIMD.Float32x4.mul(i,s),h=SIMD.Float32x4.swizzle(h,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),d),M=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,h),M),h=SIMD.Float32x4.swizzle(h,2,3,0,1),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,h),d),M=SIMD.Float32x4.sub(M,SIMD.Float32x4.mul(l,h)),h=SIMD.Float32x4.mul(i,u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(l,h)),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,h),d),h=SIMD.Float32x4.swizzle(h,2,3,0,1),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,h),f),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(s,h)),h=SIMD.Float32x4.mul(i,l),h=SIMD.Float32x4.swizzle(h,1,0,3,2),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),f),M=SIMD.Float32x4.sub(M,SIMD.Float32x4.mul(s,h)),h=SIMD.Float32x4.swizzle(h,2,3,0,1),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(u,h)),M=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,h),M),SIMD.Float32x4.store(t,0,c),SIMD.Float32x4.store(t,4,f),SIMD.Float32x4.store(t,8,d),SIMD.Float32x4.store(t,12,M),t},J.adjoint=G.USE_SIMD?J.SIMD.adjoint:J.scalar.adjoint,J.determinant=function(t){var e=t[0],r=t[1],a=t[2],n=t[3],o=t[4],i=t[5],s=t[6],l=t[7],u=t[8],h=t[9],c=t[10],f=t[11],d=t[12],M=t[13],v=t[14],p=t[15],x=e*i-r*o,m=e*s-a*o,S=e*l-n*o,g=r*s-a*i,y=r*l-n*i,b=a*l-n*s,_=u*M-h*d,I=u*v-c*d,D=u*p-f*d,F=h*v-c*M,w=h*p-f*M,A=c*p-f*v;return x*A-m*w+S*F+g*D-y*I+b*_},J.SIMD.multiply=function(t,e,r){var a=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),i=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.load(r,0),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),i))));SIMD.Float32x4.store(t,0,l);var u=SIMD.Float32x4.load(r,4),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,0,0,0,0),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,3,3,3,3),i))));SIMD.Float32x4.store(t,4,h);var c=SIMD.Float32x4.load(r,8),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,0,0,0,0),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,3,3,3,3),i))));SIMD.Float32x4.store(t,8,f);var d=SIMD.Float32x4.load(r,12),M=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,0,0,0,0),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,3,3,3,3),i))));return SIMD.Float32x4.store(t,12,M),t},J.scalar.multiply=function(t,e,r){var a=e[0],n=e[1],o=e[2],i=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=e[9],d=e[10],M=e[11],v=e[12],p=e[13],x=e[14],m=e[15],S=r[0],g=r[1],y=r[2],b=r[3];return t[0]=S*a+g*s+y*c+b*v,t[1]=S*n+g*l+y*f+b*p,t[2]=S*o+g*u+y*d+b*x,t[3]=S*i+g*h+y*M+b*m,S=r[4],g=r[5],y=r[6],b=r[7],t[4]=S*a+g*s+y*c+b*v,t[5]=S*n+g*l+y*f+b*p,t[6]=S*o+g*u+y*d+b*x,t[7]=S*i+g*h+y*M+b*m,S=r[8],g=r[9],y=r[10],b=r[11],t[8]=S*a+g*s+y*c+b*v,t[9]=S*n+g*l+y*f+b*p,t[10]=S*o+g*u+y*d+b*x,t[11]=S*i+g*h+y*M+b*m,S=r[12],g=r[13],y=r[14],b=r[15],t[12]=S*a+g*s+y*c+b*v,t[13]=S*n+g*l+y*f+b*p,t[14]=S*o+g*u+y*d+b*x,t[15]=S*i+g*h+y*M+b*m,t},J.multiply=G.USE_SIMD?J.SIMD.multiply:J.scalar.multiply,J.mul=J.multiply,J.scalar.translate=function(t,e,r){var a,n,o,i,s,l,u,h,c,f,d,M,v=r[0],p=r[1],x=r[2];return e===t?(t[12]=e[0]*v+e[4]*p+e[8]*x+e[12],t[13]=e[1]*v+e[5]*p+e[9]*x+e[13],t[14]=e[2]*v+e[6]*p+e[10]*x+e[14],t[15]=e[3]*v+e[7]*p+e[11]*x+e[15]):(a=e[0],n=e[1],o=e[2],i=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=e[9],d=e[10],M=e[11],t[0]=a,t[1]=n,t[2]=o,t[3]=i,t[4]=s,t[5]=l,t[6]=u,t[7]=h,t[8]=c,t[9]=f,t[10]=d,t[11]=M,t[12]=a*v+s*p+c*x+e[12],t[13]=n*v+l*p+f*x+e[13],t[14]=o*v+u*p+d*x+e[14],t[15]=i*v+h*p+M*x+e[15]),t},J.SIMD.translate=function(t,e,r){var a=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),i=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4(r[0],r[1],r[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(s,0,0,0,0)),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,1,1,1,1)),o=SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(s,2,2,2,2));var l=SIMD.Float32x4.add(a,SIMD.Float32x4.add(n,SIMD.Float32x4.add(o,i)));return SIMD.Float32x4.store(t,12,l),t},J.translate=G.USE_SIMD?J.SIMD.translate:J.scalar.translate,J.scalar.scale=function(t,e,r){var a=r[0],n=r[1],o=r[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},J.SIMD.scale=function(t,e,r){var a,n,o,i=SIMD.Float32x4(r[0],r[1],r[2],0);return a=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(i,0,0,0,0))),n=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(i,1,1,1,1))),o=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(i,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},J.scale=G.USE_SIMD?J.SIMD.scale:J.scalar.scale,J.rotate=function(t,e,r,a){var n,o,i,s,l,u,h,c,f,d,M,v,p,x,m,S,g,y,b,_,I,D,F,w,A=a[0],E=a[1],z=a[2],C=Math.sqrt(A*A+E*E+z*z);return Math.abs(C)<G.EPSILON?null:(C=1/C,A*=C,E*=C,z*=C,n=Math.sin(r),o=Math.cos(r),i=1-o,s=e[0],l=e[1],u=e[2],h=e[3],c=e[4],f=e[5],d=e[6],M=e[7],v=e[8],p=e[9],x=e[10],m=e[11],S=A*A*i+o,g=E*A*i+z*n,y=z*A*i-E*n,b=A*E*i-z*n,_=E*E*i+o,I=z*E*i+A*n,D=A*z*i+E*n,F=E*z*i-A*n,w=z*z*i+o,t[0]=s*S+c*g+v*y,t[1]=l*S+f*g+p*y,t[2]=u*S+d*g+x*y,t[3]=h*S+M*g+m*y,t[4]=s*b+c*_+v*I,t[5]=l*b+f*_+p*I,t[6]=u*b+d*_+x*I,t[7]=h*b+M*_+m*I,t[8]=s*D+c*F+v*w,t[9]=l*D+f*F+p*w,t[10]=u*D+d*F+x*w,t[11]=h*D+M*F+m*w,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},J.scalar.rotateX=function(t,e,r){var a=Math.sin(r),n=Math.cos(r),o=e[4],i=e[5],s=e[6],l=e[7],u=e[8],h=e[9],c=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+u*a,t[5]=i*n+h*a,t[6]=s*n+c*a,t[7]=l*n+f*a,t[8]=u*n-o*a,t[9]=h*n-i*a,t[10]=c*n-s*a,t[11]=f*n-l*a,t},J.SIMD.rotateX=function(t,e,r){var a=SIMD.Float32x4.splat(Math.sin(r)),n=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,4),i=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,n),SIMD.Float32x4.mul(i,a))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,n),SIMD.Float32x4.mul(o,a))),t},J.rotateX=G.USE_SIMD?J.SIMD.rotateX:J.scalar.rotateX,J.scalar.rotateY=function(t,e,r){var a=Math.sin(r),n=Math.cos(r),o=e[0],i=e[1],s=e[2],l=e[3],u=e[8],h=e[9],c=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n-u*a,t[1]=i*n-h*a,t[2]=s*n-c*a,t[3]=l*n-f*a,t[8]=o*a+u*n,t[9]=i*a+h*n,t[10]=s*a+c*n,t[11]=l*a+f*n,t},J.SIMD.rotateY=function(t,e,r){var a=SIMD.Float32x4.splat(Math.sin(r)),n=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,n),SIMD.Float32x4.mul(i,a))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),SIMD.Float32x4.mul(i,n))),t},J.rotateY=G.USE_SIMD?J.SIMD.rotateY:J.scalar.rotateY,J.scalar.rotateZ=function(t,e,r){var a=Math.sin(r),n=Math.cos(r),o=e[0],i=e[1],s=e[2],l=e[3],u=e[4],h=e[5],c=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+u*a,t[1]=i*n+h*a,t[2]=s*n+c*a,t[3]=l*n+f*a,t[4]=u*n-o*a,t[5]=h*n-i*a,t[6]=c*n-s*a,t[7]=f*n-l*a,t},J.SIMD.rotateZ=function(t,e,r){var a=SIMD.Float32x4.splat(Math.sin(r)),n=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,n),SIMD.Float32x4.mul(i,a))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,n),SIMD.Float32x4.mul(o,a))),t},J.rotateZ=G.USE_SIMD?J.SIMD.rotateZ:J.scalar.rotateZ,J.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},J.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},J.fromRotation=function(t,e,r){var a,n,o,i=r[0],s=r[1],l=r[2],u=Math.sqrt(i*i+s*s+l*l);return Math.abs(u)<G.EPSILON?null:(u=1/u,i*=u,s*=u,l*=u,a=Math.sin(e),n=Math.cos(e),o=1-n,t[0]=i*i*o+n,t[1]=s*i*o+l*a,t[2]=l*i*o-s*a,t[3]=0,t[4]=i*s*o-l*a,t[5]=s*s*o+n,t[6]=l*s*o+i*a,t[7]=0,t[8]=i*l*o+s*a,t[9]=s*l*o-i*a,t[10]=l*l*o+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},J.fromXRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},J.fromYRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},J.fromZRotation=function(t,e){var r=Math.sin(e),a=Math.cos(e);return t[0]=a,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},J.fromRotationTranslation=function(t,e,r){var a=e[0],n=e[1],o=e[2],i=e[3],s=a+a,l=n+n,u=o+o,h=a*s,c=a*l,f=a*u,d=n*l,M=n*u,v=o*u,p=i*s,x=i*l,m=i*u;return t[0]=1-(d+v),t[1]=c+m,t[2]=f-x,t[3]=0,t[4]=c-m,t[5]=1-(h+v),t[6]=M+p,t[7]=0,t[8]=f+x,t[9]=M-p,t[10]=1-(h+d),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},J.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},J.getRotation=function(t,e){var r=e[0]+e[5]+e[10],a=0;return r>0?(a=2*Math.sqrt(r+1),t[3]=.25*a,t[0]=(e[6]-e[9])/a,t[1]=(e[8]-e[2])/a,t[2]=(e[1]-e[4])/a):e[0]>e[5]&e[0]>e[10]?(a=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/a,t[0]=.25*a,t[1]=(e[1]+e[4])/a,t[2]=(e[8]+e[2])/a):e[5]>e[10]?(a=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/a,t[0]=(e[1]+e[4])/a,t[1]=.25*a,t[2]=(e[6]+e[9])/a):(a=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/a,t[0]=(e[8]+e[2])/a,t[1]=(e[6]+e[9])/a,t[2]=.25*a),t},J.fromRotationTranslationScale=function(t,e,r,a){var n=e[0],o=e[1],i=e[2],s=e[3],l=n+n,u=o+o,h=i+i,c=n*l,f=n*u,d=n*h,M=o*u,v=o*h,p=i*h,x=s*l,m=s*u,S=s*h,g=a[0],y=a[1],b=a[2];return t[0]=(1-(M+p))*g,t[1]=(f+S)*g,t[2]=(d-m)*g,t[3]=0,t[4]=(f-S)*y,t[5]=(1-(c+p))*y,t[6]=(v+x)*y,t[7]=0,t[8]=(d+m)*b,t[9]=(v-x)*b,t[10]=(1-(c+M))*b,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},J.fromRotationTranslationScaleOrigin=function(t,e,r,a,n){var o=e[0],i=e[1],s=e[2],l=e[3],u=o+o,h=i+i,c=s+s,f=o*u,d=o*h,M=o*c,v=i*h,p=i*c,x=s*c,m=l*u,S=l*h,g=l*c,y=a[0],b=a[1],_=a[2],I=n[0],D=n[1],F=n[2];return t[0]=(1-(v+x))*y,t[1]=(d+g)*y,t[2]=(M-S)*y,t[3]=0,t[4]=(d-g)*b,
t[5]=(1-(f+x))*b,t[6]=(p+m)*b,t[7]=0,t[8]=(M+S)*_,t[9]=(p-m)*_,t[10]=(1-(f+v))*_,t[11]=0,t[12]=r[0]+I-(t[0]*I+t[4]*D+t[8]*F),t[13]=r[1]+D-(t[1]*I+t[5]*D+t[9]*F),t[14]=r[2]+F-(t[2]*I+t[6]*D+t[10]*F),t[15]=1,t},J.fromQuat=function(t,e){var r=e[0],a=e[1],n=e[2],o=e[3],i=r+r,s=a+a,l=n+n,u=r*i,h=a*i,c=a*s,f=n*i,d=n*s,M=n*l,v=o*i,p=o*s,x=o*l;return t[0]=1-c-M,t[1]=h+x,t[2]=f-p,t[3]=0,t[4]=h-x,t[5]=1-u-M,t[6]=d+v,t[7]=0,t[8]=f+p,t[9]=d-v,t[10]=1-u-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},J.frustum=function(t,e,r,a,n,o,i){var s=1/(r-e),l=1/(n-a),u=1/(o-i);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(n+a)*l,t[10]=(i+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*o*2*u,t[15]=0,t},J.perspective=function(t,e,r,a,n){var o=1/Math.tan(e/2),i=1/(a-n);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+a)*i,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*a*i,t[15]=0,t},J.perspectiveFromFieldOfView=function(t,e,r,a){var n=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),i=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),l=2/(i+s),u=2/(n+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((i-s)*l*.5),t[9]=(n-o)*u*.5,t[10]=a/(r-a),t[11]=-1,t[12]=0,t[13]=0,t[14]=a*r/(r-a),t[15]=0,t},J.ortho=function(t,e,r,a,n,o,i){var s=1/(e-r),l=1/(a-n),u=1/(o-i);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*s,t[13]=(n+a)*l,t[14]=(i+o)*u,t[15]=1,t},J.lookAt=function(t,e,r,a){var n,o,i,s,l,u,h,c,f,d,M=e[0],v=e[1],p=e[2],x=a[0],m=a[1],S=a[2],g=r[0],y=r[1],b=r[2];return Math.abs(M-g)<G.EPSILON&&Math.abs(v-y)<G.EPSILON&&Math.abs(p-b)<G.EPSILON?J.identity(t):(h=M-g,c=v-y,f=p-b,d=1/Math.sqrt(h*h+c*c+f*f),h*=d,c*=d,f*=d,n=m*f-S*c,o=S*h-x*f,i=x*c-m*h,d=Math.sqrt(n*n+o*o+i*i),d?(d=1/d,n*=d,o*=d,i*=d):(n=0,o=0,i=0),s=c*i-f*o,l=f*n-h*i,u=h*o-c*n,d=Math.sqrt(s*s+l*l+u*u),d?(d=1/d,s*=d,l*=d,u*=d):(s=0,l=0,u=0),t[0]=n,t[1]=s,t[2]=h,t[3]=0,t[4]=o,t[5]=l,t[6]=c,t[7]=0,t[8]=i,t[9]=u,t[10]=f,t[11]=0,t[12]=-(n*M+o*v+i*p),t[13]=-(s*M+l*v+u*p),t[14]=-(h*M+c*v+f*p),t[15]=1,t)},J.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},J.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},J.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},J.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t},J.sub=J.subtract,J.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},J.multiplyScalarAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t[4]=e[4]+r[4]*a,t[5]=e[5]+r[5]*a,t[6]=e[6]+r[6]*a,t[7]=e[7]+r[7]*a,t[8]=e[8]+r[8]*a,t[9]=e[9]+r[9]*a,t[10]=e[10]+r[10]*a,t[11]=e[11]+r[11]*a,t[12]=e[12]+r[12]*a,t[13]=e[13]+r[13]*a,t[14]=e[14]+r[14]*a,t[15]=e[15]+r[15]*a,t},J.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},J.equals=function(t,e){var r=t[0],a=t[1],n=t[2],o=t[3],i=t[4],s=t[5],l=t[6],u=t[7],h=t[8],c=t[9],f=t[10],d=t[11],M=t[12],v=t[13],p=t[14],x=t[15],m=e[0],S=e[1],g=e[2],y=e[3],b=e[4],_=e[5],I=e[6],D=e[7],F=e[8],w=e[9],A=e[10],E=e[11],z=e[12],C=e[13],P=e[14],R=e[15];return Math.abs(r-m)<=G.EPSILON*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(a-S)<=G.EPSILON*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(n-g)<=G.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-y)<=G.EPSILON*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(i-b)<=G.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(s-_)<=G.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(l-I)<=G.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(u-D)<=G.EPSILON*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(h-F)<=G.EPSILON*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(c-w)<=G.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(f-A)<=G.EPSILON*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(d-E)<=G.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(M-z)<=G.EPSILON*Math.max(1,Math.abs(M),Math.abs(z))&&Math.abs(v-C)<=G.EPSILON*Math.max(1,Math.abs(v),Math.abs(C))&&Math.abs(p-P)<=G.EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(x-R)<=G.EPSILON*Math.max(1,Math.abs(x),Math.abs(R))};var X=J,Z=Y,H={};H.create=function(){var t=new Z.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},H.clone=function(t){var e=new Z.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},H.fromValues=function(t,e,r){var a=new Z.ARRAY_TYPE(3);return a[0]=t,a[1]=e,a[2]=r,a},H.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},H.set=function(t,e,r,a){return t[0]=e,t[1]=r,t[2]=a,t},H.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},H.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},H.sub=H.subtract,H.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},H.mul=H.multiply,H.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},H.div=H.divide,H.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},H.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},H.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},H.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},H.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},H.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},H.scaleAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t},H.distance=function(t,e){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+a*a+n*n)},H.dist=H.distance,H.squaredDistance=function(t,e){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2];return r*r+a*a+n*n},H.sqrDist=H.squaredDistance,H.length=function(t){var e=t[0],r=t[1],a=t[2];return Math.sqrt(e*e+r*r+a*a)},H.len=H.length,H.squaredLength=function(t){var e=t[0],r=t[1],a=t[2];return e*e+r*r+a*a},H.sqrLen=H.squaredLength,H.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},H.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},H.normalize=function(t,e){var r=e[0],a=e[1],n=e[2],o=r*r+a*a+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},H.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},H.cross=function(t,e,r){var a=e[0],n=e[1],o=e[2],i=r[0],s=r[1],l=r[2];return t[0]=n*l-o*s,t[1]=o*i-a*l,t[2]=a*s-n*i,t},H.lerp=function(t,e,r,a){var n=e[0],o=e[1],i=e[2];return t[0]=n+a*(r[0]-n),t[1]=o+a*(r[1]-o),t[2]=i+a*(r[2]-i),t},H.hermite=function(t,e,r,a,n,o){var i=o*o,s=i*(2*o-3)+1,l=i*(o-2)+o,u=i*(o-1),h=i*(3-2*o);return t[0]=e[0]*s+r[0]*l+a[0]*u+n[0]*h,t[1]=e[1]*s+r[1]*l+a[1]*u+n[1]*h,t[2]=e[2]*s+r[2]*l+a[2]*u+n[2]*h,t},H.bezier=function(t,e,r,a,n,o){var i=1-o,s=i*i,l=o*o,u=s*i,h=3*o*s,c=3*l*i,f=l*o;return t[0]=e[0]*u+r[0]*h+a[0]*c+n[0]*f,t[1]=e[1]*u+r[1]*h+a[1]*c+n[1]*f,t[2]=e[2]*u+r[2]*h+a[2]*c+n[2]*f,t},H.random=function(t,e){e=e||1;var r=2*Z.RANDOM()*Math.PI,a=2*Z.RANDOM()-1,n=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=a*e,t},H.transformMat4=function(t,e,r){var a=e[0],n=e[1],o=e[2],i=r[3]*a+r[7]*n+r[11]*o+r[15];return i=i||1,t[0]=(r[0]*a+r[4]*n+r[8]*o+r[12])/i,t[1]=(r[1]*a+r[5]*n+r[9]*o+r[13])/i,t[2]=(r[2]*a+r[6]*n+r[10]*o+r[14])/i,t},H.transformMat3=function(t,e,r){var a=e[0],n=e[1],o=e[2];return t[0]=a*r[0]+n*r[3]+o*r[6],t[1]=a*r[1]+n*r[4]+o*r[7],t[2]=a*r[2]+n*r[5]+o*r[8],t},H.transformQuat=function(t,e,r){var a=e[0],n=e[1],o=e[2],i=r[0],s=r[1],l=r[2],u=r[3],h=u*a+s*o-l*n,c=u*n+l*a-i*o,f=u*o+i*n-s*a,d=-i*a-s*n-l*o;return t[0]=h*u+d*-i+c*-l-f*-s,t[1]=c*u+d*-s+f*-i-h*-l,t[2]=f*u+d*-l+h*-s-c*-i,t},H.rotateX=function(t,e,r,a){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[0],o[1]=n[1]*Math.cos(a)-n[2]*Math.sin(a),o[2]=n[1]*Math.sin(a)+n[2]*Math.cos(a),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},H.rotateY=function(t,e,r,a){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[2]*Math.sin(a)+n[0]*Math.cos(a),o[1]=n[1],o[2]=n[2]*Math.cos(a)-n[0]*Math.sin(a),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},H.rotateZ=function(t,e,r,a){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[0]*Math.cos(a)-n[1]*Math.sin(a),o[1]=n[0]*Math.sin(a)+n[1]*Math.cos(a),o[2]=n[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},H.forEach=function(){var t=H.create();return function(e,r,a,n,o,i){var s,l;for(r||(r=3),a||(a=0),l=n?Math.min(n*r+a,e.length):e.length,s=a;s<l;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,i),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),H.angle=function(t,e){var r=H.fromValues(t[0],t[1],t[2]),a=H.fromValues(e[0],e[1],e[2]);H.normalize(r,r),H.normalize(a,a);var n=H.dot(r,a);return n>1?0:Math.acos(n)},H.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},H.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},H.equals=function(t,e){var r=t[0],a=t[1],n=t[2],o=e[0],i=e[1],s=e[2];return Math.abs(r-o)<=Z.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-i)<=Z.EPSILON*Math.max(1,Math.abs(a),Math.abs(i))&&Math.abs(n-s)<=Z.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))};var K=H,Q=Y,$={};$.create=function(){var t=new Q.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},$.clone=function(t){var e=new Q.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},$.fromValues=function(t,e,r,a){var n=new Q.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=a,n},$.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},$.set=function(t,e,r,a,n){return t[0]=e,t[1]=r,t[2]=a,t[3]=n,t},$.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},$.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t},$.sub=$.subtract,$.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t},$.mul=$.multiply,$.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t},$.div=$.divide,$.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},$.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},$.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},$.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},$.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},$.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},$.scaleAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t[2]=e[2]+r[2]*a,t[3]=e[3]+r[3]*a,t},$.distance=function(t,e){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(r*r+a*a+n*n+o*o)},$.dist=$.distance,$.squaredDistance=function(t,e){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2],o=e[3]-t[3];return r*r+a*a+n*n+o*o},$.sqrDist=$.squaredDistance,$.length=function(t){var e=t[0],r=t[1],a=t[2],n=t[3];return Math.sqrt(e*e+r*r+a*a+n*n)},$.len=$.length,$.squaredLength=function(t){var e=t[0],r=t[1],a=t[2],n=t[3];return e*e+r*r+a*a+n*n},$.sqrLen=$.squaredLength,$.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},$.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},$.normalize=function(t,e){var r=e[0],a=e[1],n=e[2],o=e[3],i=r*r+a*a+n*n+o*o;return i>0&&(i=1/Math.sqrt(i),t[0]=r*i,t[1]=a*i,t[2]=n*i,t[3]=o*i),t},$.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},$.lerp=function(t,e,r,a){var n=e[0],o=e[1],i=e[2],s=e[3];return t[0]=n+a*(r[0]-n),t[1]=o+a*(r[1]-o),t[2]=i+a*(r[2]-i),t[3]=s+a*(r[3]-s),t},$.random=function(t,e){return e=e||1,t[0]=Q.RANDOM(),t[1]=Q.RANDOM(),t[2]=Q.RANDOM(),t[3]=Q.RANDOM(),$.normalize(t,t),$.scale(t,t,e),t},$.transformMat4=function(t,e,r){var a=e[0],n=e[1],o=e[2],i=e[3];return t[0]=r[0]*a+r[4]*n+r[8]*o+r[12]*i,t[1]=r[1]*a+r[5]*n+r[9]*o+r[13]*i,t[2]=r[2]*a+r[6]*n+r[10]*o+r[14]*i,t[3]=r[3]*a+r[7]*n+r[11]*o+r[15]*i,t},$.transformQuat=function(t,e,r){var a=e[0],n=e[1],o=e[2],i=r[0],s=r[1],l=r[2],u=r[3],h=u*a+s*o-l*n,c=u*n+l*a-i*o,f=u*o+i*n-s*a,d=-i*a-s*n-l*o;return t[0]=h*u+d*-i+c*-l-f*-s,t[1]=c*u+d*-s+f*-i-h*-l,t[2]=f*u+d*-l+h*-s-c*-i,t[3]=e[3],t},$.forEach=function(){var t=$.create();return function(e,r,a,n,o,i){var s,l;for(r||(r=4),a||(a=0),l=n?Math.min(n*r+a,e.length):e.length,s=a;s<l;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,i),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),$.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},$.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},$.equals=function(t,e){var r=t[0],a=t[1],n=t[2],o=t[3],i=e[0],s=e[1],l=e[2],u=e[3];return Math.abs(r-i)<=Q.EPSILON*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(a-s)<=Q.EPSILON*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(n-l)<=Q.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-u)<=Q.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))};var tt=$,et=Y,rt=W,at=K,nt=tt,ot={};ot.create=function(){var t=new et.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},ot.rotationTo=function(){var t=at.create(),e=at.fromValues(1,0,0),r=at.fromValues(0,1,0);return function(a,n,o){var i=at.dot(n,o);return i<-.999999?(at.cross(t,e,n),at.length(t)<1e-6&&at.cross(t,r,n),at.normalize(t,t),ot.setAxisAngle(a,t,Math.PI),a):i>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(at.cross(t,n,o),a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=1+i,ot.normalize(a,a))}}(),ot.setAxes=function(){var t=rt.create();return function(e,r,a,n){return t[0]=a[0],t[3]=a[1],t[6]=a[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],ot.normalize(e,ot.fromMat3(e,t))}}(),ot.clone=nt.clone,ot.fromValues=nt.fromValues,ot.copy=nt.copy,ot.set=nt.set,ot.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},ot.setAxisAngle=function(t,e,r){r*=.5;var a=Math.sin(r);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(r),t},ot.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),a=Math.sin(r/2);return 0!=a?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),r},ot.add=nt.add,ot.multiply=function(t,e,r){var a=e[0],n=e[1],o=e[2],i=e[3],s=r[0],l=r[1],u=r[2],h=r[3];return t[0]=a*h+i*s+n*u-o*l,t[1]=n*h+i*l+o*s-a*u,t[2]=o*h+i*u+a*l-n*s,t[3]=i*h-a*s-n*l-o*u,t},ot.mul=ot.multiply,ot.scale=nt.scale,ot.rotateX=function(t,e,r){r*=.5;var a=e[0],n=e[1],o=e[2],i=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=a*l+i*s,t[1]=n*l+o*s,t[2]=o*l-n*s,t[3]=i*l-a*s,t},ot.rotateY=function(t,e,r){r*=.5;var a=e[0],n=e[1],o=e[2],i=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=a*l-o*s,t[1]=n*l+i*s,t[2]=o*l+a*s,t[3]=i*l-n*s,t},ot.rotateZ=function(t,e,r){r*=.5;var a=e[0],n=e[1],o=e[2],i=e[3],s=Math.sin(r),l=Math.cos(r);return t[0]=a*l+n*s,t[1]=n*l-a*s,t[2]=o*l+i*s,t[3]=i*l-o*s,t},ot.calculateW=function(t,e){var r=e[0],a=e[1],n=e[2];return t[0]=r,t[1]=a,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-a*a-n*n)),t},ot.dot=nt.dot,ot.lerp=nt.lerp,ot.slerp=function(t,e,r,a){var n,o,i,s,l,u=e[0],h=e[1],c=e[2],f=e[3],d=r[0],M=r[1],v=r[2],p=r[3];return o=u*d+h*M+c*v+f*p,o<0&&(o=-o,d=-d,M=-M,v=-v,p=-p),1-o>1e-6?(n=Math.acos(o),i=Math.sin(n),s=Math.sin((1-a)*n)/i,l=Math.sin(a*n)/i):(s=1-a,l=a),t[0]=s*u+l*d,t[1]=s*h+l*M,t[2]=s*c+l*v,t[3]=s*f+l*p,t},ot.sqlerp=function(){var t=ot.create(),e=ot.create();return function(r,a,n,o,i,s){return ot.slerp(t,a,i,s),ot.slerp(e,n,o,s),ot.slerp(r,t,e,2*s*(1-s)),r}}(),ot.invert=function(t,e){var r=e[0],a=e[1],n=e[2],o=e[3],i=r*r+a*a+n*n+o*o,s=i?1/i:0;return t[0]=-r*s,t[1]=-a*s,t[2]=-n*s,t[3]=o*s,t},ot.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},ot.length=nt.length,ot.len=ot.length,ot.squaredLength=nt.squaredLength,ot.sqrLen=ot.squaredLength,ot.normalize=nt.normalize,ot.fromMat3=function(t,e){var r,a=e[0]+e[4]+e[8];if(a>0)r=Math.sqrt(a+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var o=(n+1)%3,i=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*o+o]-e[3*i+i]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*o+i]-e[3*i+o])*r,t[o]=(e[3*o+n]+e[3*n+o])*r,t[i]=(e[3*i+n]+e[3*n+i])*r}return t},ot.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},ot.exactEquals=nt.exactEquals,ot.equals=nt.equals;var it=Y,st={};st.create=function(){var t=new it.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},st.clone=function(t){var e=new it.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},st.fromValues=function(t,e){var r=new it.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},st.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},st.set=function(t,e,r){return t[0]=e,t[1]=r,t},st.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},st.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t},st.sub=st.subtract,st.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t},st.mul=st.multiply,st.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t},st.div=st.divide,st.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},st.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},st.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},st.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},st.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},st.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},st.scaleAndAdd=function(t,e,r,a){return t[0]=e[0]+r[0]*a,t[1]=e[1]+r[1]*a,t},st.distance=function(t,e){var r=e[0]-t[0],a=e[1]-t[1];return Math.sqrt(r*r+a*a)},st.dist=st.distance,st.squaredDistance=function(t,e){var r=e[0]-t[0],a=e[1]-t[1];return r*r+a*a},st.sqrDist=st.squaredDistance,st.length=function(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)},st.len=st.length,st.squaredLength=function(t){var e=t[0],r=t[1];return e*e+r*r},st.sqrLen=st.squaredLength,st.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},st.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},st.normalize=function(t,e){var r=e[0],a=e[1],n=r*r+a*a;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},st.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},st.cross=function(t,e,r){var a=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=a,t},st.lerp=function(t,e,r,a){var n=e[0],o=e[1];return t[0]=n+a*(r[0]-n),t[1]=o+a*(r[1]-o),t},st.random=function(t,e){e=e||1;var r=2*it.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},st.transformMat2=function(t,e,r){var a=e[0],n=e[1];return t[0]=r[0]*a+r[2]*n,t[1]=r[1]*a+r[3]*n,t},st.transformMat2d=function(t,e,r){var a=e[0],n=e[1];return t[0]=r[0]*a+r[2]*n+r[4],t[1]=r[1]*a+r[3]*n+r[5],t},st.transformMat3=function(t,e,r){var a=e[0],n=e[1];return t[0]=r[0]*a+r[3]*n+r[6],t[1]=r[1]*a+r[4]*n+r[7],t},st.transformMat4=function(t,e,r){var a=e[0],n=e[1];return t[0]=r[0]*a+r[4]*n+r[12],t[1]=r[1]*a+r[5]*n+r[13],t},st.forEach=function(){var t=st.create();return function(e,r,a,n,o,i){var s,l;for(r||(r=2),a||(a=0),l=n?Math.min(n*r+a,e.length):e.length,s=a;s<l;s+=r)t[0]=e[s],t[1]=e[s+1],o(t,t,i),e[s]=t[0],e[s+1]=t[1];return e}}(),st.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},st.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},st.equals=function(t,e){var r=t[0],a=t[1],n=e[0],o=e[1];return Math.abs(r-n)<=it.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(a-o)<=it.EPSILON*Math.max(1,Math.abs(a),Math.abs(o))};var lt=X,ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ht=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},ct=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):a(t,e))},ft=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},dt=function(t){function r(){return ht(this,r),ft(this,t.apply(this,arguments))}return ct(r,t),r.prototype.hitDetect=function(){return!1},r.prototype.createCanvas=function(){if(!this.canvas){var t=this.getMap(),r=t.getSize(),a=e.Browser.retina?2:1;this.canvas=e.Canvas.createCanvas(a*r.width,a*r.height,t.CanvasClass);var n=this.context=this._createGLContext(this.canvas,this.layer.options.glOptions);n.clearColor(0,0,0,0),n.verbose=!0,n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.enable(n.BLEND),n.disable(n.DEPTH_TEST),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.onCanvasCreate&&this.onCanvasCreate()}},r.prototype.resizeCanvas=function(t){if(this.canvas){var r=void 0;r=t?t:this.getMap().getSize();var a=e.Browser.retina?2:1;this.canvas.height=a*r.height,this.canvas.width=a*r.width,this.context.viewport(0,0,this.canvas.width,this.canvas.height)}},r.prototype.clearCanvas=function(){this.canvas&&this.context.clear(this.context.COLOR_BUFFER_BIT)},r.prototype.prepareCanvas=function(){return this.canvas?this.clearCanvas():this.createCanvas(),this.layer.fire("renderstart",{context:this.context}),null},r.prototype.mergeSprites=function(t,r){if(!t||0===t.length)return null;var a=2,n=0,o=0;t.forEach(function(t){if(r){var e=Math.max(t.canvas.width,t.canvas.height);n+=e+a,e>o&&(o=e)}else n+=t.canvas.width+a,t.canvas.height>o&&(o=t.canvas.height)}),n=Math.pow(2,Math.ceil(Math.log(n)/Math.LN2)),o=Math.pow(2,Math.ceil(Math.log(o)/Math.LN2));var i=this.getMap(),s=e.Canvas.createCanvas(n,o,i.CanvasClass),l=s.getContext("2d"),u=[],h=[],c=[],f=0;t.forEach(function(t){var e=0,i=0,s=void 0;if(r){var d=t.canvas.width,M=t.canvas.height;s=Math.max(d,M),e=s>d?(s-d)/2:0,i=s>M?(s-M)/2:0,u.push([f/n,s/n,s/o,s]),c.push([d,M])}else s=t.canvas.width,u.push([f/n,t.canvas.width/n,t.canvas.height/o]);l.drawImage(t.canvas,f+e,i),h.push(t.offset),f+=s+a});var d={canvas:s,texCoords:u,offsets:h};return r&&(d.sizes=c),d},r.prototype.createBuffer=function(){var t=this.context,e=t.createBuffer();if(!e)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(e),e},r.prototype.enableVertexAttrib=function(t){var e=this.context;if(Array.isArray(t[0])){for(var r=new Float32Array([0,0,0]),a=r.BYTES_PER_ELEMENT,n=0,o=0;o<t.length;o++)n+=t[o][1]||0;for(var i=0,s=0;s<t.length;s++){var l=e.getAttribLocation(e.program,t[s][0]);if(l<0)throw new Error("Failed to get the storage location of "+t[s][0]);e.vertexAttribPointer(l,t[s][1],e[t[s][2]||"FLOAT"],!1,a*n,a*i),i+=t[s][1]||0,e.enableVertexAttribArray(l)}}else{var u=e.getAttribLocation(e.program,t[0]);e.vertexAttribPointer(u,t[1],e[t[2]||"FLOAT"],!1,0,0),e.enableVertexAttribArray(u)}},r.prototype.onRemove=function(){var t=this.context;this._buffers&&(this._buffers.forEach(function(e){t.deleteBuffer(e)}),delete this._buffers)},r.prototype.createProgram=function(t,e,r){var a=this.context,n=this._compileShader(a,a.VERTEX_SHADER,t),o=this._compileShader(a,a.FRAGMENT_SHADER,e);if(!n||!o)return null;var i=a.createProgram();if(!i)return null;a.attachShader(i,n),a.attachShader(i,o),a.linkProgram(i);var s=a.getProgramParameter(i,a.LINK_STATUS);if(!s){var l=a.getProgramInfoLog(i);throw a.deleteProgram(i),a.deleteShader(o),a.deleteShader(n),new Error("Failed to link program: "+l)}return this._initUniforms(i,r),i},r.prototype.useProgram=function(t){var e=this.context;return e.useProgram(t),e.program=t,this},r.prototype.loadTexture=function(t,e){var r=this.context,a=r.createTexture();if(!a)throw new Error("Failed to create the texture object");return e||(e=0),r.activeTexture(r["TEXTURE"+e]),r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),a},r.prototype.enableSampler=function(t,e){var r=this.context,a=this._getUniform(r.program,t);return e||(e=0),r.uniform1i(a,e),a},r.prototype.calcMatrices=function(){var t=this.getMap(),e=t.getMaxZoom(),r=t.getSize(),a=t.getScale(),n=t._prjToPoint(t._getPrjCenter(),e),o=lt.create();lt.translate(o,o,[-n.x,-n.y,0]);var i=lt.create();return lt.scale(i,i,[1/(a*r.width/2),1/(a*r.height/2),1]),lt.mul(o,i,o),o},r.prototype._createGLContext=function(t,r){for(var a=e.Util.extend({alpha:!0,antialias:!0,preserveDrawingBuffer:!0},r),n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],o=null,i=0;i<n.length;++i){try{o=t.getContext(n[i],a)}catch(t){}if(o)break}return o},r.prototype._compileShader=function(t,e,r){var a=t.createShader(e);if(null==a)throw new Error("unable to create shader");t.shaderSource(a,r),t.compileShader(a);var n=t.getShaderParameter(a,t.COMPILE_STATUS);if(!n){var o=t.getShaderInfoLog(a);throw t.deleteShader(a),new Error("Failed to compile shader: "+o)}return a},r.prototype._initUniforms=function(t,e){for(var r=0;r<e.length;r++)t[e[r]]=this._getUniform(t,e[r])},r.prototype._getUniform=function(t,e){var r=this.context,a=r.getUniformLocation(t,e);if(!a)throw new Error("Failed to get the storage location of "+a);return a},r}(e.renderer.CanvasRenderer),Mt=function(t){function e(r,a,n){ht(this,e);var o=ft(this,t.call(this,n));return o.gl=r,o.map=a,o}return ct(e,t),e}(e.Class),vt=function(){function t(e,r){ht(this,t),this.resources=e,this.options=r||{},this.atlas={}}return t.prototype.getAtlas=function(t,e){var r=JSON.stringify(t)+"_"+e;if(!this.atlas[r]){var a=this.addAtlas(t,e);a&&(this.atlas[r]=a)}return this.atlas[r]},t.prototype.addAtlas=function(t,r){if(!t.lineDasharray&&!t.linePatternFile)return null;var a=this._getSize(t,r,this.resources),n=this._createCanvas(a);if(!n)throw new Error("can not initialize canvas container.");var o=n.getContext("2d");return e.Canvas.prepareCanvas(o,t,this.resources),o.moveTo(0,a[1]/2),o.lineTo(a[0],a[1]/2),o.stroke(),{canvas:n,offset:new e.Point(0,0)}},t.prototype._getSize=function(t,e,r){var a=0,n=0,o=t.lineDasharray;if(o){for(var i=0;i<o.length;i++)a+=o[i];o.length%2===1&&(a*=2),n=null==t.lineWidth?2:t.lineWidth}if(t.linePatternFile){var s=r.getImage(t.linePatternFile);s.width>a&&(a=s.width),s.height>n&&(n=s.height)}return[a,n]},t.prototype._createCanvas=function(t){if(this.options.canvasClass)return new this.options.canvasClass(t[0],t[1]);if("undefined"!=typeof document){var e=document.createElement("canvas");return e.width=t[0],e.height=t[1],e}return null},t}(),pt=r(function(t){var e=function(){function t(e,r,a,n){function i(e,a){if(null===e)return null;if(0==a)return e;var s,c;if("object"!=("undefined"==typeof e?"undefined":ut(e)))return e;if(t.__isArray(e))s=[];else if(t.__isRegExp(e))s=new RegExp(e.source,o(e)),e.lastIndex&&(s.lastIndex=e.lastIndex);else if(t.__isDate(e))s=new Date(e.getTime());else{if(h&&Buffer.isBuffer(e))return s=new Buffer(e.length),e.copy(s),s;"undefined"==typeof n?(c=Object.getPrototypeOf(e),s=Object.create(c)):(s=Object.create(n),c=n)}if(r){var f=l.indexOf(e);if(f!=-1)return u[f];l.push(e),u.push(s)}for(var d in e){var M;c&&(M=Object.getOwnPropertyDescriptor(c,d)),M&&null==M.set||(s[d]=i(e[d],a-1))}return s}var s;"object"===("undefined"==typeof r?"undefined":ut(r))&&(a=r.depth,n=r.prototype,s=r.filter,r=r.circular);var l=[],u=[],h="undefined"!=typeof Buffer;return"undefined"==typeof r&&(r=!0),"undefined"==typeof a&&(a=1/0),i(e,a)}function e(t){return Object.prototype.toString.call(t)}function r(t){return"object"===("undefined"==typeof t?"undefined":ut(t))&&"[object Date]"===e(t)}function a(t){return"object"===("undefined"==typeof t?"undefined":ut(t))&&"[object Array]"===e(t)}function n(t){return"object"===("undefined"==typeof t?"undefined":ut(t))&&"[object RegExp]"===e(t)}function o(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return t.clonePrototype=function(t){if(null===t)return null;var e=function(){};return e.prototype=t,new e},t.__objToStr=e,t.__isDate=r,t.__isArray=a,t.__isRegExp=n,t.__getRegExpFlags=o,t}();t.exports&&(t.exports=e)}),xt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],
peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},mt=r(function(t){function e(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2)}var r=xt,a={};for(var n in r)r.hasOwnProperty(n)&&(a[r[n]]=n);var o=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var i in o)if(o.hasOwnProperty(i)){if(!("channels"in o[i]))throw new Error("missing channels property: "+i);if(!("labels"in o[i]))throw new Error("missing channel labels property: "+i);if(o[i].labels.length!==o[i].channels)throw new Error("channel and label counts mismatch: "+i);var s=o[i].channels,l=o[i].labels;delete o[i].channels,delete o[i].labels,Object.defineProperty(o[i],"channels",{value:s}),Object.defineProperty(o[i],"labels",{value:l})}o.rgb.hsl=function(t){var e,r,a,n=t[0]/255,o=t[1]/255,i=t[2]/255,s=Math.min(n,o,i),l=Math.max(n,o,i),u=l-s;return l===s?e=0:n===l?e=(o-i)/u:o===l?e=2+(i-n)/u:i===l&&(e=4+(n-o)/u),e=Math.min(60*e,360),e<0&&(e+=360),a=(s+l)/2,r=l===s?0:a<=.5?u/(l+s):u/(2-l-s),[e,100*r,100*a]},o.rgb.hsv=function(t){var e,r,a,n=t[0],o=t[1],i=t[2],s=Math.min(n,o,i),l=Math.max(n,o,i),u=l-s;return r=0===l?0:u/l*1e3/10,l===s?e=0:n===l?e=(o-i)/u:o===l?e=2+(i-n)/u:i===l&&(e=4+(n-o)/u),e=Math.min(60*e,360),e<0&&(e+=360),a=l/255*1e3/10,[e,r,a]},o.rgb.hwb=function(t){var e=t[0],r=t[1],a=t[2],n=o.rgb.hsl(t)[0],i=1/255*Math.min(e,Math.min(r,a));return a=1-1/255*Math.max(e,Math.max(r,a)),[n,100*i,100*a]},o.rgb.cmyk=function(t){var e,r,a,n,o=t[0]/255,i=t[1]/255,s=t[2]/255;return n=Math.min(1-o,1-i,1-s),e=(1-o-n)/(1-n)||0,r=(1-i-n)/(1-n)||0,a=(1-s-n)/(1-n)||0,[100*e,100*r,100*a,100*n]},o.rgb.keyword=function(t){var n=a[t];if(n)return n;var o,i=1/0;for(var s in r)if(r.hasOwnProperty(s)){var l=r[s],u=e(t,l);u<i&&(i=u,o=s)}return o},o.keyword.rgb=function(t){return r[t]},o.rgb.xyz=function(t){var e=t[0]/255,r=t[1]/255,a=t[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92;var n=.4124*e+.3576*r+.1805*a,o=.2126*e+.7152*r+.0722*a,i=.0193*e+.1192*r+.9505*a;return[100*n,100*o,100*i]},o.rgb.lab=function(t){var e,r,a,n=o.rgb.xyz(t),i=n[0],s=n[1],l=n[2];return i/=95.047,s/=100,l/=108.883,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,l=l>.008856?Math.pow(l,1/3):7.787*l+16/116,e=116*s-16,r=500*(i-s),a=200*(s-l),[e,r,a]},o.hsl.rgb=function(t){var e,r,a,n,o,i=t[0]/360,s=t[1]/100,l=t[2]/100;if(0===s)return o=255*l,[o,o,o];r=l<.5?l*(1+s):l+s-l*s,e=2*l-r,n=[0,0,0];for(var u=0;u<3;u++)a=i+1/3*-(u-1),a<0&&a++,a>1&&a--,o=6*a<1?e+6*(r-e)*a:2*a<1?r:3*a<2?e+(r-e)*(2/3-a)*6:e,n[u]=255*o;return n},o.hsl.hsv=function(t){var e,r,a=t[0],n=t[1]/100,o=t[2]/100,i=n,s=Math.max(o,.01);return o*=2,n*=o<=1?o:2-o,i*=s<=1?s:2-s,r=(o+n)/2,e=0===o?2*i/(s+i):2*n/(o+n),[a,100*e,100*r]},o.hsv.rgb=function(t){var e=t[0]/60,r=t[1]/100,a=t[2]/100,n=Math.floor(e)%6,o=e-Math.floor(e),i=255*a*(1-r),s=255*a*(1-r*o),l=255*a*(1-r*(1-o));switch(a*=255,n){case 0:return[a,l,i];case 1:return[s,a,i];case 2:return[i,a,l];case 3:return[i,s,a];case 4:return[l,i,a];case 5:return[a,i,s]}},o.hsv.hsl=function(t){var e,r,a,n=t[0],o=t[1]/100,i=t[2]/100,s=Math.max(i,.01);return a=(2-o)*i,e=(2-o)*s,r=o*s,r/=e<=1?e:2-e,r=r||0,a/=2,[n,100*r,100*a]},o.hwb.rgb=function(t){var e,r,a,n,o=t[0]/360,i=t[1]/100,s=t[2]/100,l=i+s;l>1&&(i/=l,s/=l),e=Math.floor(6*o),r=1-s,a=6*o-e,0!==(1&e)&&(a=1-a),n=i+a*(r-i);var u,h,c;switch(e){default:case 6:case 0:u=r,h=n,c=i;break;case 1:u=n,h=r,c=i;break;case 2:u=i,h=r,c=n;break;case 3:u=i,h=n,c=r;break;case 4:u=n,h=i,c=r;break;case 5:u=r,h=i,c=n}return[255*u,255*h,255*c]},o.cmyk.rgb=function(t){var e,r,a,n=t[0]/100,o=t[1]/100,i=t[2]/100,s=t[3]/100;return e=1-Math.min(1,n*(1-s)+s),r=1-Math.min(1,o*(1-s)+s),a=1-Math.min(1,i*(1-s)+s),[255*e,255*r,255*a]},o.xyz.rgb=function(t){var e,r,a,n=t[0]/100,o=t[1]/100,i=t[2]/100;return e=3.2406*n+o*-1.5372+i*-.4986,r=n*-.9689+1.8758*o+.0415*i,a=.0557*n+o*-.204+1.057*i,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:12.92*a,e=Math.min(Math.max(0,e),1),r=Math.min(Math.max(0,r),1),a=Math.min(Math.max(0,a),1),[255*e,255*r,255*a]},o.xyz.lab=function(t){var e,r,a,n=t[0],o=t[1],i=t[2];return n/=95.047,o/=100,i/=108.883,n=n>.008856?Math.pow(n,1/3):7.787*n+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,e=116*o-16,r=500*(n-o),a=200*(o-i),[e,r,a]},o.lab.xyz=function(t){var e,r,a,n=t[0],o=t[1],i=t[2];r=(n+16)/116,e=o/500+r,a=r-i/200;var s=Math.pow(r,3),l=Math.pow(e,3),u=Math.pow(a,3);return r=s>.008856?s:(r-16/116)/7.787,e=l>.008856?l:(e-16/116)/7.787,a=u>.008856?u:(a-16/116)/7.787,e*=95.047,r*=100,a*=108.883,[e,r,a]},o.lab.lch=function(t){var e,r,a,n=t[0],o=t[1],i=t[2];return e=Math.atan2(i,o),r=360*e/2/Math.PI,r<0&&(r+=360),a=Math.sqrt(o*o+i*i),[n,a,r]},o.lch.lab=function(t){var e,r,a,n=t[0],o=t[1],i=t[2];return a=i/360*2*Math.PI,e=o*Math.cos(a),r=o*Math.sin(a),[n,e,r]},o.rgb.ansi16=function(t){var e=t[0],r=t[1],a=t[2],n=1 in arguments?arguments[1]:o.rgb.hsv(t)[2];if(n=Math.round(n/50),0===n)return 30;var i=30+(Math.round(a/255)<<2|Math.round(r/255)<<1|Math.round(e/255));return 2===n&&(i+=60),i},o.hsv.ansi16=function(t){return o.rgb.ansi16(o.hsv.rgb(t),t[2])},o.rgb.ansi256=function(t){var e=t[0],r=t[1],a=t[2];if(e===r&&r===a)return e<8?16:e>248?231:Math.round((e-8)/247*24)+232;var n=16+36*Math.round(e/255*5)+6*Math.round(r/255*5)+Math.round(a/255*5);return n},o.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),e=e/10.5*255,[e,e,e];var r=.5*(~~(t>50)+1),a=(1&e)*r*255,n=(e>>1&1)*r*255,o=(e>>2&1)*r*255;return[a,n,o]},o.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}t-=16;var r,a=Math.floor(t/36)/5*255,n=Math.floor((r=t%36)/6)/5*255,o=r%6/5*255;return[a,n,o]},o.rgb.hex=function(t){var e=((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2])),r=e.toString(16).toUpperCase();return"000000".substring(r.length)+r},o.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}/i);if(!e)return[0,0,0];var r=parseInt(e[0],16),a=r>>16&255,n=r>>8&255,o=255&r;return[a,n,o]},o.rgb.hcg=function(t){var e,r,a=t[0]/255,n=t[1]/255,o=t[2]/255,i=Math.max(Math.max(a,n),o),s=Math.min(Math.min(a,n),o),l=i-s;return e=l<1?s/(1-l):0,r=l<=0?0:i===a?(n-o)/l%6:i===n?2+(o-a)/l:4+(a-n)/l+4,r/=6,r%=1,[360*r,100*l,100*e]},o.hsl.hcg=function(t){var e=t[1]/100,r=t[2]/100,a=1,n=0;return a=r<.5?2*e*r:2*e*(1-r),a<1&&(n=(r-.5*a)/(1-a)),[t[0],100*a,100*n]},o.hsv.hcg=function(t){var e=t[1]/100,r=t[2]/100,a=e*r,n=0;return a<1&&(n=(r-a)/(1-a)),[t[0],100*a,100*n]},o.hcg.rgb=function(t){var e=t[0]/360,r=t[1]/100,a=t[2]/100;if(0===r)return[255*a,255*a,255*a];var n=[0,0,0],o=e%1*6,i=o%1,s=1-i,l=0;switch(Math.floor(o)){case 0:n[0]=1,n[1]=i,n[2]=0;break;case 1:n[0]=s,n[1]=1,n[2]=0;break;case 2:n[0]=0,n[1]=1,n[2]=i;break;case 3:n[0]=0,n[1]=s,n[2]=1;break;case 4:n[0]=i,n[1]=0,n[2]=1;break;default:n[0]=1,n[1]=0,n[2]=s}return l=(1-r)*a,[255*(r*n[0]+l),255*(r*n[1]+l),255*(r*n[2]+l)]},o.hcg.hsv=function(t){var e=t[1]/100,r=t[2]/100,a=e+r*(1-e),n=0;return a>0&&(n=e/a),[t[0],100*n,100*a]},o.hcg.hsl=function(t){var e=t[1]/100,r=t[2]/100,a=r*(1-e)+.5*e,n=0;return a>0&&a<.5?n=e/(2*a):a>=.5&&a<1&&(n=e/(2*(1-a))),[t[0],100*n,100*a]},o.hcg.hwb=function(t){var e=t[1]/100,r=t[2]/100,a=e+r*(1-e);return[t[0],100*(a-e),100*(1-a)]},o.hwb.hcg=function(t){var e=t[1]/100,r=t[2]/100,a=1-r,n=a-e,o=0;return n<1&&(o=(a-n)/(1-n)),[t[0],100*n,100*o]},o.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},o.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},o.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},o.gray.hsl=o.gray.hsv=function(t){return[0,0,t[0]]},o.gray.hwb=function(t){return[0,100,t[0]]},o.gray.cmyk=function(t){return[0,0,0,t[0]]},o.gray.lab=function(t){return[t[0],0,0]},o.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),r=(e<<16)+(e<<8)+e,a=r.toString(16).toUpperCase();return"000000".substring(a.length)+a},o.rgb.gray=function(t){var e=(t[0]+t[1]+t[2])/3;return[e/255*100]}}),St=mt,gt=Object.keys(St),yt=function(t){for(var e=o(t),r={},a=Object.keys(e),n=a.length,i=0;i<n;i++){var l=a[i],u=e[l];null!==u.parent&&(r[l]=s(l,e))}return r},bt=mt,_t=yt,It={},Dt=Object.keys(bt);Dt.forEach(function(t){It[t]={},Object.defineProperty(It[t],"channels",{value:bt[t].channels}),Object.defineProperty(It[t],"labels",{value:bt[t].labels});var e=_t(t),r=Object.keys(e);r.forEach(function(r){var a=e[r];It[t][r]=u(a),It[t][r].raw=l(a)})});var Ft=It,wt=xt,At={getRgba:h,getHsla:c,getRgb:d,getHsl:M,getHwb:f,getAlpha:v,hexString:p,rgbString:x,rgbaString:m,percentString:S,percentaString:g,hslString:y,hslaString:b,hwbString:_,keyword:I},Et={};for(var zt in wt)Et[wt[zt]]=zt;var Ct=pt,Pt=Ft,Rt=At,Lt=function t(e){if(e instanceof t)return e;if(!(this instanceof t))return new t(e);this.values={rgb:[0,0,0],hsl:[0,0,0],hsv:[0,0,0],hwb:[0,0,0],cmyk:[0,0,0,0],alpha:1};var r;if("string"==typeof e)if(r=Rt.getRgba(e))this.setValues("rgb",r);else if(r=Rt.getHsla(e))this.setValues("hsl",r);else{if(!(r=Rt.getHwb(e)))throw new Error('Unable to parse color from string "'+e+'"');this.setValues("hwb",r)}else if("object"===("undefined"==typeof e?"undefined":ut(e)))if(r=e,void 0!==r.r||void 0!==r.red)this.setValues("rgb",r);else if(void 0!==r.l||void 0!==r.lightness)this.setValues("hsl",r);else if(void 0!==r.v||void 0!==r.value)this.setValues("hsv",r);else if(void 0!==r.w||void 0!==r.whiteness)this.setValues("hwb",r);else{if(void 0===r.c&&void 0===r.cyan)throw new Error("Unable to parse color from object "+JSON.stringify(e));this.setValues("cmyk",r)}};Lt.prototype={rgb:function(){return this.setSpace("rgb",arguments)},hsl:function(){return this.setSpace("hsl",arguments)},hsv:function(){return this.setSpace("hsv",arguments)},hwb:function(){return this.setSpace("hwb",arguments)},cmyk:function(){return this.setSpace("cmyk",arguments)},rgbArray:function(){return this.values.rgb},hslArray:function(){return this.values.hsl},hsvArray:function(){return this.values.hsv},hwbArray:function(){return 1!==this.values.alpha?this.values.hwb.concat([this.values.alpha]):this.values.hwb},cmykArray:function(){return this.values.cmyk},rgbaArray:function(){var t=this.values.rgb;return t.concat([this.values.alpha])},rgbaArrayNormalized:function(){for(var t=this.values.rgb,e=[],r=0;r<3;r++)e[r]=t[r]/255;return e.push(this.values.alpha),e},hslaArray:function(){var t=this.values.hsl;return t.concat([this.values.alpha])},alpha:function(t){return void 0===t?this.values.alpha:(this.setValues("alpha",t),this)},red:function(t){return this.setChannel("rgb",0,t)},green:function(t){return this.setChannel("rgb",1,t)},blue:function(t){return this.setChannel("rgb",2,t)},hue:function(t){return t&&(t%=360,t=t<0?360+t:t),this.setChannel("hsl",0,t)},saturation:function(t){return this.setChannel("hsl",1,t)},lightness:function(t){return this.setChannel("hsl",2,t)},saturationv:function(t){return this.setChannel("hsv",1,t)},whiteness:function(t){return this.setChannel("hwb",1,t)},blackness:function(t){return this.setChannel("hwb",2,t)},value:function(t){return this.setChannel("hsv",2,t)},cyan:function(t){return this.setChannel("cmyk",0,t)},magenta:function(t){return this.setChannel("cmyk",1,t)},yellow:function(t){return this.setChannel("cmyk",2,t)},black:function(t){return this.setChannel("cmyk",3,t)},hexString:function(){return Rt.hexString(this.values.rgb)},rgbString:function(){return Rt.rgbString(this.values.rgb,this.values.alpha)},rgbaString:function(){return Rt.rgbaString(this.values.rgb,this.values.alpha)},percentString:function(){return Rt.percentString(this.values.rgb,this.values.alpha)},hslString:function(){return Rt.hslString(this.values.hsl,this.values.alpha)},hslaString:function(){return Rt.hslaString(this.values.hsl,this.values.alpha)},hwbString:function(){return Rt.hwbString(this.values.hwb,this.values.alpha)},keyword:function(){return Rt.keyword(this.values.rgb,this.values.alpha)},rgbNumber:function(){return this.values.rgb[0]<<16|this.values.rgb[1]<<8|this.values.rgb[2]},luminosity:function(){for(var t=this.values.rgb,e=[],r=0;r<t.length;r++){var a=t[r]/255;e[r]=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),r=t.luminosity();return e>r?(e+.05)/(r+.05):(r+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},dark:function(){var t=this.values.rgb,e=(299*t[0]+587*t[1]+114*t[2])/1e3;return e<128},light:function(){return!this.dark()},negate:function(){for(var t=[],e=0;e<3;e++)t[e]=255-this.values.rgb[e];return this.setValues("rgb",t),this},lighten:function(t){return this.values.hsl[2]+=this.values.hsl[2]*t,this.setValues("hsl",this.values.hsl),this},darken:function(t){return this.values.hsl[2]-=this.values.hsl[2]*t,this.setValues("hsl",this.values.hsl),this},saturate:function(t){return this.values.hsl[1]+=this.values.hsl[1]*t,this.setValues("hsl",this.values.hsl),this},desaturate:function(t){return this.values.hsl[1]-=this.values.hsl[1]*t,this.setValues("hsl",this.values.hsl),this},whiten:function(t){return this.values.hwb[1]+=this.values.hwb[1]*t,this.setValues("hwb",this.values.hwb),this},blacken:function(t){return this.values.hwb[2]+=this.values.hwb[2]*t,this.setValues("hwb",this.values.hwb),this},greyscale:function(){var t=this.values.rgb,e=.3*t[0]+.59*t[1]+.11*t[2];return this.setValues("rgb",[e,e,e]),this},clearer:function(t){return this.setValues("alpha",this.values.alpha-this.values.alpha*t),this},opaquer:function(t){return this.setValues("alpha",this.values.alpha+this.values.alpha*t),this},rotate:function(t){var e=this.values.hsl[0];return e=(e+t)%360,e=e<0?360+e:e,this.values.hsl[0]=e,this.setValues("hsl",this.values.hsl),this},mix:function(t,e){var r=this,a=t,n=void 0===e?.5:e,o=2*n-1,i=r.alpha()-a.alpha(),s=((o*i===-1?o:(o+i)/(1+o*i))+1)/2,l=1-s;return this.rgb(s*r.red()+l*a.red(),s*r.green()+l*a.green(),s*r.blue()+l*a.blue()).alpha(r.alpha()*n+a.alpha()*(1-n))},toJSON:function(){return this.rgb()},clone:function(){var t=new Lt;return t.values=Ct(this.values),t}},Lt.prototype.getValues=function(t){for(var e={},r=0;r<t.length;r++)e[t.charAt(r)]=this.values[t][r];return 1!==this.values.alpha&&(e.a=this.values.alpha),e},Lt.prototype.setValues=function(t,e){var r,a={rgb:["red","green","blue"],hsl:["hue","saturation","lightness"],hsv:["hue","saturation","value"],hwb:["hue","whiteness","blackness"],cmyk:["cyan","magenta","yellow","black"]},n={rgb:[255,255,255],hsl:[360,100,100],hsv:[360,100,100],hwb:[360,100,100],cmyk:[100,100,100,100]},o=1;if("alpha"===t)o=e;else if(e.length)this.values[t]=e.slice(0,t.length),o=e[t.length];else if(void 0!==e[t.charAt(0)]){for(r=0;r<t.length;r++)this.values[t][r]=e[t.charAt(r)];o=e.a}else if(void 0!==e[a[t][0]]){var i=a[t];for(r=0;r<t.length;r++)this.values[t][r]=e[i[r]];o=e.alpha}if(this.values.alpha=Math.max(0,Math.min(1,void 0===o?this.values.alpha:o)),"alpha"===t)return!1;var s;for(r=0;r<t.length;r++)s=Math.max(0,Math.min(n[t][r],this.values[t][r])),this.values[t][r]=Math.round(s);for(var l in a)for(l!==t&&(this.values[l]=Pt[t][l](this.values[t])),r=0;r<l.length;r++)s=Math.max(0,Math.min(n[l][r],this.values[l][r])),this.values[l][r]=Math.round(s);return!0},Lt.prototype.setSpace=function(t,e){var r=e[0];return void 0===r?this.getValues(t):("number"==typeof r&&(r=Array.prototype.slice.call(e)),this.setValues(t,r),this)},Lt.prototype.setChannel=function(t,e,r){return void 0===r?this.values[t][e]:r===this.values[t][e]?this:(this.values[t][e]=r,this.setValues(t,this.values[t]),this)};var kt=Lt,Ot=w;w.prototype={clone:function(){return new w(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),a=e*this.x-r*this.y,n=r*this.x+e*this.y;return this.x=a,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),a=Math.sin(t),n=e.x+r*(this.x-e.x)-a*(this.y-e.y),o=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},w.convert=function(t){return t instanceof w?t:Array.isArray(t)?new w(t[0],t[1]):t};var Tt={lineJoin:"miter",lineCap:"butt",project:!0},Nt=function(t){function r(e,a,n){ht(this,r);var o=ft(this,t.call(this,e,a,n));return o.vertexArray=[],o.normalArray=[],o.elementArray=[],o.styleArray=[],o.distance=0,o._colorMap={},o}return ct(r,t),r.prototype.getArrays=function(){return{vertexArray:this.vertexArray,normalArray:this.normalArray,elementArray:this.elementArray,styleArray:this.styleArray}},r.prototype.addLine=function(t,r){if(r.symbol.lineWidth<=0||r.symbol.lineOpacity<=0)return this;var a=this.elementArray.length,n=this._getVertice(t);if(n[0]&&Array.isArray(n[0][0])){for(var o=0,i=n.length;o<i;o++)this.addLine(n[o],r);return this}this._prepareToAdd();for(var s=this.map.getMaxZoom(),l=void 0,u=void 0,h=0,c=n.length;h<c;h++){var f=n[h];this.options.project&&(f=this.map.coordinateToPoint(new e.Coordinate(f),s).toArray()),l=Ot.convert(f),h<c-1?(f=n[h+1],this.options.project&&(f=this.map.coordinateToPoint(new e.Coordinate(f),s).toArray()),u=Ot.convert(f)):u=null,this.addCurrentVertex(l,u)}var d=this.elementArray.length-a;return this._addTexCoords(4*d,r),this},r.prototype.addCurrentVertex=function(t,e){if(!this.preVertex)return this._waitForLeftCap=!0,void(this.preVertex=t);this.e1=this.e2=this.e3=-1;var r=t.sub(this.preVertex)._unit()._perp()._mult(-1),a=void 0;e&&(a=e.sub(t)._unit()._perp()._mult(-1)),this._addLineEndVertexs(this.preVertex,this._getStartNormal(r,this.preNormal),r,this.distance),this._waitForLeftCap&&delete this._waitForLeftCap,this.distance+=t.dist(this.preVertex);var n=this._getEndNormal(r,a);this._addLineEndVertexs(t,n,r,this.distance),e&&this._addJoin(t,n,a),this.preNormal=r,this.preVertex=t},r.prototype._prepareToAdd=function(){this.distance=0,delete this.preVertex,delete this.preNormal},r.prototype._addLineEndVertexs=function(t,e,r,a){var n=e.normal[0];this.e3=this._addVertex(t,n,0,r,a),this.e1>=0&&this.e2>=0&&this.elementArray.push(this.e1,this.e2,this.e3),this.e1=this.e2,this.e2=this.e3,n=e.normal[1],this.e3=this._addVertex(t,n,e.corner,r,a),this.e1>=0&&this.e2>=0&&this.elementArray.push(this.e1,this.e2,this.e3),this.e1=this.e2,this.e2=this.e3},r.prototype._addVertex=function(t,e,r,a,n){this.vertexArray.push(t.x,t.y);var o=[this._precise(r),this._precise(a.x),this._precise(a.y),this._precise(e.x),this._precise(e.y),n],i=this.normalArray.length/o.length;return Array.prototype.push.apply(this.normalArray,o),i},r.prototype._addLineCap=function(){},r.prototype._getVertice=function(t){return t.geometry?t=t.geometry.coordinates:t.coordinates&&(t=t.coordinates),t},r.prototype._addTexCoords=function(t,e){var r=e.symbol.lineColor||"#000000";this._colorMap[r]||(this._colorMap[r]=kt(r).rgbaArrayNormalized()),r=this._colorMap[r];for(var a=0;a<t;a++)e.texCoord?(Array.prototype.push.apply(this.styleArray,e.texCoord),this.styleArray.push(-1)):Array.prototype.push.apply(this.styleArray,r),this.styleArray.push(e.symbol.lineOpacity||1,(e.symbol.lineWidth||2)/2)},r.prototype._getStartNormal=function(t,e){return this._getJoinNormal(t,e,t)},r.prototype._getEndNormal=function(t,e){return this._getJoinNormal(t,t,e)},r.prototype._getJoinNormal=function(t,e,r){if(!e||!r)return{normal:[t,t.mult(-1)],corner:0,miterLength:0};var a=e.add(r)._unit(),n=a.x*r.x+a.y*r.y,o=1/n,i=void 0,s=void 0;return console.log(180*r.angleWith(e.mult(-1))/Math.PI),r.angleWith(e.mult(-1))>0?(i=[t,a._mult(o).mult(-1)],s=!1):(i=[a._mult(o),t.mult(-1)],s=!0),{normal:i,upSharp:s,corner:-o*Math.sqrt(1-n*n),miterLength:o}},r.prototype._precise=function(t){return Math.round(1e7*t)/1e7},r.prototype._addJoin=function(t,e,r){var a=new Ot(0,0),n=void 0,o=void 0,i=void 0;n=this._addVertex(t,e.normal[0],0,a,!1,this.distance),o=this._addVertex(t,e.normal[1],0,a,!1,this.distance),i=e.upSharp?this._addVertex(t,r.mult(-1),0,a,!1,this.distance):this._addVertex(t,r,0,a,!1,this.distance),this.elementArray.push(n,o,i);var s=this.options.lineJoin;"miter"===s&&(e.upSharp?(n=this._addVertex(t,e.normal[1],0,a,!1,this.distance),o=this._addVertex(t,e.normal[0].mult(-1),0,a,!1,this.distance),i=this._addVertex(t,r.mult(-1),0,a,!1,this.distance)):(n=this._addVertex(t,e.normal[1].mult(-1),0,a,!1,this.distance),o=this._addVertex(t,e.normal[0],0,a,!1,this.distance),i=this._addVertex(t,r,0,a,!1,this.distance)),this.elementArray.push(n,o,i))},r}(Mt);Nt.mergeOptions(Tt);var qt="#ifdef GL_ES\nprecision mediump float;\n#else\n#define lowp\n#define mediump\n#define highp\n#endif\n\nuniform float u_blur;\nuniform vec2 u_spritesize;\n\n// varying lowp vec4 v_color;\nvarying vec2 v_linenormal;\nvarying vec4 v_texcoord;\nvarying float v_opacity;\nvarying float v_linewidth;\nvarying float v_scale;\nvarying float v_texture_normal;\nvarying float v_linesofar;\nvarying float v_ruler;\n\nuniform sampler2D u_image;\n\nvoid main() {\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_linenormal.xy) * v_linewidth;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_linewidth.t) or when fading out\n    // (v_linewidth.s)\n    float blur = u_blur;\n    float alpha = clamp((v_linewidth - dist) / blur, 0.0, 1.0);\n    alpha = 1.0;\n    vec4 color;\n    if (v_texcoord.q == -1.0) {\n        // is a texture fragment\n        float linesofar = v_linesofar / v_scale;\n        float texWidth = u_spritesize.x * v_texcoord.t;\n        float x = v_texcoord.s + mod(linesofar, texWidth) / texWidth * v_texcoord.t;\n        float y = (v_texture_normal + 1.0) / 2.0 * v_texcoord.p;\n\n        color = texture2D(u_image, vec2(x, y));\n        if (abs(v_ruler) > 1.0) {\n            color = vec4(1.0);\n        }\n    } else {\n        // a color fragment\n        color = v_texcoord;\n    }\n    gl_FragColor = color * (alpha * v_opacity);\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}",Vt="#ifdef GL_ES\nprecision highp float;\n#else\n#define lowp\n#define mediump\n#define highp\n#endif\n\nattribute vec4 a_pos;\nattribute float a_corner;\nattribute vec2 a_normal;\nattribute float a_linesofar;\nattribute vec2 a_linenormal;\nattribute vec4 a_texcoord;\nattribute float a_opacity;\nattribute float a_linewidth;\nattribute float a_seglen;\n\nuniform mat4 u_matrix;\nuniform float u_scale;\n\nvarying vec2 v_linenormal;\nvarying float v_linewidth;\nvarying float v_opacity;\nvarying vec4 v_texcoord;\nvarying float v_scale;\nvarying float v_texture_normal;\n\nvarying float v_linesofar;\nvarying float v_ruler;\n\nvoid main() {\n    v_opacity = a_opacity;\n    v_linewidth = a_linewidth;\n    v_texcoord = a_texcoord;\n    v_scale = u_scale;\n\n    v_linenormal = a_linenormal;\n\n    vec4 pos = a_pos;\n    pos.x += a_normal.x * v_linewidth * u_scale;\n    pos.y += a_normal.y * v_linewidth * u_scale;\n\n    float corner = a_corner * v_linewidth * u_scale;\n    float direction = mod(a_seglen, 2.0) - 0.5;\n    v_ruler = corner / (a_seglen / 2.0) + sign(direction);\n\n    // add linesofar with corner length caused by line-join\n    v_linesofar = a_linesofar + corner;\n\n\n    gl_Position = u_matrix * pos;\n    if (a_normal.y == 0.0) {\n        // with an upside down straight line, a_normal.y is always 0, use a_normal.x instead\n        v_texture_normal = -sign(a_normal.x);\n    } else {\n        //\n        v_texture_normal = sign(a_normal.y);\n    }\n\n}",Bt="\nprecision mediump float;\nuniform sampler2D u_sampler;\nvarying vec3 v_texCoord;\nvoid main() {\n    gl_FragColor = texture2D(u_sampler, vec2(v_texCoord[0] + gl_PointCoord[0] * v_texCoord[1], 1.0 + gl_PointCoord[1] * v_texCoord[2]));\n}",Yt="\nattribute vec4 a_pos;\nattribute float a_size;\nattribute vec3 a_texCoord;\nattribute vec4 a_texOffset;\nuniform mat4 u_matrix;\nuniform float u_scale;\nvarying vec3 v_texCoord;\nvoid main() {\n  vec4 pos = vec4(a_pos.x + a_texOffset.x * u_scale, a_pos.y + a_texOffset.y * u_scale, a_pos.z, a_pos.w);\n  gl_Position = u_matrix * pos;\n  gl_PointSize = a_size;\n  v_texCoord = a_texCoord;\n}",Ut={line:{fragmentSource:qt,vertexSource:Vt},point:{fragmentSource:Bt,vertexSource:Yt}},jt=Object.freeze({WebglRenderer:dt,Shader:Ut,Painter:Mt,LineAtlas:vt,LinePainter:Nt}),Wt={renderer:"webgl"},Gt=function(t){function r(a,n,o){ht(this,r);var i=e.Util.extend({},o),s=void 0;i.style&&(s=i.style,delete i.style);var l=ft(this,t.call(this,a,i));return l.data=n,s&&l.setStyle(s),l}return ct(r,t),r.fromJSON=function(t){if(!t||t.type!==this.getJSONType())return null;var e=this.prototype.constructor,r=new e(t.id,t.data,t.options);return t.style&&r.setStyle(t.style),r},r.prototype.toJSON=function(){var t={type:this.getJSONType(),data:this.data,id:this.getId()},e=this.config(),r=this.getStyle();return e&&(t.options=e),r&&(t.style=r),t},r.prototype.setStyle=function(t){return Array.isArray(t)||(t=[t]),this._style=t,this._cookedStyles=e.MapboxUtil.compileStyle(t),this.fire("setstyle",{style:t}),this},r.prototype.getStyle=function(){return this._style},r}(e.Layer);Gt.mergeOptions(Wt);var Jt=A,Xt=P,Zt=R,Ht=Jt,Kt=Xt,Qt=Zt,$t=k;O.prototype={range:function(t,e,r,a){return Kt(this.ids,this.coords,t,e,r,a,this.nodeSize)},within:function(t,e,r){return Qt(this.ids,this.coords,t,e,r,this.nodeSize)}};var te=function(t){function e(){return ht(this,e),ft(this,t.apply(this,arguments))}return ct(e,t),e.prototype.identify=function(t,e){var r=this._getRenderer();return r?r.identify(t,e):null},e}(Gt);te.registerJSONType("BigPointLayer"),te.registerRenderer("webgl",function(t){function r(e){ht(this,r);var a=ft(this,t.call(this,e));return a._needCheckStyle=!0,a._needCheckSprites=!0,a._registerEvents(),a}return ct(r,t),r.prototype.checkResources=function(){if(!this._needCheckStyle)return null;var t=[];return this.layer.getStyle()&&this.layer.getStyle().forEach(function(r){var a=e.Util.getExternalResources(r.symbol,!0);a&&t.push(a)}),this._needCheckStyle=!1,this._needCheckSprites=!0,0===t.length?null:t},r.prototype.onCanvasCreate=function(){var t=this.context,e=["u_matrix","u_scale"],r=this.createProgram(Ut.point.vertexSource,Ut.point.fragmentSource,e);this.useProgram(r);var a=this.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),this.enableVertexAttrib([["a_pos",2],["a_texCoord",3],["a_size",1],["a_texOffset",2]])},r.prototype.draw=function(){if(console.time("draw points"),this.prepareCanvas(),this._checkSprites(),!this._vertexCount){var t=this.getMap(),r=t.getMaxZoom(),a=this.layer.data,n=[],o=[];this._vertexCount=0;for(var i=this.context,s=[0,0],l=0,u=a.length;l<u;l++){var h=this._getTexCoord({properties:a[l][2]});if(h){this._vertexCount++;var c=t.coordinateToPoint(new e.Coordinate(a[l]),r);n.push(c.x,c.y,h.texCoord[0],h.texCoord[1],h.texCoord[2],h.texCoord[3],h.offset.x,h.offset.y),o.push([c.x,c.y,h.size,h.offset,a[l]]),h.size[0]>s[0]&&(s[0]=h.size[0]),h.size[1]>s[1]&&(s[1]=h.size[1])}}i.bufferData(i.ARRAY_BUFFER,new Float32Array(n),i.STATIC_DRAW),this._maxIconSize=s,this._indexData(o)}this._drawMarkers(),console.timeEnd("draw points"),this.completeRender()},r.prototype.onRemove=function(){this._removeEvents(),delete this._sprites,t.prototype.onRemove.apply(this,arguments)},r.prototype.identify=function(t,e){if(!this._kdIndex)return null;var r=this.getMap(),a=r.coordinateToPoint(t,r.getMaxZoom()),n=r.getScale(),o=n*this._maxIconSize[0],i=n*this._maxIconSize[1],s=this._kdIndex.range(a.x-o,a.y-i,a.x+o,a.y+i),l=void 0,u=void 0;e&&(e.filter&&(l=e.filter),e.count&&(u=e.count));for(var h=[],c=0,f=s.length;c<f;c++){var d=this._indexPoints[s[c]],M=d[0],v=d[1],p=d[2],x=d[3],m=[n*(-p[0]/2+x.x),n*(-p[1]/2+x.y),n*(p[0]/2+x.x),n*(p[1]/2+x.y)];if(a.x>=M+m[0]&&a.x<=M+m[2]&&a.y>=v+m[1]&&a.y<=v+m[3]&&(l&&!l(d[4])||h.push(d[4]),u&&h.length>=u))break}return h},r.prototype._indexData=function(t){this._indexPoints=t,this._kdIndex=$t(t,null,null,64,Int32Array)},r.prototype._getTexCoord=function(t){if(!this.layer._cookedStyles)return null;for(var e=0,r=this.layer._cookedStyles.length;e<r;e++)if(this.layer._cookedStyles[e].filter(t)===!0)return{texCoord:this._sprites.texCoords[e],offset:this._sprites.offsets[e],size:this._sprites.sizes[e]};return null},r.prototype._checkSprites=function(){var t=this;if(this._needCheckSprites){var r=this.resources,a=[];if(this.layer.getStyle()&&!function(){var n=t.getMap();t.layer.getStyle().forEach(function(t){var o=new e.Marker([0,0],{symbol:t.symbol}),i=o._getSprite(r,n.CanvasClass);i&&a.push(i)})}(),this._sprites=this.mergeSprites(a,!0),this._sprites&&("undefined"!=typeof window&&window.MAPTALKS_WEBGL_DEBUG_CANVAS&&window.MAPTALKS_WEBGL_DEBUG_CANVAS.getContext("2d").drawImage(this._sprites.canvas,0,0),this._needCheckSprites=!1,!this._textureLoaded)){var n=this._sprites.canvas.getContext("2d"),o=this._sprites.canvas.width,i=this._sprites.canvas.height,s=n.getImageData(0,0,o,i);this.loadTexture(s),this.enableSampler("u_sampler"),this._textureLoaded=!0}}},r.prototype._drawMarkers=function(){var t=this.context,e=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,e),t.uniform1f(t.program.u_scale,this.getMap().getScale()),t.drawArrays(t.POINTS,0,this._vertexCount);
},r.prototype._registerEvents=function(){this.layer.on("setstyle",this._onStyleChanged,this)},r.prototype._removeEvents=function(){this.layer.off("setstyle",this._onStyleChanged,this)},r.prototype._onStyleChanged=function(){this._needCheckStyle=!0},r}(dt));var ee={blur:2},re=function(t){function e(){return ht(this,e),ft(this,t.apply(this,arguments))}return ct(e,t),e}(Gt);re.mergeOptions(ee),re.registerJSONType("BigLineLayer"),re.registerRenderer("webgl",function(t){function r(e){ht(this,r);var a=ft(this,t.call(this,e));return a._needCheckStyle=!0,a._needCheckSprites=!0,a._registerEvents(),a}return ct(r,t),r.prototype.checkResources=function(){if(!this._needCheckStyle)return null;var t=[];return this.layer._cookedStyles&&this.layer._cookedStyles.forEach(function(r){r.symbol=e.Util.convertResourceUrl(r.symbol);var a=e.Util.getExternalResources(r.symbol,!0);a&&t.push(a)}),this._needCheckStyle=!1,this._needCheckSprites=!0,0===t.length?null:t},r.prototype.onCanvasCreate=function(){var t=["u_matrix","u_scale","u_spritesize","u_blur"],e=this.createProgram(Ut.line.vertexSource,Ut.line.fragmentSource,t);this.useProgram(e)},r.prototype.draw=function(){console.time("draw lines"),this.prepareCanvas(),this._checkSprites();var t=this.context,e=this.getMap(),r=this.layer.data;if(!this._lineArrays){for(var a=new Nt(t,e),n=void 0,o=0,i=r.length;o<i;o++)n=this._getLineSymbol(r[o][1]),a.addLine(r[o][0],n);var s=a.getArrays();this._bufferData(s),this._elementCount=s.elementArray.length,console.log("lineArrays",s)}this._drawLines(),console.timeEnd("draw lines"),this.completeRender()},r.prototype.onRemove=function(){this._removeEvents(),delete this._sprites,delete this._lineArrays,t.prototype.onRemove.apply(this,arguments)},r.prototype._bufferData=function(t){var e=this.context,r=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),this.enableVertexAttrib(["a_pos",2,"FLOAT"]),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.vertexArray),e.STATIC_DRAW);var a=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),this.enableVertexAttrib([["a_corner",1,"FLOAT"],["a_linenormal",2,"FLOAT"],["a_normal",2,"FLOAT"],["a_linesofar",1,"FLOAT"]]),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.normalArray),e.STATIC_DRAW);var n=this.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),this.enableVertexAttrib([["a_texcoord",4,"FLOAT"],["a_opacity",1,"FLOAT"],["a_linewidth",1,"FLOAT"]]),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t.styleArray),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null);var o=this.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(t.elementArray),e.STATIC_DRAW)},r.prototype._checkSprites=function(){var t=this;if(this._needCheckSprites){this._atlas=new vt(this.resources);var e=[];if(this.layer._cookedStyles&&this.layer._cookedStyles.forEach(function(r){var a=t._atlas.getAtlas(r.symbol,!1);a&&e.push(a)}),this._sprites=this.mergeSprites(e),this._sprites&&"undefined"!=typeof window&&window.MAPTALKS_WEBGL_DEBUG_CANVAS){var r=window.MAPTALKS_WEBGL_DEBUG_CANVAS;r.getContext("2d").fillRect(0,0,r.width,r.height),r.getContext("2d").fillStyle="rgb(255, 255, 255)",r.getContext("2d").fillRect(0,0,this._sprites.canvas.width,this._sprites.canvas.height),r.getContext("2d").drawImage(this._sprites.canvas,0,0)}this._needCheckSprites=!1,this._sprites&&!this._textureLoaded&&(this.loadTexture(this._sprites.canvas),this.enableSampler("u_image"),this._textureLoaded=!0)}},r.prototype._getLineSymbol=function(t){for(var e=-1,r=0,a=this.layer._cookedStyles.length;r<a;r++){var n=this.layer._cookedStyles[r],o=this._atlas.getAtlas(n.symbol);if(o&&e++,n.filter(t)===!0)return o?{symbol:n.symbol,texCoord:this._sprites.texCoords[e]}:{symbol:n.symbol}}return null},r.prototype._drawLines=function(){var t=this.context,e=this.getMap(),r=t.program,a=this.calcMatrices();t.uniformMatrix4fv(t.program.u_matrix,!1,a),t.uniform1f(r.u_scale,e.getScale()),t.uniform1f(r.u_blur,this.layer.options.blur);var n=[0,0];this._sprites&&(n=[this._sprites.canvas.width,this._sprites.canvas.height]),console.log(n),t.uniform2fv(r.u_spritesize,new Float32Array(n)),t.drawElements(t.TRIANGLES,this._elementCount,t.UNSIGNED_SHORT,0)},r.prototype._registerEvents=function(){this.layer.on("setstyle",this._onStyleChanged,this)},r.prototype._removeEvents=function(){this.layer.off("setstyle",this._onStyleChanged,this)},r.prototype._onStyleChanged=function(){this._needCheckStyle=!0},r}(dt)),t.webgl=jt,t.BigDataLayer=Gt,t.BigPointLayer=te,t.BigLineLayer=re,Object.defineProperty(t,"__esModule",{value:!0})});